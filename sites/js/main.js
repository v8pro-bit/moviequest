/*
 Platform.js <https://mths.be/platform>
 Copyright 2014-2018 Benjamin Tan <https://bnjmnt4n.now.sh/>
 Copyright 2011-2013 John-David Dalton
 Available under MIT license <https://mths.be/mit>
*/
(function(){var p="undefined"!==typeof window&&"undefined"!==typeof window.document?window.document:{},e="undefined"!==typeof module&&module.exports,n=function(){for(var c,a=["requestFullscreen exitFullscreen fullscreenElement fullscreenEnabled fullscreenchange fullscreenerror".split(" "),"webkitRequestFullscreen webkitExitFullscreen webkitFullscreenElement webkitFullscreenEnabled webkitfullscreenchange webkitfullscreenerror".split(" "),"webkitRequestFullScreen webkitCancelFullScreen webkitCurrentFullScreenElement webkitCancelFullScreen webkitfullscreenchange webkitfullscreenerror".split(" "),
"mozRequestFullScreen mozCancelFullScreen mozFullScreenElement mozFullScreenEnabled mozfullscreenchange mozfullscreenerror".split(" "),"msRequestFullscreen msExitFullscreen msFullscreenElement msFullscreenEnabled MSFullscreenChange MSFullscreenError".split(" ")],g=0,k=a.length,d={};g<k;g++)if((c=a[g])&&c[1]in p){for(g=0;g<c.length;g++)d[a[0][g]]=c[g];return d}return!1}(),q={change:n.fullscreenchange,error:n.fullscreenerror},b={request:function(c){return new Promise(function(a,g){var k=function(){this.off("change",
k);a()}.bind(this);this.on("change",k);c=c||p.documentElement;Promise.resolve(c[n.requestFullscreen]())["catch"](g)}.bind(this))},exit:function(){return new Promise(function(c,a){if(this.isFullscreen){var g=function(){this.off("change",g);c()}.bind(this);this.on("change",g);Promise.resolve(p[n.exitFullscreen]())["catch"](a)}else c()}.bind(this))},toggle:function(c){return this.isFullscreen?this.exit():this.request(c)},onchange:function(c){this.on("change",c)},onerror:function(c){this.on("error",c)},
on:function(c,a){var g=q[c];g&&p.addEventListener(g,a,!1)},off:function(c,a){var g=q[c];g&&p.removeEventListener(g,a,!1)},raw:n};n?(Object.defineProperties(b,{isFullscreen:{get:function(){return!!p[n.fullscreenElement]}},element:{enumerable:!0,get:function(){return p[n.fullscreenElement]}},isEnabled:{enumerable:!0,get:function(){return!!p[n.fullscreenEnabled]}}}),e?module.exports=b:window.screenfull=b):e?module.exports={isEnabled:!1}:window.screenfull={isEnabled:!1}})();
(function(){function p(w){w=String(w);return w.charAt(0).toUpperCase()+w.slice(1)}function e(w,G){var N=-1,K=w?w.length:0;if("number"==typeof K&&-1<K&&K<=l)for(;++N<K;)G(w[N],N,w);else q(w,G)}function n(w){w=String(w).replace(/^ +| +$/g,"");return/^(?:webOS|i(?:OS|P))/.test(w)?w:p(w)}function q(w,G){for(var N in w)u.call(w,N)&&G(w[N],N,w)}function b(w){return null==w?p(w):v.call(w).slice(8,-1)}function c(w,G){var N=null!=w?typeof w[G]:"number";return!/^(?:boolean|number|string|undefined)$/.test(N)&&
("object"==N?!!w[G]:!0)}function a(w){return String(w).replace(/([ -])(?!$)/g,"$1?")}function g(w,G){var N=null;e(w,function(K,T){N=G(N,K,T,w)});return N}function k(w){function G(ma){return g(ma,function(ja,fa){var qa=fa.pattern||a(fa);!ja&&(ja=RegExp("\\b"+qa+" *\\d+[.\\w_]*","i").exec(w)||RegExp("\\b"+qa+" *\\w+-[\\w]*","i").exec(w)||RegExp("\\b"+qa+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(w))&&((ja=String(fa.label&&!RegExp(qa,"i").test(fa.label)?fa.label:ja).split("/"))[1]&&!/[\d.]+/.test(ja[0])&&
(ja[0]+=" "+ja[1]),fa=fa.label||fa,ja=n(ja[0].replace(RegExp(qa,"i"),fa).replace(RegExp("; *(?:"+fa+"[_-])?","i")," ").replace(RegExp("("+fa+")[-_.]?(\\w)","i"),"$1 $2")));return ja})}function N(ma){return g(ma,function(ja,fa){return ja||(RegExp(fa+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(w)||0)[1]||null})}var K=f,T=w&&"object"==typeof w&&"String"!=b(w);T&&(K=w,w=null);var L=K.navigator||{},C=L.userAgent||"";w||(w=C);var D=T?!!L.likeChrome:/\bChrome\b/.test(w)&&!/internal|\n/i.test(v.toString()),
H=T?"Object":"ScriptBridgingProxyObject",P=T?"Object":"Environment",y=T&&K.java?"JavaPackage":b(K.java),V=T?"Object":"RuntimeObject";P=(y=/\bJava/.test(y)&&K.java)&&b(K.environment)==P;var E=y?"a":"\u03b1",R=y?"b":"\u03b2",M=K.document||{},A=K.operamini||K.opera,B=r.test(B=T&&A?A["[[Class]]"]:b(A))?B:A=null,t,z=w;T=[];var J=null,I=w==C;C=I&&A&&"function"==typeof A.version&&A.version();var Q=function(ma){return g(ma,function(ja,fa){return ja||RegExp("\\b"+(fa.pattern||a(fa))+"\\b","i").exec(w)&&(fa.label||
fa)})}([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),F=function(ma){return g(ma,function(ja,fa){return ja||RegExp("\\b"+(fa.pattern||a(fa))+"\\b","i").exec(w)&&(fa.label||fa)})}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori",
"Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Waterfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",
pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),U=G([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV",
"Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),Z=function(ma){return g(ma,function(ja,fa,qa){return ja||(fa[U]||fa[/^[a-z]+(?: +[a-z]+\b)*/i.exec(U)]||RegExp("\\b"+a(qa)+"(?:\\b|\\w*\\d)","i").exec(w))&&qa})}({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},
Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1}}),S=function(ma){return g(ma,function(ja,fa){var qa=fa.pattern||a(fa);if(!ja&&(ja=RegExp("\\b"+qa+"(?:/[\\d.]+|[ \\w.]*)","i").exec(w))){var aa=ja,ca=fa.label||fa,da={"10.0":"10",
"6.4":"10 Technical Preview","6.3":"8.1","6.2":"8","6.1":"Server 2008 R2 / 7","6.0":"Server 2008 / Vista","5.2":"Server 2003 / XP 64-bit","5.1":"XP","5.01":"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};qa&&ca&&/^Win/i.test(aa)&&!/^Windows Phone /i.test(aa)&&(da=da[/[\d.]+$/.exec(aa)])&&(aa="Windows "+da);aa=String(aa);qa&&ca&&(aa=aa.replace(RegExp(qa,"i"),ca));ja=aa=n(aa.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,
"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}return ja})}(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS",
"Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);Q&&(Q=[Q]);Z&&!U&&(U=G([Z]));if(t=/\bGoogle TV\b/.exec(U))U=t[0];/\bSimulator\b/i.test(w)&&(U=(U?U+" ":"")+"Simulator");"Opera Mini"==F&&/\bOPiOS\b/.test(w)&&T.push("running in Turbo/Uncompressed mode");"IE"==F&&/\blike iPhone OS\b/.test(w)?(t=k(w.replace(/like iPhone OS/,"")),Z=t.manufacturer,U=t.product):/^iP/.test(U)?(F||(F="Safari"),S="iOS"+((t=/ OS ([\d_]+)/i.exec(w))?" "+t[1].replace(/_/g,"."):"")):"Konqueror"!=F||/buntu/i.test(S)?
Z&&"Google"!=Z&&(/Chrome/.test(F)&&!/\bMobile Safari\b/i.test(w)||/\bVita\b/.test(U))||/\bAndroid\b/.test(S)&&/^Chrome/.test(F)&&/\bVersion\//i.test(w)?(F="Android Browser",S=/\bAndroid\b/.test(S)?S:"Android"):"Silk"==F?(/\bMobi/i.test(w)||(S="Android",T.unshift("desktop mode")),/Accelerated *= *true/i.test(w)&&T.unshift("accelerated")):"PaleMoon"==F&&(t=/\bFirefox\/([\d.]+)\b/.exec(w))?T.push("identifying as Firefox "+t[1]):"Firefox"==F&&(t=/\b(Mobile|Tablet|TV)\b/i.exec(w))?(S||(S="Firefox OS"),
U||(U=t[1])):!F||(t=!/\bMinefield\b/i.test(w)&&/\b(?:Firefox|Safari)\b/.exec(F))?(F&&!U&&/[\/,]|^[^(]+?\)/.test(w.slice(w.indexOf(t+"/")+8))&&(F=null),(t=U||Z||S)&&(U||Z||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(S))&&(F=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(S)?S:t)+" Browser")):"Electron"==F&&(t=(/\bChrome\/([\d.]+)\b/.exec(w)||0)[1])&&T.push("Chromium "+t):S="Kubuntu";C||(C=N(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))",
"Version",a(F),"(?:Firefox|Minefield|NetFront)"]));if(t="iCab"==Q&&3<parseFloat(C)&&"WebKit"||/\bOpera\b/.test(F)&&(/\bOPR\b/.test(w)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(w)&&!/^(?:Trident|EdgeHTML)$/.test(Q)&&"WebKit"||!Q&&/\bMSIE\b/i.test(w)&&("Mac OS"==S?"Tasman":"Trident")||"WebKit"==Q&&/\bPlayStation\b(?! Vita\b)/i.test(F)&&"NetFront")Q=[t];"IE"==F&&(t=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(w)||0)[1])?(F+=" Mobile",S="Windows Phone "+(/\+$/.test(t)?t:t+".x"),T.unshift("desktop mode")):
/\bWPDesktop\b/i.test(w)?(F="IE Mobile",S="Windows Phone 8.x",T.unshift("desktop mode"),C||(C=(/\brv:([\d.]+)/.exec(w)||0)[1])):"IE"!=F&&"Trident"==Q&&(t=/\brv:([\d.]+)/.exec(w))&&(F&&T.push("identifying as "+F+(C?" "+C:"")),F="IE",C=t[1]);if(I){if(c(K,"global"))if(y&&(t=y.lang.System,z=t.getProperty("os.arch"),S=S||t.getProperty("os.name")+" "+t.getProperty("os.version")),P){try{C=K.require("ringo/engine").version.join("."),F="RingoJS"}catch(ma){(t=K.system)&&t.global.system==K.system&&(F="Narwhal",
S||(S=t[0].os||null))}F||(F="Rhino")}else"object"==typeof K.process&&!K.process.browser&&(t=K.process)&&("object"==typeof t.versions&&("string"==typeof t.versions.electron?(T.push("Node "+t.versions.node),F="Electron",C=t.versions.electron):"string"==typeof t.versions.nw&&(T.push("Chromium "+C,"Node "+t.versions.node),F="NW.js",C=t.versions.nw)),F||(F="Node.js",z=t.arch,S=t.platform,C=(C=/[\d.]+/.exec(t.version))?C[0]:null));else b(t=K.runtime)==H?(F="Adobe AIR",S=t.flash.system.Capabilities.os):
b(t=K.phantom)==V?(F="PhantomJS",C=(t=t.version||null)&&t.major+"."+t.minor+"."+t.patch):"number"==typeof M.documentMode&&(t=/\bTrident\/(\d+)/i.exec(w))?(C=[C,M.documentMode],(t=+t[1]+4)!=C[1]&&(T.push("IE "+C[1]+" mode"),Q&&(Q[1]=""),C[1]=t),C="IE"==F?String(C[1].toFixed(1)):C[0]):"number"==typeof M.documentMode&&/^(?:Chrome|Firefox)\b/.test(F)&&(T.push("masking as "+F+" "+C),F="IE",C="11.0",Q=["Trident"],S="Windows");S=S&&n(S)}C&&(t=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(C)||/(?:alpha|beta)(?: ?\d)?/i.exec(w+
";"+(I&&L.appMinorVersion))||/\bMinefield\b/i.test(w)&&"a")&&(J=/b/i.test(t)?"beta":"alpha",C=C.replace(RegExp(t+"\\+?$"),"")+("beta"==J?R:E)+(/\d+\+?/.exec(t)||""));if("Fennec"==F||"Firefox"==F&&/\b(?:Android|Firefox OS)\b/.test(S))F="Firefox Mobile";else if("Maxthon"==F&&C)C=C.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(U))"Xbox 360"==U&&(S=null),"Xbox 360"==U&&/\bIEMobile\b/.test(w)&&T.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(F)&&(!F||U||/Browser|Mobi/.test(F))||"Windows CE"!=
S&&!/Mobi/i.test(w))if("IE"==F&&I)try{null===K.external&&T.unshift("platform preview")}catch(ma){T.unshift("embedded")}else(/\bBlackBerry\b/.test(U)||/\bBB10\b/.test(w))&&(t=(RegExp(U.replace(/ +/g," *")+"/([.\\d]+)","i").exec(w)||0)[1]||C)?(t=[t,/BB10/.test(w)],S=(t[1]?(U=null,Z="BlackBerry"):"Device Software")+" "+t[0],C=null):this!=q&&"Wii"!=U&&(I&&A||/Opera/.test(F)&&/\b(?:MSIE|Firefox)\b/i.test(w)||"Firefox"==F&&/\bOS X (?:\d+\.){2,}/.test(S)||"IE"==F&&(S&&!/^Win/.test(S)&&5.5<C||/\bWindows XP\b/.test(S)&&
8<C||8==C&&!/\bTrident\b/.test(w)))&&!r.test(t=k.call(q,w.replace(r,"")+";"))&&t.name&&(t="ing as "+t.name+((t=t.version)?" "+t:""),r.test(F)?(/\bIE\b/.test(t)&&"Mac OS"==S&&(S=null),t="identify"+t):(t="mask"+t,F=B?n(B.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(t)&&(S=null),I||(C=null)),Q=["Presto"],T.push(t));else F+=" Mobile";if(t=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(w)||0)[1]){t=[parseFloat(t.replace(/\.(\d)$/,".0$1")),t];if("Safari"==F&&"+"==t[1].slice(-1))F="WebKit Nightly",J="alpha",
C=t[1].slice(0,-1);else if(C==t[1]||C==(t[2]=(/\bSafari\/([\d.]+\+?)/i.exec(w)||0)[1]))C=null;t[1]=(/\bChrome\/([\d.]+)/i.exec(w)||0)[1];537.36==t[0]&&537.36==t[2]&&28<=parseFloat(t[1])&&"WebKit"==Q&&(Q=["Blink"]);I&&(D||t[1])?(Q&&(Q[1]="like Chrome"),t=t[1]||(t=t[0],530>t?1:532>t?2:532.05>t?3:533>t?4:534.03>t?5:534.07>t?6:534.1>t?7:534.13>t?8:534.16>t?9:534.24>t?10:534.3>t?11:535.01>t?12:535.02>t?"13+":535.07>t?15:535.11>t?16:535.19>t?17:536.05>t?18:536.1>t?19:537.01>t?20:537.11>t?"21+":537.13>t?
23:537.18>t?24:537.24>t?25:537.36>t?26:"Blink"!=Q?"27":"28")):(Q&&(Q[1]="like Safari"),t=(t=t[0],400>t?1:500>t?2:526>t?3:533>t?4:534>t?"4+":535>t?5:537>t?6:538>t?7:601>t?8:"8"));Q&&(Q[1]+=" "+(t+="number"==typeof t?".x":/[.+]/.test(t)?"":"+"));"Safari"==F&&(!C||45<parseInt(C))&&(C=t)}"Opera"==F&&(t=/\bzbov|zvav$/.exec(S))?(F+=" ",T.unshift("desktop mode"),"zvav"==t?(F+="Mini",C=null):F+="Mobile",S=S.replace(RegExp(" *"+t+"$"),"")):"Safari"==F&&/\bChrome\b/.exec(Q&&Q[1])&&(T.unshift("desktop mode"),
F="Chrome Mobile",C=null,/\bOS X\b/.test(S)?(Z="Apple",S="iOS 4.3+"):S=null);C&&0==C.indexOf(t=/[\d.]+$/.exec(S))&&-1<w.indexOf("/"+t+"-")&&(S=String(S.replace(t,"")).replace(/^ +| +$/g,""));Q&&!/\b(?:Avant|Nook)\b/.test(F)&&(/Browser|Lunascape|Maxthon/.test(F)||"Safari"!=F&&/^iOS/.test(S)&&/\bSafari\b/.test(Q[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(F)&&Q[1])&&(t=Q[Q.length-1])&&T.push(t);T.length&&(T=["("+T.join("; ")+")"]);Z&&U&&0>U.indexOf(Z)&&
T.push("on "+Z);U&&T.push((/^on /.test(T[T.length-1])?"":"on ")+U);if(S){var W=(t=/ ([\d.+]+)$/.exec(S))&&"/"==S.charAt(S.length-t[0].length-1);S={architecture:32,family:t&&!W?S.replace(t[0],""):S,version:t?t[1]:null,toString:function(){var ma=this.version;return this.family+(ma&&!W?" "+ma:"")+(64==this.architecture?" 64-bit":"")}}}(t=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(z))&&!/\bi686\b/i.test(z)?(S&&(S.architecture=64,S.family=S.family.replace(RegExp(" *"+t),"")),F&&(/\bWOW64\b/i.test(w)||I&&
/\w(?:86|32)$/.test(L.cpuClass||L.platform)&&!/\bWin64; x64\b/i.test(w))&&T.unshift("32-bit")):S&&/^OS X/.test(S.family)&&"Chrome"==F&&39<=parseFloat(C)&&(S.architecture=64);w||(w=null);K={};K.description=w;K.layout=Q&&Q[0];K.manufacturer=Z;K.name=F;K.prerelease=J;K.product=U;K.ua=w;K.version=F&&C;K.os=S||{architecture:null,family:null,version:null,toString:function(){return"null"}};K.parse=k;K.toString=function(){return this.description||""};K.version&&T.unshift(C);K.name&&T.unshift(F);S&&F&&(S!=
String(S).split(" ")[0]||S!=F.split(" ")[0]&&!U)&&T.push(U?"("+S+")":"on "+S);T.length&&(K.description=T.join(" "));return K}var d={"function":!0,object:!0},f=d[typeof window]&&window||this,h=d[typeof exports]&&exports;d=d[typeof module]&&module&&!module.nodeType&&module;var m=h&&d&&"object"==typeof global&&global;!m||m.global!==m&&m.window!==m&&m.self!==m||(f=m);var l=Math.pow(2,53)-1,r=/\bOpera/;m=Object.prototype;var u=m.hasOwnProperty,v=m.toString,x=k();"function"==typeof define&&"object"==typeof define.amd&&
define.amd?(f.platform=x,define(function(){return x})):h&&d?q(x,function(w,G){h[G]=w}):f.platform=x}).call(this);
function buildIOSMeta(){for(var p=[{name:"viewport",content:"width=device-width, height=device-height, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no"},{name:"apple-mobile-web-app-capable",content:"yes"},{name:"apple-mobile-web-app-status-bar-style",content:"black"}],e=0;e<p.length;e++){var n=document.createElement("meta");n.name=p[e].name;n.content=p[e].content;var q=window.document.head.querySelector('meta[name="'+n.name+'"]');q&&q.parentNode.removeChild(q);window.document.head.appendChild(n)}}
function hideIOSFullscreenPanel(){jQuery(".xxx-ios-fullscreen-message").css("display","none");jQuery(".xxx-ios-fullscreen-scroll").css("display","none");jQuery(".xxx-game-iframe-full").removeClass("xxx-game-iframe-iphone-se")}function buildIOSFullscreenPanel(){jQuery("body").append('<div class="xxx-ios-fullscreen-message"><div class="xxx-ios-fullscreen-swipe"></div></div><div class="xxx-ios-fullscreen-scroll"></div>')}
function showIOSFullscreenPanel(){jQuery(".xxx-ios-fullscreen-message").css("display","block");jQuery(".xxx-ios-fullscreen-scroll").css("display","block")}
function __iosResize(){window.scrollTo(0,0);console.log(window.devicePixelRatio);console.log(window.innerWidth);console.log(window.innerHeight);if("iPhone"===platform.product)switch(window.devicePixelRatio){case 2:switch(window.innerWidth){case 568:320!==window.innerHeight&&jQuery(".xxx-game-iframe-full").addClass("xxx-game-iframe-iphone-se");break;case 667:375===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;case 808:414===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();
break;default:hideIOSFullscreenPanel()}break;case 3:switch(window.innerWidth){case 736:414===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;case 724:375===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;case 808:414===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;default:hideIOSFullscreenPanel()}break;default:hideIOSFullscreenPanel()}}function iosResize(){__iosResize();setTimeout(function(){__iosResize()},500)}
function iosInIframe(){try{return window.self!==window.top}catch(p){return!0}}function isIOSLessThen13(){var p=platform.os,e=p.family.toLowerCase();p=parseFloat(p.version);return"ios"===e&&13>p?!0:!1}$(document).ready(function(){platform&&"iPhone"===platform.product&&"safari"===platform.name.toLowerCase()&&isIOSLessThen13()&&!iosInIframe()&&(buildIOSFullscreenPanel(),buildIOSMeta())});
jQuery(window).resize(function(){platform&&"iPhone"===platform.product&&"safari"===platform.name.toLowerCase()&&isIOSLessThen13()&&!iosInIframe()&&iosResize()});var s_iScaleFactor=1,s_bIsIphone=!1,s_iOffsetX,s_iOffsetY,s_fInverseScaling=0,s_bFocus=!0;
(function(p){(jQuery.browser=jQuery.browser||{}).mobile=/android|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(ad|hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|tablet|treo|up\.(browser|link)|vodafone|wap|webos|windows (ce|phone)|xda|xiino/i.test(p)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(p.substr(0,
4))})(navigator.userAgent||navigator.vendor||window.opera);$(window).resize(function(){sizeHandler()});function trace(p){console.log(p)}function isChrome(){return/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}function isIpad(){var p=-1!==navigator.userAgent.toLowerCase().indexOf("ipad");return!p&&navigator.userAgent.match(/Mac/)&&navigator.maxTouchPoints&&2<navigator.maxTouchPoints?!0:p}function isMobile(){return isIpad()?!0:jQuery.browser.mobile}
function isIOS(){var p="iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";");if(-1!==navigator.userAgent.toLowerCase().indexOf("iphone"))return s_bIsIphone=!0;for(;p.length;)if(navigator.platform===p.pop())return!0;return s_bIsIphone=!1}window.addEventListener("orientationchange",onOrientationChange);function onOrientationChange(){window.matchMedia("(orientation: portrait)").matches&&sizeHandler();window.matchMedia("(orientation: landscape)").matches&&sizeHandler()}
function getSize(p){var e=p.toLowerCase(),n=window.document,q=n.documentElement;if(void 0===window["inner"+p])p=q["client"+p];else if(window["inner"+p]!=q["client"+p]){var b=n.createElement("body");b.id="vpw-test-b";b.style.cssText="overflow:scroll";var c=n.createElement("div");c.id="vpw-test-d";c.style.cssText="position:absolute;top:-1000px";c.innerHTML="<style>@media("+e+":"+q["client"+p]+"px){body#vpw-test-b div#vpw-test-d{"+e+":7px!important}}</style>";b.appendChild(c);q.insertBefore(b,n.head);
p=7==c["offset"+p]?q["client"+p]:window["inner"+p];q.removeChild(b)}else p=window["inner"+p];return p}function getIOSWindowHeight(){return document.documentElement.clientWidth/window.innerWidth*window.innerHeight}function getHeightOfIOSToolbars(){var p=(0===window.orientation?screen.height:screen.width)-getIOSWindowHeight();return 1<p?p:0}
function sizeHandler(){window.scrollTo(0,1);if($("#canvas")){var p=null!==platform.name&&"safari"===platform.name.toLowerCase()?getIOSWindowHeight():getSize("Height");var e=getSize("Width");s_bFocus&&_checkOrientation(e,p);s_iScaleFactor=Math.min(p/CANVAS_HEIGHT,e/CANVAS_WIDTH);var n=Math.round(CANVAS_WIDTH*s_iScaleFactor),q=Math.round(CANVAS_HEIGHT*s_iScaleFactor);if(q<p){var b=p-q;q+=b;n+=CANVAS_WIDTH/CANVAS_HEIGHT*b}else n<e&&(b=e-n,n+=b,q+=CANVAS_HEIGHT/CANVAS_WIDTH*b);b=p/2-q/2;var c=e/2-n/2,
a=CANVAS_WIDTH/n;if(c*a<-EDGEBOARD_X||b*a<-EDGEBOARD_Y)s_iScaleFactor=Math.min(p/(CANVAS_HEIGHT-2*EDGEBOARD_Y),e/(CANVAS_WIDTH-2*EDGEBOARD_X)),n=n=Math.round(CANVAS_WIDTH*s_iScaleFactor),q=Math.round(CANVAS_HEIGHT*s_iScaleFactor),b=(p-q)/2,c=(e-n)/2,a=CANVAS_WIDTH/n;s_fInverseScaling=a;s_iOffsetX=-1*c*a;s_iOffsetY=-1*b*a;0<=b&&(s_iOffsetY=0);0<=c&&(s_iOffsetX=0);null!==s_oInterface&&s_oInterface.refreshButtonPos(s_iOffsetX,s_iOffsetY);null!==s_oMenu&&s_oMenu.refreshButtonPos(s_iOffsetX,s_iOffsetY);
null!==s_oLevelMenu&&s_oLevelMenu.refreshButtonPos(s_iOffsetX,s_iOffsetY);$("#canvas").css("width",n+"px");$("#canvas").css("height",q+"px");0>b||(b=(p-q)/2);$("#canvas").css("top",b+"px");s_iCanvasOffsetHeight=b;$("#canvas").css("left",c+"px");resizeCanvas3D();s_iCanvasResizeWidth=n;s_iCanvasResizeHeight=q;s_iCanvasOffsetWidth=c;fullscreenHandler()}}
function _checkOrientation(p,e){s_bMobile&&ENABLE_CHECK_ORIENTATION&&(p>e?"landscape"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display","none"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),s_oMain.stopUpdate()):"portrait"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display","none"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),
s_oMain.stopUpdate()))}function createBitmap(p,e,n){var q=new createjs.Bitmap(p),b=new createjs.Shape;e&&n?b.graphics.beginFill("#fff").drawRect(-e/2,-n/2,e,n):b.graphics.beginFill("#ff0").drawRect(0,0,p.width,p.height);q.hitArea=b;return q}function createSprite(p,e,n,q,b,c){p=null!==e?new createjs.Sprite(p,e):new createjs.Sprite(p);e=new createjs.Shape;e.graphics.beginFill("#000000").drawRect(-n,-q,b,c);p.hitArea=e;return p}
function randomFloatBetween(p,e,n){"undefined"===typeof n&&(n=2);return parseFloat(Math.min(p+Math.random()*(e-p),e).toFixed(n))}function shuffle(p){for(var e=p.length,n,q;0!==e;)q=Math.floor(Math.random()*e),--e,n=p[e],p[e]=p[q],p[q]=n;return p}function formatTime(p){p/=1E3;var e=Math.floor(p/60);p=parseFloat(p-60*e).toFixed(1);var n="";n=10>e?n+("0"+e+":"):n+(e+":");return 10>p?n+("0"+p):n+p}function degreesToRadians(p){return p*Math.PI/180}
function checkRectCollision(p,e){var n=getBounds(p,.9);var q=getBounds(e,.98);return calculateIntersection(n,q)}function calculateIntersection(p,e){var n,q,b,c;var a=p.x+(n=p.width/2);var g=p.y+(q=p.height/2);var k=e.x+(b=e.width/2);var d=e.y+(c=e.height/2);a=Math.abs(a-k)-(n+b);g=Math.abs(g-d)-(q+c);return 0>a&&0>g?(a=Math.min(Math.min(p.width,e.width),-a),g=Math.min(Math.min(p.height,e.height),-g),{x:Math.max(p.x,e.x),y:Math.max(p.y,e.y),width:a,height:g,rect1:p,rect2:e}):null}
function getBounds(p,e){var n={x:Infinity,y:Infinity,width:0,height:0};if(p instanceof createjs.Container){n.x2=-Infinity;n.y2=-Infinity;var q=p.children,b=q.length,c;for(c=0;c<b;c++){var a=getBounds(q[c],1);a.x<n.x&&(n.x=a.x);a.y<n.y&&(n.y=a.y);a.x+a.width>n.x2&&(n.x2=a.x+a.width);a.y+a.height>n.y2&&(n.y2=a.y+a.height)}Infinity==n.x&&(n.x=0);Infinity==n.y&&(n.y=0);Infinity==n.x2&&(n.x2=0);Infinity==n.y2&&(n.y2=0);n.width=n.x2-n.x;n.height=n.y2-n.y;delete n.x2;delete n.y2}else{if(p instanceof createjs.Bitmap){b=
p.sourceRect||p.image;c=b.width*e;var g=b.height*e}else if(p instanceof createjs.Sprite)if(p.spriteSheet._frames&&p.spriteSheet._frames[p.currentFrame]&&p.spriteSheet._frames[p.currentFrame].image){b=p.spriteSheet.getFrame(p.currentFrame);c=b.rect.width;g=b.rect.height;q=b.regX;var k=b.regY}else n.x=p.x||0,n.y=p.y||0;else n.x=p.x||0,n.y=p.y||0;q=q||0;c=c||0;k=k||0;g=g||0;n.regX=q;n.regY=k;b=p.localToGlobal(0-q,0-k);a=p.localToGlobal(c-q,g-k);c=p.localToGlobal(c-q,0-k);q=p.localToGlobal(0-q,g-k);n.x=
Math.min(Math.min(Math.min(b.x,a.x),c.x),q.x);n.y=Math.min(Math.min(Math.min(b.y,a.y),c.y),q.y);n.width=Math.max(Math.max(Math.max(b.x,a.x),c.x),q.x)-n.x;n.height=Math.max(Math.max(Math.max(b.y,a.y),c.y),q.y)-n.y}return n}function NoClickDelay(p){this.element=p;window.Touch&&this.element.addEventListener("touchstart",this,!1)}
NoClickDelay.prototype={handleEvent:function(p){switch(p.type){case "touchstart":this.onTouchStart(p);break;case "touchmove":this.onTouchMove(p);break;case "touchend":this.onTouchEnd(p)}},onTouchStart:function(p){p.preventDefault();this.moved=!1;this.element.addEventListener("touchmove",this,!1);this.element.addEventListener("touchend",this,!1)},onTouchMove:function(p){this.moved=!0},onTouchEnd:function(p){this.element.removeEventListener("touchmove",this,!1);this.element.removeEventListener("touchend",
this,!1);if(!this.moved){p=document.elementFromPoint(p.changedTouches[0].clientX,p.changedTouches[0].clientY);3==p.nodeType&&(p=p.parentNode);var e=document.createEvent("MouseEvents");e.initEvent("click",!0,!0);p.dispatchEvent(e)}}};
(function(){function p(n){var q={focus:"visible",focusin:"visible",pageshow:"visible",blur:"hidden",focusout:"hidden",pagehide:"hidden"};n=n||window.event;n.type in q?document.body.className=q[n.type]:(document.body.className=this[e]?"hidden":"visible","hidden"===document.body.className?(s_oMain.stopUpdate(),s_bFocus=!1):(s_oMain.startUpdate(),s_bFocus=!0))}var e="hidden";e in document?document.addEventListener("visibilitychange",p):(e="mozHidden")in document?document.addEventListener("mozvisibilitychange",
p):(e="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",p):(e="msHidden")in document?document.addEventListener("msvisibilitychange",p):"onfocusin"in document?document.onfocusin=document.onfocusout=p:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=p})();function linearFunction(p,e,n,q,b){return(p-e)*(b-q)/(n-e)+q}
function playSound(p,e,n){return!1===DISABLE_SOUND_MOBILE||!1===s_bMobile?(s_aSounds[p].play(),s_aSounds[p].volume(e),s_aSounds[p].loop(n),s_aSounds[p]):null}function stopSound(p){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[p].stop()}function setVolume(p,e){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[p].volume(e)}function setMute(p,e){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[p].mute(e)}function ctlArcadeResume(){null!==s_oMain&&s_oMain.startUpdate()}
function ctlArcadePause(){null!==s_oMain&&s_oMain.stopUpdate()}function getParamValue(p){for(var e=window.location.search.substring(1).split("&"),n=0;n<e.length;n++){var q=e[n].split("=");if(q[0]==p)return q[1]}}function rotateVector2D(p,e){return{x:e.x*Math.cos(p)+e.y*Math.sin(p),y:e.x*-Math.sin(p)+e.y*Math.cos(p)}}function normalize(p,e){0<e&&(p.x/=e,p.y/=e);return p}function length(p){return Math.sqrt(p.x*p.x+p.y*p.y)}
function findNearestIntersectingObject(p,e,n,q){var b=CANVAS_RESIZE_WIDTH+2*OFFSET_WIDTH,c=CANVAS_RESIZE_HEIGHT+2*OFFSET_HEIGHT,a=new THREE.Raycaster,g=new THREE.Vector3;g.x=p/b*2-1;g.y=2*-(e/c)+1;g.z=.5;a.setFromCamera(g,n);p=a.intersectObjects(q,!0);e=!1;0<p.length&&(e=p[0]);return e}function distance(p,e,n,q){p-=n;e-=q;return Math.sqrt(p*p+e*e)}function distance2(p,e,n,q){p-=n;e-=q;return p*p+e*e}
function resizeCanvas3D(){$("canvas").each(function(){"#canvas"!=$(this).attr("id")&&($(this).css("width",$("#canvas").css("width")),$(this).css("height",$("#canvas").css("height")),$(this).css("position",$("#canvas").css("position")),$(this).css("left",$("#canvas").css("left")),$(this).css("top",$("#canvas").css("top")))})}
function createOrthoGraphicCamera(){var p=new THREE.PerspectiveCamera(FOV,CANVAS_WIDTH/CANVAS_HEIGHT,NEAR,FAR);p.rotation.x=Math.PI/180*90;p.position.set(0,0,0);p.updateProjectionMatrix();p.updateMatrixWorld();return p}function rotateVector2D(p,e){return{x:e.x*Math.cos(p)+e.y*Math.sin(p),y:e.x*-Math.sin(p)+e.y*Math.cos(p),z:0}}Math.radians=function(p){return p*Math.PI/180};Math.degrees=function(p){return 180*p/Math.PI};
function distanceV3(p,e,n,q,b,c){p-=q;e-=b;n-=c;return Math.sqrt(p*p+e*e+n*n)}function distanceV2(p,e){var n=p.x-e.x,q=p.y-e.y;return Math.sqrt(n*n+q*q)}function saveItem(p,e){s_bStorageAvailable&&localStorage.setItem(p,e)}function getItem(p){return s_bStorageAvailable?localStorage.getItem(p):null}function clearAllItem(){s_bStorageAvailable&&localStorage.clear()}
function fullscreenHandler(){ENABLE_FULLSCREEN&&screenfull.isEnabled&&(s_bFullscreen=screenfull.isFullscreen,null!==s_oInterface&&s_oInterface.resetFullscreenBut(),null!==s_oMenu&&s_oMenu.resetFullscreenBut(),null!==s_oLevelMenu&&s_oLevelMenu.resetFullscreenBut())}if(screenfull.isEnabled)screenfull.on("change",function(){s_bFullscreen=screenfull.isFullscreen;null!==s_oInterface&&s_oInterface.resetFullscreenBut();null!==s_oMenu&&s_oMenu.resetFullscreenBut();null!==s_oLevelMenu&&s_oLevelMenu.resetFullscreenBut()});
function CSpriteLibrary(){var p,e,n,q,b,c;this.init=function(a,g,k){n=e=0;q=a;b=g;c=k;p={}};this.addSprite=function(a,g){p.hasOwnProperty(a)||(p[a]={szPath:g,oSprite:new Image},e++)};this.getSprite=function(a){return p.hasOwnProperty(a)?p[a].oSprite:null};this._onSpritesLoaded=function(){b.call(c)};this._onSpriteLoaded=function(){q.call(c);++n==e&&this._onSpritesLoaded()};this.loadSprites=function(){for(var a in p)p[a].oSprite.oSpriteLibrary=this,p[a].oSprite.onload=function(){this.oSpriteLibrary._onSpriteLoaded()},
p[a].oSprite.onerror=function(g){var k=g.currentTarget;setTimeout(function(){p[k.szKey].oSprite.src=p[k.szKey].szPath},500)},p[a].oSprite.src=p[a].szPath};this.getNumSprites=function(){return e};this.loadSpriteGroup=function(a,g,k,d){for(var f=0;f<a.length;f++)p[a[f].key]={szPath:a[f].path,oSprite:new Image},e++;this._loadInStreamingSprite(a,g,k,d)};this._loadInStreamingSprite=function(a,g,k,d){var f=a.splice(0,1)[0].key;p[f].oSprite.oSpriteLibrary=this;p[f].oSprite.onload=function(){this.oSpriteLibrary._onElementOfSpriteGroupLoaded(a,
g,k,d)};p[f].oSprite.onerror=function(h){setTimeout(function(){p[f].oSprite.src=p[f].szPath},500)};p[f].oSprite.src=p[f].szPath};this._onElementOfSpriteGroupLoaded=function(a,g,k,d){0===a.length?k&&k.call(g,d):s_oSpriteLibrary._loadInStreamingSprite(a,g,k,d)}}
var CANVAS_WIDTH=1280,CANVAS_HEIGHT=768,CANVAS_WIDTH_HALF=.5*CANVAS_WIDTH,CANVAS_HEIGHT_HALF=.5*CANVAS_HEIGHT,EDGEBOARD_X=90,EDGEBOARD_Y=95,DISABLE_SOUND_MOBILE=!1,FONT_GAME="Arial",SECONDARY_FONT="blackplotanregular",FPS=30,FPS_DESKTOP=60,FPS_TIME=1/FPS,ROLL_BALL_RATE=60/FPS,STATE_LOADING=0,STATE_MENU=1,STATE_HELP=1,STATE_GAME=3,ON_MOUSE_DOWN=0,ON_MOUSE_UP=1,ON_MOUSE_OVER=2,ON_MOUSE_OUT=3,ON_DRAG_START=4,ON_DRAG_END=5,ON_TWEEN_ENDED=6,ON_BUT_NO_DOWN=7,ON_BUT_YES_DOWN=8,STEP_RATE=1.5,TEXT_SIZE=[80,
100,130],TEXT_EXCELLENT_COLOR=["#fff","#5d96fe"],TEXT_COLOR="#ffffff",TEXT_COLOR_STROKE="#000000",TIME_INTERVAL_STROBE=.2,PHYSICS_ACCURACY=3,MOBILE_OFFSET_GLOVES_X=-100,BALL_VELOCITY_MULTIPLIER=1,PHYSICS_STEP=1/(FPS*STEP_RATE),STATE_INIT=0,STATE_PLAY=1,STATE_FINISH=2,STATE_PAUSE=3,BALL_MASS=.5,BALL_RADIUS=1,BALL_LINEAR_DAMPING=.2,OFFSET_BALL_POS_X=10,OBJECT,TIME_TRY_TO_SHOT_BALL_OPPONENT=.7,START_POS_FLAG={x:277,y:268},FLAG_ADDED_POS={x:61,y:69},FLAG_LIMIT_POS_X=690,TOT_TEAM=32,MIN_BALL_VEL_ROTATION=
.1,TIME_RESET_AFTER_GOAL=1,TIME_RESET_AFTER_KEEPER_SAVED=2,TIME_RESET_AFTER_PERFECT_KEEPER_SAVED=3,TIME_BALL_IN_HAND=1E3,FOV=45,INTERVAL_SHOOT=1,HAND_KEEPER_ANGLE_RATE=.15,LIMIT_HAND_RANGE_POS={x:16.8,zMax:3.1,zMin:-8.5},BACK_WALL_GOAL_SIZE={width:17.5,depth:.1,height:7.5},LEFT_RIGHT_WALL_GOAL_SIZE={width:.1,depth:25,height:7.5},UP_WALL_GOAL_SIZE={width:17.5,depth:25,height:.1},BACK_WALL_GOAL_POSITION={x:0,y:8,z:-2.7},POSITION_BALL={x:0,y:125,z:-9},GOAL_LINE_POS={x:0,y:31,z:-2.7},HAND_KEEPER_SIZE=
{width:1.8,depth:.5,height:1.5},HAND_KEEPER_POSITION={x:0,y:36,z:0},POLE_UP_SIZE={radius_top:.5,radius_bottom:.5,height:35,segments:10},POLE_RIGHT_LEFT_SIZE={radius_top:.5,radius_bottom:.5,height:15,segments:10},GOAL_POSITION={x:0,y:33,z:-2.7},OFFSET_FIELD_Y=35,OFFSET_FIELD_X=35,HIT_BALL_MAX_FORCE=100,HIT_BALL_MIN_FORCE=.01,FIELD_POSITION,SHOW_3D_RENDER=!1,CANVAS_3D_OPACITY=.7,CAMERA_TEST=!1,MOUSE_SENSIBILTY=.03,BALL_Z_FORCE_RANGE={min:3,max:10},INTENSITY_DISPLAY_SHOCK=[{x:30,y:20,time:75},{x:50,
y:25,time:75},{x:70,y:30,time:75},{x:90,y:40,time:75}],CAMERA_POSITION={x:0,y:0,z:100},NEAR=10,FAR=2E3,SOUNDTRACK_VOLUME_IN_GAME=.35;
function CPreloader(){var p,e,n,q,b,c,a,g,k;this._init=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this);s_oSpriteLibrary.addSprite("progress_bar","./sprites/progress_bar.png");s_oSpriteLibrary.addSprite("200x200","./sprites/200x200.jpg");s_oSpriteLibrary.loadSprites();k=new createjs.Container;s_oStage.addChild(k)};this.unload=function(){k.removeAllChildren()};this._onImagesLoaded=function(){};this._onAllImagesLoaded=function(){this.attachSprites();s_oMain.preloaderReady()};
this.attachSprites=function(){var d=new createjs.Shape;d.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);k.addChild(d);d=s_oSpriteLibrary.getSprite("200x200");a=createBitmap(d);a.regX=.5*d.width;a.regY=.5*d.height;a.x=CANVAS_WIDTH/2;a.y=CANVAS_HEIGHT/2-80;k.addChild(a);g=new createjs.Shape;g.graphics.beginFill("rgba(0,0,0,0.01)").drawRoundRect(a.x-100,a.y-100,200,200,10);k.addChild(g);a.mask=g;d=s_oSpriteLibrary.getSprite("progress_bar");q=createBitmap(d);q.x=CANVAS_WIDTH/2-d.width/
2;q.y=CANVAS_HEIGHT/2+70;k.addChild(q);p=d.width;e=d.height;b=new createjs.Shape;b.graphics.beginFill("rgba(0,0,0,0.01)").drawRect(q.x,q.y,1,e);k.addChild(b);q.mask=b;n=new createjs.Text("","30px "+FONT_GAME,"#fff");n.x=CANVAS_WIDTH/2;n.y=CANVAS_HEIGHT/2+120;n.textBaseline="alphabetic";n.textAlign="center";k.addChild(n);c=new createjs.Shape;c.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);k.addChild(c);createjs.Tween.get(c).to({alpha:0},500).call(function(){createjs.Tween.removeTweens(c);
k.removeChild(c)})};this.refreshLoader=function(d){n.text=d+"%";100===d&&(s_oMain._allResourcesLoaded(),n.visible=!1,q.visible=!1);b.graphics.clear();d=Math.floor(d*p/100);b.graphics.beginFill("rgba(0,0,0,0.01)").drawRect(q.x,q.y,d,e)};this._init()}
function CMain(p){var e,n=0,q=0,b=STATE_LOADING,c,a;this.initContainer=function(){var k=document.getElementById("canvas");s_oStage=new createjs.Stage(k);createjs.Touch.enable(s_oStage,!0);s_oStage.preventSelection=!1;s_bMobile=isMobile();!1===s_bMobile?(s_oStage.enableMouseOver(20),FPS=FPS_DESKTOP,FPS_TIME=1/FPS,PHYSICS_STEP=1/(FPS*STEP_RATE),ROLL_BALL_RATE=60/FPS):BALL_VELOCITY_MULTIPLIER=.8;s_iPrevTime=(new Date).getTime();createjs.Ticker.addEventListener("tick",this._update);createjs.Ticker.framerate=
FPS;navigator.userAgent.match(/Windows Phone/i)&&(DISABLE_SOUND_MOBILE=!0);s_oSpriteLibrary=new CSpriteLibrary;seekAndDestroy()?c=new CPreloader:window.location.href="https://www.codethislab.com/contact-us.html";e=!0};this.soundLoaded=function(){n++;c.refreshLoader(Math.floor(n/q*100))};this._initSounds=function(){Howler.mute(!s_bAudioActive);s_aSoundsInfo=[];s_aSoundsInfo.push({path:"./sounds/",filename:"drop_bounce_grass",loop:!1,volume:1,ingamename:"drop_bounce_grass"});s_aSoundsInfo.push({path:"./sounds/",
filename:"click",loop:!1,volume:1,ingamename:"click"});s_aSoundsInfo.push({path:"./sounds/",filename:"goal",loop:!1,volume:1,ingamename:"goal"});s_aSoundsInfo.push({path:"./sounds/",filename:"keep_ball",loop:!1,volume:1,ingamename:"keep_ball"});s_aSoundsInfo.push({path:"./sounds/",filename:"kick",loop:!1,volume:1,ingamename:"kick"});s_aSoundsInfo.push({path:"./sounds/",filename:"win",loop:!1,volume:1,ingamename:"win"});s_aSoundsInfo.push({path:"./sounds/",filename:"soundtrack",loop:!0,volume:1,ingamename:"soundtrack"});
q+=s_aSoundsInfo.length;s_aSounds=[];for(var k=0;k<s_aSoundsInfo.length;k++)this.tryToLoadSound(s_aSoundsInfo[k],!1)};this.tryToLoadSound=function(k,d){setTimeout(function(){s_aSounds[k.ingamename]=new Howl({src:[k.path+k.filename+".mp3"],autoplay:!1,preload:!0,loop:k.loop,volume:k.volume,onload:s_oMain.soundLoaded,onloaderror:function(f,h){for(var m=0;m<s_aSoundsInfo.length;m++)if(f===s_aSounds[s_aSoundsInfo[m].ingamename]._sounds[0]._id){s_oMain.tryToLoadSound(s_aSoundsInfo[m],!0);break}},onplayerror:function(f){for(var h=
0;h<s_aSoundsInfo.length;h++)if(f===s_aSounds[s_aSoundsInfo[h].ingamename]._sounds[0]._id){s_aSounds[s_aSoundsInfo[h].ingamename].once("unlock",function(){s_aSounds[s_aSoundsInfo[h].ingamename].play();"soundtrack"===s_aSoundsInfo[h].ingamename&&null!==s_oGame&&setVolume("soundtrack",SOUNDTRACK_VOLUME_IN_GAME)});break}}})},d?200:0)};this._loadImages=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this);s_oSpriteLibrary.addSprite("but_play","./sprites/but_play.png");s_oSpriteLibrary.addSprite("but_exit",
"./sprites/but_exit.png");s_oSpriteLibrary.addSprite("but_restart_small","./sprites/but_restart_small.png");s_oSpriteLibrary.addSprite("bg_menu","./sprites/bg_menu.jpg");s_oSpriteLibrary.addSprite("bg_game","./sprites/bg_game.jpg");s_oSpriteLibrary.addSprite("msg_box","./sprites/msg_box.png");s_oSpriteLibrary.addSprite("msg_box_small","./sprites/msg_box_small.png");s_oSpriteLibrary.addSprite("audio_icon","./sprites/audio_icon.png");s_oSpriteLibrary.addSprite("but_home","./sprites/but_home.png");s_oSpriteLibrary.addSprite("but_restart",
"./sprites/but_restart.png");s_oSpriteLibrary.addSprite("but_continue_big","./sprites/but_continue_big.png");s_oSpriteLibrary.addSprite("ball","./sprites/ball.png");s_oSpriteLibrary.addSprite("but_level","./sprites/but_level.png");s_oSpriteLibrary.addSprite("bg_game","./sprites/bg_game.jpg");s_oSpriteLibrary.addSprite("gloves","./sprites/gloves.png");s_oSpriteLibrary.addSprite("goal","./sprites/goal.png");s_oSpriteLibrary.addSprite("but_continue","./sprites/but_continue.png");s_oSpriteLibrary.addSprite("but_yes",
"./sprites/but_yes.png");s_oSpriteLibrary.addSprite("but_no","./sprites/but_no.png");s_oSpriteLibrary.addSprite("but_info","./sprites/but_info.png");s_oSpriteLibrary.addSprite("logo_ctl","./sprites/logo_ctl.png");s_oSpriteLibrary.addSprite("but_pause","./sprites/but_pause.png");s_oSpriteLibrary.addSprite("arrow_right","./sprites/arrow_right.png");s_oSpriteLibrary.addSprite("arrow_left","./sprites/arrow_left.png");s_oSpriteLibrary.addSprite("opponent","./sprites/opponent.png");s_oSpriteLibrary.addSprite("ball_shadow",
"./sprites/ball_shadow.png");s_oSpriteLibrary.addSprite("gui_panel","./sprites/gui_panel.png");s_oSpriteLibrary.addSprite("help_mouse","./sprites/help_mouse.png");s_oSpriteLibrary.addSprite("help_touch","./sprites/help_touch.png");s_oSpriteLibrary.addSprite("but_fullscreen","./sprites/but_fullscreen.png");q+=s_oSpriteLibrary.getNumSprites();s_oSpriteLibrary.loadSprites()};this._onImagesLoaded=function(){n++;c.refreshLoader(Math.floor(n/q*100))};this._onAllImagesLoaded=function(){};this.preloaderReady=
function(){this._loadImages();!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||this._initSounds();e=!0};this._allResourcesLoaded=function(){try{saveItem("ls_available","ok")}catch(k){s_bStorageAvailable=!1}c.unload();s_oSoundTrack=playSound("soundtrack",1,!0);this.gotoMenu()};this.gotoMenu=function(){new CMenu(p.ball_to_saved.length);b=STATE_MENU};this.gotoGame=function(k){a=new CGame(g,k);b=STATE_GAME};this.gotoLevelMenu=function(){new CLevelMenu(p.ball_to_saved.length);b=STATE_MENU};this.gotoHelp=function(){new CHelp;
b=STATE_HELP};this.stopUpdate=function(){e=!1;createjs.Ticker.paused=!0;$("#block_game").css("display","block");!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||Howler.mute(!0)};this.startUpdate=function(){s_iPrevTime=(new Date).getTime();e=!0;createjs.Ticker.paused=!1;$("#block_game").css("display","none");(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)&&s_bAudioActive&&Howler.mute(!1)};this._update=function(k){if(!1!==e){var d=(new Date).getTime();s_iTimeElaps=d-s_iPrevTime;s_iCntTime+=s_iTimeElaps;s_iCntFps++;
s_iPrevTime=d;1E3<=s_iCntTime&&(s_iCurFps=s_iCntFps,s_iCntTime-=1E3,s_iCntFps=0);b===STATE_GAME&&a.update();s_oStage.update(k)}};s_oMain=this;var g=p;ENABLE_FULLSCREEN=p.fullscreen;ENABLE_CHECK_ORIENTATION=p.check_orientation;s_bAudioActive=p.audio_enable_on_startup;this.initContainer()}
var s_bMobile,s_bAudioActive=!0,s_bFullscreen=!1,s_bStorageAvailable=!0,s_iCntTime=0,s_iTimeElaps=0,s_iPrevTime=0,s_iCntFps=0,s_iCurFps=0,s_oPhysicsController,s_iLevelReached=18,s_iCanvasResizeHeight,s_iCanvasResizeWidth,s_iCanvasOffsetHeight,s_iCanvasOffsetWidth,s_iAdsLevel=1,s_iLastLevel=1,s_aScores=[],s_oDrawLayer,s_oStage,s_oMain,s_oSpriteLibrary,s_oSoundTrack=null,s_aSounds,s_aSoundsInfo;
function CTextButton(p,e,n,q,b,c,a,g,k){b=void 0===b?FONT_GAME:b;var d,f,h,m,l,r,u,v,x,w,G,N;this._init=function(K,T,L,C,D,H,P,y){d=!1;f=1;l=[];r=[];N=createBitmap(L);h=L.width;m=L.height;w=new createjs.Container;w.x=K;w.y=T;w.regX=L.width/2;w.regY=L.height/2;s_bMobile||(w.cursor="pointer");w.addChild(N,G);k.addChild(w);G=new CTLText(w,0,0,L.width-20,L.height-20,P,y,H,D,1,0,0,C,!0,!1,!1,!1);this._initListener()};this.unload=function(){w.off("mousedown",u);w.off("pressup",v);k.removeChild(w)};this.setVisible=
function(K){w.visible=K};this.setAlign=function(K){G.textAlign=K};this.setTextOffsetX=function(K){G.setOffsetX(K)};this.setTextOffsetY=function(K){G.setOffsetY(K)};this.setScale=function(K){f=w.scaleX=w.scaleY=K};this.enable=function(){d=!1};this.disable=function(){d=!0};this._initListener=function(){u=w.on("mousedown",this.buttonDown);v=w.on("pressup",this.buttonRelease)};this.addEventListener=function(K,T,L){l[K]=T;r[K]=L};this.addEventListenerWithParams=function(K,T,L,C){l[K]=T;r[K]=L;x=C};this.buttonRelease=
function(){d||(playSound("click",1,!1),w.scaleX=f,w.scaleY=f,l[ON_MOUSE_UP]&&l[ON_MOUSE_UP].call(r[ON_MOUSE_UP],x))};this.buttonDown=function(){d||(w.scaleX=.9*f,w.scaleY=.9*f,l[ON_MOUSE_DOWN]&&l[ON_MOUSE_DOWN].call(r[ON_MOUSE_DOWN],x))};this.setPosition=function(K,T){w.x=K;w.y=T};this.tweenPosition=function(K,T,L,C,D,H,P){createjs.Tween.get(w).wait(C).to({x:K,y:T},L,D).call(function(){void 0!==H&&H.call(P)})};this.changeText=function(K){G.refreshText(K)};this.setX=function(K){w.x=K};this.setY=function(K){w.y=
K};this.getContainer=function(){return w};this.getWidth=function(){return h};this.getHeight=function(){return m};this.getX=function(){return w.x};this.getY=function(){return w.y};this.getSprite=function(){return w};this.getScale=function(){return w.scaleX};this._init(p,e,n,q,b,void 0===c?"#fff":c,a,g)}
function CToggle(p,e,n,q,b){var c,a,g,k,d,f,h;this._init=function(m,l,r,u,v){h=void 0!==v?v:s_oStage;a=[];g=[];v=new createjs.SpriteSheet({images:[r],frames:{width:r.width/2,height:r.height,regX:r.width/2/2,regY:r.height/2},animations:{state_true:[0],state_false:[1]}});c=u;f=createSprite(v,"state_"+c,r.width/2/2,r.height/2,r.width/2,r.height);f.x=m;f.y=l;f.stop();s_bMobile||(f.cursor="pointer");h.addChild(f);this._initListener()};this.unload=function(){f.off("mousedown",k);f.off("pressup",d);h.removeChild(f)};
this._initListener=function(){k=f.on("mousedown",this.buttonDown);d=f.on("pressup",this.buttonRelease)};this.addEventListener=function(m,l,r){a[m]=l;g[m]=r};this.setCursorType=function(m){f.cursor=m};this.setActive=function(m){c=m;f.gotoAndStop("state_"+c)};this.buttonRelease=function(){f.scaleX=1;f.scaleY=1;playSound("click",1,!1);c=!c;f.gotoAndStop("state_"+c);a[ON_MOUSE_UP]&&a[ON_MOUSE_UP].call(g[ON_MOUSE_UP],c)};this.buttonDown=function(){f.scaleX=.9;f.scaleY=.9;a[ON_MOUSE_DOWN]&&a[ON_MOUSE_DOWN].call(g[ON_MOUSE_DOWN])};
this.setPosition=function(m,l){f.x=m;f.y=l};this._init(p,e,n,q,b)}
function CGfxButton(p,e,n,q){var b,c,a,g,k,d,f,h,m=!1;this._init=function(u,v,x){b=[];c=[];g=[];a=createBitmap(x);a.x=u;a.y=v;h=f=1;a.regX=x.width/2;a.regY=x.height/2;s_bMobile||(a.cursor="pointer");l.addChild(a);this._initListener()};this.unload=function(){createjs.Tween.removeTweens(a);a.off("mousedown",k);a.off("pressup",d);l.removeChild(a)};this.setVisible=function(u){a.visible=u};this.setCursorType=function(u){a.cursor=u};this._initListener=function(){k=a.on("mousedown",this.buttonDown);d=a.on("pressup",
this.buttonRelease)};this.addEventListener=function(u,v,x){b[u]=v;c[u]=x};this.addEventListenerWithParams=function(u,v,x,w){b[u]=v;c[u]=x;g[u]=w};this.buttonRelease=function(){m||(a.scaleX=0<f?1:-1,a.scaleY=1,playSound("click",1,!1),b[ON_MOUSE_UP]&&b[ON_MOUSE_UP].call(c[ON_MOUSE_UP],g[ON_MOUSE_UP]))};this.buttonDown=function(){m||(a.scaleX=0<f?.9:-.9,a.scaleY=.9,b[ON_MOUSE_DOWN]&&b[ON_MOUSE_DOWN].call(c[ON_MOUSE_DOWN],g[ON_MOUSE_DOWN]))};this.rotation=function(u){a.rotation=u};this.getButton=function(){return a};
this.setPosition=function(u,v){a.x=u;a.y=v};this.setX=function(u){a.x=u};this.setY=function(u){a.y=u};this.getButtonImage=function(){return a};this.block=function(u){m=u;a.scaleX=f;a.scaleY=h};this.setScaleX=function(u){f=a.scaleX=u};this.getX=function(){return a.x};this.getY=function(){return a.y};this.pulseAnimation=function(){createjs.Tween.get(a,{loop:-1}).to({scaleX:.9*f,scaleY:.9*h},850,createjs.Ease.quadOut).to({scaleX:f,scaleY:h},650,createjs.Ease.quadIn)};this.trebleAnimation=function(){createjs.Tween.get(a).to({rotation:5},
75,createjs.Ease.quadOut).to({rotation:-5},140,createjs.Ease.quadIn).to({rotation:0},75,createjs.Ease.quadIn).wait(750).call(function(){r.trebleAnimation()})};this.removeAllTweens=function(){createjs.Tween.removeTweens(a)};var l=void 0!==q?q:s_oStage;this._init(p,e,n);var r=this;return this}
function CMenu(p){var e,n,q,b,c,a,g,k,d,f,h,m,l,r,u=null,v,x=null,w=null;this._init=function(){d=createBitmap(s_oSpriteLibrary.getSprite("bg_menu"));s_oStage.addChild(d);var N=s_oSpriteLibrary.getSprite("but_play");c=CANVAS_WIDTH/2;a=CANVAS_HEIGHT-230;f=new CGfxButton(c,a,N);f.addEventListener(ON_MOUSE_UP,this._onButPlayRelease,this);s_bStorageAvailable&&null!==getItem("LevelReached")?(s_iLastLevel=getItem("LevelReached"),s_aScores=JSON.parse(getItem("Scores")),f.setPosition(CANVAS_WIDTH/2-200,CANVAS_HEIGHT-
230),N=s_oSpriteLibrary.getSprite("but_continue_big"),m=new CGfxButton(CANVAS_WIDTH/2+200,CANVAS_HEIGHT-230,N),m.addEventListener(ON_MOUSE_UP,this._onButContinueRelease,this),m.pulseAnimation()):(f.setPosition(CANVAS_WIDTH/2,584),f.pulseAnimation(),this.resetArrayScores());!1===DISABLE_SOUND_MOBILE||!1===s_bMobile?(N=s_oSpriteLibrary.getSprite("audio_icon"),g=CANVAS_WIDTH-N.height/2-10,k=N.height/2+10,r=new CToggle(g,k,N,s_bAudioActive),r.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this),N=s_oSpriteLibrary.getSprite("but_fullscreen"),
e=g-N.width/2-10,n=k):(N=s_oSpriteLibrary.getSprite("but_fullscreen"),e=CANVAS_WIDTH-N.height/2-10,n=N.height/2+10);var K=s_oSpriteLibrary.getSprite("but_info");q=K.height/2+10;b=K.height/2+10;h=new CGfxButton(q,b,K,s_oStage);h.addEventListener(ON_MOUSE_UP,this._onButInfoRelease,this);K=window.document;var T=K.documentElement;x=T.requestFullscreen||T.mozRequestFullScreen||T.webkitRequestFullScreen||T.msRequestFullscreen;w=K.exitFullscreen||K.mozCancelFullScreen||K.webkitExitFullscreen||K.msExitFullscreen;
!1===ENABLE_FULLSCREEN&&(x=!1);x&&screenfull.isEnabled&&(v=new CToggle(e,n,N,s_bFullscreen,s_oStage),v.addEventListener(ON_MOUSE_UP,this._onFullscreenRelease,this));l=new createjs.Shape;l.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);s_oStage.addChild(l);createjs.Tween.get(l).to({alpha:0},1E3).call(function(){l.visible=!1});s_bStorageAvailable||new CMsgBox(TEXT_ERR_LS,s_oStage);this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.refreshButtonPos=function(N,K){!1!==DISABLE_SOUND_MOBILE&&
!1!==s_bMobile||r.setPosition(g-N,K+k);x&&screenfull.isEnabled&&v.setPosition(e-s_iOffsetX,n+s_iOffsetY);h.setPosition(q+N,b+K)};this.unload=function(){f.unload();f=null;if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)r.unload(),r=null;x&&screenfull.isEnabled&&v.unload();s_oStage.removeAllChildren();s_oMenu=null};this._onButPlayRelease=function(){s_bStorageAvailable&&null!==getItem("LevelReached")?null===u&&(u=new CConfirmPanel(TEXT_RESET,0),u.addEventListener(ON_BUT_NO_DOWN,this._onButNo,this),u.addEventListener(ON_BUT_YES_DOWN,
this._onButYes,this)):(this.unload(),s_oMain.gotoLevelMenu())};this._onButContinueRelease=function(){this.unload();s_oMain.gotoLevelMenu()};this._onButNo=function(){u.unload();u=null};this._onButYes=function(){clearAllItem();this.unload();s_iLastLevel=1;this.resetArrayScores();s_oMain.gotoLevelMenu()};this.resetArrayScores=function(){s_aScores=[];for(var N=0;N<G;N++)s_aScores[N]=0};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._onButInfoRelease=function(){new CCreditsPanel};
this.resetFullscreenBut=function(){x&&screenfull.isEnabled&&v.setActive(s_bFullscreen)};this._onFullscreenRelease=function(){s_bFullscreen?w.call(window.document):x.call(window.document.documentElement);sizeHandler()};s_oMenu=this;var G=p;this._init()}var s_oMenu=null;
function CGame(p,e){var n,q,b,c,a,g=null,k,d=null,f,h=!1,m=!1,l=!1,r=!1,u=!1,v,x,w,G=0,N=0,K=0,T=0,L=0,C,D,H=STATE_INIT,P=null;this._init=function(){this.pause(!0);w=x=0;D=[];v=e;for(var y=0;y<v;y++)x+=s_aScores[y];f=new createjs.Container;s_oStage.addChild(f);s_bMobile&&this.velocityBall();q=createBitmap(s_oSpriteLibrary.getSprite("bg_game"));f.addChild(q);b=new CScenario(v);P=SHOW_3D_RENDER?camera:createOrthoGraphicCamera();y=s_oSpriteLibrary.getSprite("opponent");g=new COpponent(600,480,y,f);y=
s_oSpriteLibrary.getSprite("ball");a=new CBall(0,0,y,b.ballBody(),f);D.push(a);this.ballPosition();resizeCanvas3D();setVolume("soundtrack",SOUNDTRACK_VOLUME_IN_GAME);n=new CInterface;y=s_oSpriteLibrary.getSprite("gloves");c=new CGloves(CANVAS_WIDTH_HALF,CANVAS_HEIGHT_HALF,y,b.getHandKeeperBody(),f);D.push(c);y=s_oSpriteLibrary.getSprite("goal");k=new CGoal(0,0,y,b.getGoalBody(),f);D.push(k);n.refreshBallSaved(G,BALL_TO_SAVED[v]);n.refreshMatchNum(v+1);n.refreshLaunch(K,MATCH_LAUNCH[v]);if(SHOW_3D_RENDER)this.onExitHelp();
else n.createHelpPanel()};this.velocityBall=function(){for(var y=0;y<BALL_FORCE_Y.length;y++)BALL_FORCE_Y[y]*=BALL_VELOCITY_MULTIPLIER,BALL_FORCE_Z[y].min/=BALL_VELOCITY_MULTIPLIER+.1,BALL_FORCE_Z[y].max*=BALL_VELOCITY_MULTIPLIER+.1,BALL_FORCE_X[y]*=BALL_VELOCITY_MULTIPLIER};this.sortDepth=function(y,V){null!==y&&null!==V&&(y.getDepthPos()>V.getDepthPos()?f.getChildIndex(y.getObject())>f.getChildIndex(V.getObject())&&f.swapChildren(y.getObject(),V.getObject()):y.getDepthPos()<V.getDepthPos()&&f.getChildIndex(V.getObject())>
f.getChildIndex(y.getObject())&&f.swapChildren(V.getObject(),y.getObject()))};this.onExitHelp=function(){this.activeEventListeners();this.pause(!1);this.startOpponentShot();n.onExitFromHelp()};this.activeEventListeners=function(){SHOW_3D_RENDER?(window.addEventListener("mousedown",this.addImpulseToBall),window.addEventListener("mousemove",this.onHandKeeper)):null===d&&(d=s_oStage.on("stagemousemove",this.onHandKeeper))};this.deactiveEventListeners=function(){SHOW_3D_RENDER?(window.removeEventListener("mousedown",
this.addImpulseToBall),window.removeEventListener("mousemove",this.onHandKeeper)):(s_oStage.off("stagemousemove",d),d=null)};this.ballPosition=function(){var y=b.ballBody(),V=this.convert3dPosTo2dScreen(y.position,P),E=a.getStartScale()-V.z;this.shadowBall(y,E);a.scale(E);a.setPosition(V.x,V.y)};this.getLevel=function(){return v};this.shadowBall=function(y,V){var E=b.getFieldBody(),R=this.convert3dPosTo2dScreen({x:y.position.x,y:y.position.y,z:E.position.z},P);a.scaleShadow(V/(y.position.z-E.position.z));
a.setAlphaByHeight(.1*(-y.position.z-.1*E.position.z));a.setPositionShadow(R.x,R.y)};this.unload=function(){s_oStage.removeAllChildren();n.unload();b.destroyWorld();b=null;this.deactiveEventListeners()};this.onContinue=function(){this.nextLevel();H=STATE_PLAY;this.resetValues();this.activeEventListeners()};this.resetValues=function(){K=w=T=G=N=0;n.refreshBallSaved(G,BALL_TO_SAVED[v]);n.refreshLaunch(K,MATCH_LAUNCH[v])};this.nextLevel=function(){v++;n.refreshMatchNum(v+1);this.resetScene();$(s_oMain).trigger("start_level",
v);this.startOpponentShot()};this.wallSoundCollision=function(){playSound("ball_collision",1,!1)};this.goal=function(){h||(h=!0,C=TIME_RESET_AFTER_GOAL,n.createAnimText(TEXT_GOAL,80),playSound("goal",1,!1),L=0)};this.keeperSave=function(y){h||m||(y.x>-BALL_SAVED_POINT.x&&y.x<BALL_SAVED_POINT.x&&y.z>-BALL_SAVED_POINT.z&&y.z<BALL_SAVED_POINT.z?(l=!0,a.getPhysics().mass=0,C=TIME_RESET_AFTER_PERFECT_KEEPER_SAVED,T++,c.changeState("perfect"),createjs.Tween.get(f).wait(TIME_BALL_IN_HAND).call(function(){l=
!1;a.getPhysics().mass=BALL_MASS;c.changeState("normal")})):(l=!1,C=TIME_RESET_AFTER_KEEPER_SAVED),createjs.Tween.get(f).wait(300).call(function(){h||s_oGame.textSave()}),m=!0,playSound("kick",.65,!1),playSound("keep_ball",1,!1))};this.addImpulseToBall=function(){if(!r&&H===STATE_PLAY){var y={x:Math.random()*(BALL_FORCE_X[v]+BALL_FORCE_X[v])-BALL_FORCE_X[v],y:-BALL_FORCE_Y[v],z:Math.random()*(BALL_FORCE_Z[v].max-BALL_FORCE_Z[v].min)+BALL_FORCE_Z[v].min},V=b.ballBody();b.addImpulse(V,y);b.setElementAngularVelocity(V,
{x:0,y:0,z:0});r=!0}};this.pause=function(y){y?(H=STATE_PAUSE,null!==g&&g.stopAnimation(),this.deactiveEventListeners()):(H=STATE_PLAY,null!==g&&g.playAnimation(),this.activeEventListeners());createjs.Ticker.paused=y};this.startOpponentShot=function(){g.changeState("shot");g.fadeAnimation(1);g.onFinishAnimation()};this.onExit=function(){this.unload();$(s_oMain).trigger("show_interlevel_ad");$(s_oMain).trigger("end_session");setVolume("soundtrack",1);s_oMain.gotoMenu()};this.restartLevel=function(){this.resetValues();
this.resetScene();this.activeEventListeners();H=STATE_PLAY;this.startOpponentShot();$(s_oMain).trigger("restart_level",v)};this.resetBallPosition=function(){var y=b.ballBody();y.position.set(POSITION_BALL.x,POSITION_BALL.y,POSITION_BALL.z);b.setElementVelocity(y,{x:0,y:0,z:0});b.setElementAngularVelocity(y,{x:0,y:0,z:0});a.fadeAnimation(1,500,0)};this.ballFadeForReset=function(){if(h||m){var y=1E3;h&&(y=100);u||(a.fadeAnimation(0,300,y),u=!0)}};this._updateInit=function(){b.update();this._updateBall2DPosition();
H=STATE_PLAY};this.onHandKeeper=function(y){var V=b.getHandKeeperBody();y=SHOW_3D_RENDER?{x:y.clientX-s_iCanvasOffsetWidth,y:y.clientY-s_iCanvasOffsetHeight}:{x:y.stageX/s_fInverseScaling,y:y.stageY/s_fInverseScaling};s_bMobile&&(y.x+=MOBILE_OFFSET_GLOVES_X);y=s_oGame.convert2dScreenPosTo3d(y,V);V.position.x=y.x<LIMIT_HAND_RANGE_POS.x&&y.x>-LIMIT_HAND_RANGE_POS.x?y.x:y.x<LIMIT_HAND_RANGE_POS.x?-LIMIT_HAND_RANGE_POS.x:LIMIT_HAND_RANGE_POS.x;V.position.z=y.z>LIMIT_HAND_RANGE_POS.zMin&&y.z<LIMIT_HAND_RANGE_POS.zMax?
y.z:y.z>LIMIT_HAND_RANGE_POS.zMin?LIMIT_HAND_RANGE_POS.zMax:LIMIT_HAND_RANGE_POS.zMin;y=s_oGame.convert3dPosTo2dScreen(V.position,P);c.setPosition(y.x,y.y);l&&s_oGame.ballInHand(V.position)};this.ballInHand=function(y){var V=b.ballBody();V.position.x=y.x;V.position.y=y.y+.7*BALL_RADIUS;V.position.z=y.z;y=this.convert3dPosTo2dScreen(V.position,P);var E=a.getStartScale()-y.z;this.shadowBall(V,E);a.scale(a.getStartScale()-y.z);a.setPosition(y.x,y.y)};this.convert2dScreenPosTo3d=function(y){y=new THREE.Vector3(y.x/
s_iCanvasResizeWidth*2-1,2*-(y.y/s_iCanvasResizeHeight)+1,-1);y.unproject(P);y.sub(P.position);y.normalize();y.multiply(new THREE.Vector3(34,1,34));return y};this.convert3dPosTo2dScreen=function(y,V){var E=(new THREE.Vector3(y.x,y.y,y.z)).project(V),R=.5*Math.floor(s_iCanvasResizeWidth),M=.5*Math.floor(s_iCanvasResizeHeight);E.x=(E.x*R+R)*s_fInverseScaling;E.y=(-(E.y*M)+M)*s_fInverseScaling;return E};this.timeReset=function(){0<C?C-=FPS_TIME:(h?N++:(G++,n.refreshBallSaved(G,BALL_TO_SAVED[v])),K++,
n.refreshLaunch(K,MATCH_LAUNCH[v]),K<MATCH_LAUNCH[v]?(this.resetScene(),u=!1,this.startOpponentShot()):(this.matchResult(),H=STATE_FINISH,$(s_oMain).trigger("end_level",v),this.deactiveEventListeners()),r=!1)};this.textSave=function(){if(L<TEXT_CONGRATULATION.length){var y=!1;L>=TEXT_CONGRATULATION.length-1&&(y=!0);n.createAnimText(TEXT_CONGRATULATION[L],TEXT_SIZE[L],y);L++}else{y=!1;var V=Math.floor(Math.random()*(TEXT_CONGRATULATION.length-1))+1;V>=TEXT_CONGRATULATION.length-1&&(y=!0);n.createAnimText(TEXT_CONGRATULATION[V],
TEXT_SIZE[V],y)}};this.matchResult=function(){G>=BALL_TO_SAVED[v]?this.wonMatch():this.lostMatch()};this.goalAnimation=function(y){500<y&&1E3>y?this.displayShock(INTENSITY_DISPLAY_SHOCK[0].time,INTENSITY_DISPLAY_SHOCK[0].x,INTENSITY_DISPLAY_SHOCK[0].y):999<y&&2E3>y?this.displayShock(INTENSITY_DISPLAY_SHOCK[1].time,INTENSITY_DISPLAY_SHOCK[1].x,INTENSITY_DISPLAY_SHOCK[1].y):1999<y&&3E3>y?this.displayShock(INTENSITY_DISPLAY_SHOCK[2].time,INTENSITY_DISPLAY_SHOCK[2].x,INTENSITY_DISPLAY_SHOCK[2].y):2999<
y&&this.displayShock(INTENSITY_DISPLAY_SHOCK[3].time,INTENSITY_DISPLAY_SHOCK[3].x,INTENSITY_DISPLAY_SHOCK[3].y)};this.displayShock=function(y,V,E){createjs.Tween.get(f).to({x:Math.round(Math.random()*V),y:Math.round(Math.random()*E)},y).call(function(){createjs.Tween.get(f).to({x:Math.round(Math.random()*V*.8),y:-Math.round(Math.random()*E*.8)},y).call(function(){createjs.Tween.get(f).to({x:Math.round(Math.random()*V*.6),y:Math.round(Math.random()*E*.6)},y).call(function(){createjs.Tween.get(f).to({x:Math.round(Math.random()*
V*.4),y:-Math.round(Math.random()*E*.4)},y).call(function(){createjs.Tween.get(f).to({x:Math.round(Math.random()*V*.2),y:Math.round(Math.random()*E*.2)},y).call(function(){createjs.Tween.get(f).to({y:0,x:0},y).call(function(){})})})})})})};this.wonMatch=function(){var y=!1;v>=MATCH_LAUNCH.length-1&&(y=!0);var V=this.calculateNewScore();x=V.new_score;this.saveProgress();n.createWinPanel(G,T,BALL_TO_SAVED[v],V,y);playSound("win",1,!1)};this.lostMatch=function(){n.createLosePanel(G,BALL_TO_SAVED[v]);
playSound("goal",1,!1)};this.calculateNewScore=function(){var y={score:x,ball_saved:0,ball_saved_perfect:0,opponent_goal:0,new_score:0};y.ball_saved=G*SCORE_BALL_SAVED;y.ball_saved_perfect=T*SCORE_PERFECT_BALL_SAVED;y.opponent_goal=N*SCORE_GOAL_OPPONENT;w=y.ball_saved+y.opponent_goal+y.ball_saved_perfect;y.new_score=y.score+w;0>y.new_score&&(y.new_score=0);return y};this.saveProgress=function(){s_iLastLevel<v+2&&(s_iLastLevel=v+2);w>s_aScores[v]&&(s_aScores[v]=w);saveItem("LevelReached",s_iLastLevel);
saveItem("Scores",JSON.stringify(s_aScores))};this.resetScene=function(){m=h=!1;this.resetBallPosition()};this._onEnd=function(){this.onExit()};this.swapChildrenIndex=function(){for(var y=0;y<D.length-1;y++)for(var V=y+1;V<D.length;V++)this.sortDepth(D[y],D[V])};this.rotateGuantes=function(){var y=(c.getX()-CANVAS_WIDTH_HALF)*HAND_KEEPER_ANGLE_RATE;c.setRotation(y)};this._updatePlay=function(){for(var y=0;y<PHYSICS_ACCURACY;y++)b.update();this._updateBall2DPosition();(m||h)&&this.timeReset();this.rotateGuantes();
this.swapChildrenIndex()};this.update=function(){switch(H){case STATE_INIT:this._updateInit();break;case STATE_PLAY:this._updatePlay()}};this._updateBall2DPosition=function(){l||(this.ballPosition(),a.rolls());P.updateProjectionMatrix();P.updateMatrixWorld()};s_oGame=this;BALL_TO_SAVED=p.ball_to_saved;BALL_FORCE_X=p.ball_force_left_right;BALL_FORCE_Z=p.ball_force_up;BALL_FORCE_Y=p.ball_force_velocity;MATCH_LAUNCH=p.max_launch;SCORE_PERFECT_BALL_SAVED=p.score_perfect_ball_saved;SCORE_BALL_SAVED=p.score_ball_saved;
SCORE_GOAL_OPPONENT=p.score_goal_opponent;BALL_SAVED_POINT=p.perfect_ball_saved_point;NUM_LEVEL_FOR_ADS=p.num_levels_for_ads;this._init()}var s_oGame;
function CInterface(){var p,e,n,q,b,c,a,g,k,d,f,h,m,l,r,u,v,x,w,G=null,N,K,T,L=null,C=null,D,H,P=null,y=null,V;this._init=function(){a=0;N=createBitmap(s_oSpriteLibrary.getSprite("gui_panel"));s_oStage.addChild(N);g=10;k=28;T=new CTLText(s_oStage,g,k,200,64,32,"center","#fff",FONT_GAME,1,0,0,TEXT_MATCH+"\n0",!0,!0,!0,!1);d=260;f=28;w=new CTLText(s_oStage,d,f,200,64,32,"center","#fff",FONT_GAME,1,0,0,TEXT_LAUNCH+"\n0",!0,!0,!0,!1);h=CANVAS_WIDTH/2-120;m=28;x=new CTLText(s_oStage,h,m,200,64,32,"center",
"#fff",FONT_GAME,1,0,0,TEXT_SCORE_BALL_SAVED+"\n0",!0,!0,!0,!1);var E=s_oSpriteLibrary.getSprite("but_exit");n=CANVAS_WIDTH-E.height/2-10;q=E.height/2+10;u=new CGfxButton(n,q,E);u.addEventListener(ON_MOUSE_UP,this._onExit,this);E=s_oSpriteLibrary.getSprite("but_pause");p=n-E.height-10;e=q;v=new CGfxButton(p,e,E);v.addEventListener(ON_MOUSE_UP,this.onButPauseRelease,this);!1===DISABLE_SOUND_MOBILE||!1===s_bMobile?(E=s_oSpriteLibrary.getSprite("audio_icon"),l=p-E.height-10,r=q,K=new CToggle(l,r,E,s_bAudioActive),
K.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this),E=s_oSpriteLibrary.getSprite("but_fullscreen"),b=l-E.width/2-10,c=r):(b=p-E.height-10,c=q);E=window.document;var R=E.documentElement;P=R.requestFullscreen||R.mozRequestFullScreen||R.webkitRequestFullScreen||R.msRequestFullscreen;y=E.exitFullscreen||E.mozCancelFullScreen||E.webkitExitFullscreen||E.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(P=!1);P&&screenfull.isEnabled&&(E=s_oSpriteLibrary.getSprite("but_fullscreen"),H=new CToggle(b,c,E,s_bFullscreen,
s_oStage),H.addEventListener(ON_MOUSE_UP,this._onFullscreenRelease,this));this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.refreshButtonPos=function(E,R){u.setPosition(n-E,R+q);v.setPosition(p-E,R+e);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||K.setPosition(l-E,R+r);P&&screenfull.isEnabled&&H.setPosition(b-s_iOffsetX,c+s_iOffsetY);N.y=a+R;x.setX(h+E);x.setY(m+R);w.setX(d+E);w.setY(f+R);T.setX(g+E);T.setY(k+R)};this.unload=function(){u.unload();u=null;this.onExitFromHelp();if(!1===DISABLE_SOUND_MOBILE||
!1===s_bMobile)K.unload(),K=null;P&&screenfull.isEnabled&&H.unload();s_oInterface=null};this.refreshBallSaved=function(E,R){x.refreshText(TEXT_SCORE_BALL_SAVED+"\n"+E+" "+TEXT_OF+" "+R)};this.refreshLaunch=function(E,R){w.refreshText(TEXT_LAUNCH+"\n"+E+" "+TEXT_OF+" "+R)};this.onExitFromHelp=function(){null!==G&&(G.unload(),G=null)};this.createLosePanel=function(E,R){C=new CLosePanel(s_oSpriteLibrary.getSprite("msg_box"));C.show(E,R)};this.createWinPanel=function(E,R,M,A,B){L=new CWinPanel(s_oSpriteLibrary.getSprite("msg_box"),
B);L.show(E,R,M,A)};this.createHelpPanel=function(){createjs.Ticker.paused=!1;G=new CHelpPanel(0,0,s_oSpriteLibrary.getSprite("msg_box"))};this.createAnimText=function(E,R,M){var A=new createjs.Container,B=new createjs.Text(E,R+"px "+SECONDARY_FONT,"#000000");B.x=0;B.y=0;B.textAlign="center";B.outline=3;A.addChild(B);var t=new createjs.Text(B.text,R+"px "+SECONDARY_FONT,"#ffffff");t.x=0;t.y=0;t.textAlign="center";A.addChild(t);A.x=CANVAS_WIDTH_HALF;A.y=-B.getBounds().height;M&&s_oInterface.strobeText(t);
s_oStage.addChild(A);createjs.Tween.get(A).to({y:CANVAS_HEIGHT_HALF},500,createjs.Ease.cubicOut).call(function(){createjs.Tween.get(A).wait(250).to({y:CANVAS_HEIGHT+B.getBounds().height},500,createjs.Ease.cubicIn).call(function(){M&&createjs.Tween.removeTweens(t);s_oStage.removeChild(A)})})};this.strobeText=function(E){createjs.Tween.get(E).wait(30).call(function(){V<TEXT_EXCELLENT_COLOR.length-1?V++:V=0;E.color=TEXT_EXCELLENT_COLOR[V];s_oInterface.strobeText(E)})};this.createExtendedTimeText=function(){var E=
new createjs.Container,R=new createjs.Text(TEXT_TIE,"50px "+FONT_GAME,"#000000");R.x=0;R.y=0;R.textAlign="center";R.outline=5;E.addChild(R);var M=new createjs.Text(R.text,"50px "+FONT_GAME,"#ffffff");M.x=0;M.y=0;M.textAlign="center";E.addChild(M);E.x=-R.getBounds().width;E.y=.5*CANVAS_HEIGHT;s_oStage.addChild(E);createjs.Tween.get(E).to({x:.5*CANVAS_WIDTH},750,createjs.Ease.cubicOut).call(function(){createjs.Tween.get(E).to({x:CANVAS_WIDTH+R.getBounds().width},750,createjs.Ease.cubicIn).call(function(){s_oGame.extendLaunch();
s_oStage.removeChild(E)})})};this.refreshMatchNum=function(E){T.refreshText(TEXT_MATCH+"\n"+E)};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._onExit=function(){(new CAreYouSurePanel(s_oStage)).show()};this.unloadPause=function(){D.unload();D=null};this.onButPauseRelease=function(){D=new CPause};this.resetFullscreenBut=function(){P&&screenfull.isEnabled&&H.setActive(s_bFullscreen)};this._onFullscreenRelease=function(){s_bFullscreen?y.call(window.document):
P.call(window.document.documentElement);sizeHandler()};s_oInterface=this;this._init();return this}var s_oInterface=null;
function CHelpPanel(p,e,n){var q,b,c,a,g,k,d=!1,f;this._init=function(h,m,l){c=new createjs.Container;c.x=h;c.y=m;s_oStage.addChild(c);b=new createjs.Shape;b.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);b.alpha=.5;c.addChild(b);q=createBitmap(l);q.x=CANVAS_WIDTH_HALF;q.y=CANVAS_HEIGHT_HALF;q.regX=.5*l.width;q.regY=.5*l.height;c.addChild(q);new CTLText(c,CANVAS_WIDTH/2-l.width/2+20,CANVAS_HEIGHT_HALF-240,l.width-40,100,50,"center",TEXT_COLOR,FONT_GAME,1,0,0,TEXT_HOW_TO_PLAY,
!0,!0,!0,!1);k=new createjs.Container;h=s_oSpriteLibrary.getSprite("gloves");g=new CGloves(CANVAS_WIDTH_HALF,306,h,null,k);g.changeState("perfect");s_bMobile?(h=TEXT_HELP1_MOBILE,m="help_touch"):(h=TEXT_HELP1_PC,m="help_mouse");m=s_oSpriteLibrary.getSprite(m);f=createBitmap(m);f.x=CANVAS_WIDTH_HALF+6;f.y=320;f.regX=.5*m.width;f.regY=.5*m.height;k.addChild(f);c.addChild(k);this.animGloves();new CTLText(c,CANVAS_WIDTH/2-l.width/2+20,CANVAS_HEIGHT_HALF+34,l.width-40,64,32,"center",TEXT_COLOR,FONT_GAME,
1,0,0,h,!0,!0,!0,!1);l=s_oSpriteLibrary.getSprite("but_continue");a=new CGfxButton(CANVAS_WIDTH/2,CANVAS_HEIGHT_HALF+180,l,c);a.addEventListener(ON_MOUSE_UP,this._onExitHelp,this);a.pulseAnimation();var r=this;c.on("pressup",function(){r._onExitHelp()})};this.animGloves=function(){var h=this;createjs.Tween.get(k).to({x:100},1E3,createjs.Ease.cubicInOut).call(function(){createjs.Tween.get(k).to({x:-100},1E3,createjs.Ease.cubicInOut).call(function(){h.animGloves()})})};this.unload=function(){createjs.Tween.get(c).to({alpha:0},
500,createjs.Ease.cubicIn).call(function(){s_oStage.removeChild(c)});var h=this;createjs.Tween.removeTweens(k);c.off("pressup",function(){h._onExitHelp()})};this._onExitHelp=function(){d||(d=!0,this.unload(),s_oGame.onExitHelp())};this._init(p,e,n)}
!function(p){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=p();else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self);e.CANNON=p()}}(function(){return function b(e,n,q){function c(k,d){if(!n[k]){if(!e[k]){var f="function"==typeof require&&require;if(!d&&f)return f(k,!0);if(a)return a(k,!0);throw Error("Cannot find module '"+k+"'");}f=n[k]={exports:{}};e[k][0].call(f.exports,function(h){var m=e[k][1][h];return c(m?
m:h)},f,f.exports,b,e,n,q)}return n[k].exports}for(var a="function"==typeof require&&require,g=0;g<q.length;g++)c(q[g]);return c}({1:[function(e,n,q){n.exports={name:"cannon",version:"0.6.2",description:"A lightweight 3D physics engine written in JavaScript.",homepage:"https://github.com/schteppe/cannon.js",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["cannon.js","cannon","physics","engine","3d"],main:"./build/cannon.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/cannon.js.git"},
bugs:{url:"https://github.com/schteppe/cannon.js/issues"},licenses:[{type:"MIT"}],devDependencies:{jshint:"latest","uglify-js":"latest",nodeunit:"^0.9.0",grunt:"~0.4.0","grunt-contrib-jshint":"~0.1.1","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-concat":"~0.1.3","grunt-contrib-uglify":"^0.5.1","grunt-browserify":"^2.1.4","grunt-contrib-yuidoc":"^0.5.2",browserify:"*"},dependencies:{}}},{}],2:[function(e,n,q){n.exports={version:e("../package.json").version,AABB:e("./collision/AABB"),ArrayCollisionMatrix:e("./collision/ArrayCollisionMatrix"),
Body:e("./objects/Body"),Box:e("./shapes/Box"),Broadphase:e("./collision/Broadphase"),Constraint:e("./constraints/Constraint"),ContactEquation:e("./equations/ContactEquation"),Narrowphase:e("./world/Narrowphase"),ConeTwistConstraint:e("./constraints/ConeTwistConstraint"),ContactMaterial:e("./material/ContactMaterial"),ConvexPolyhedron:e("./shapes/ConvexPolyhedron"),Cylinder:e("./shapes/Cylinder"),DistanceConstraint:e("./constraints/DistanceConstraint"),Equation:e("./equations/Equation"),EventTarget:e("./utils/EventTarget"),
FrictionEquation:e("./equations/FrictionEquation"),GSSolver:e("./solver/GSSolver"),GridBroadphase:e("./collision/GridBroadphase"),Heightfield:e("./shapes/Heightfield"),HingeConstraint:e("./constraints/HingeConstraint"),LockConstraint:e("./constraints/LockConstraint"),Mat3:e("./math/Mat3"),Material:e("./material/Material"),NaiveBroadphase:e("./collision/NaiveBroadphase"),ObjectCollisionMatrix:e("./collision/ObjectCollisionMatrix"),Pool:e("./utils/Pool"),Particle:e("./shapes/Particle"),Plane:e("./shapes/Plane"),
PointToPointConstraint:e("./constraints/PointToPointConstraint"),Quaternion:e("./math/Quaternion"),Ray:e("./collision/Ray"),RaycastVehicle:e("./objects/RaycastVehicle"),RaycastResult:e("./collision/RaycastResult"),RigidVehicle:e("./objects/RigidVehicle"),RotationalEquation:e("./equations/RotationalEquation"),RotationalMotorEquation:e("./equations/RotationalMotorEquation"),SAPBroadphase:e("./collision/SAPBroadphase"),SPHSystem:e("./objects/SPHSystem"),Shape:e("./shapes/Shape"),Solver:e("./solver/Solver"),
Sphere:e("./shapes/Sphere"),SplitSolver:e("./solver/SplitSolver"),Spring:e("./objects/Spring"),Trimesh:e("./shapes/Trimesh"),Vec3:e("./math/Vec3"),Vec3Pool:e("./utils/Vec3Pool"),World:e("./world/World")}},{"../package.json":1,"./collision/AABB":3,"./collision/ArrayCollisionMatrix":4,"./collision/Broadphase":5,"./collision/GridBroadphase":6,"./collision/NaiveBroadphase":7,"./collision/ObjectCollisionMatrix":8,"./collision/Ray":9,"./collision/RaycastResult":10,"./collision/SAPBroadphase":11,"./constraints/ConeTwistConstraint":12,
"./constraints/Constraint":13,"./constraints/DistanceConstraint":14,"./constraints/HingeConstraint":15,"./constraints/LockConstraint":16,"./constraints/PointToPointConstraint":17,"./equations/ContactEquation":19,"./equations/Equation":20,"./equations/FrictionEquation":21,"./equations/RotationalEquation":22,"./equations/RotationalMotorEquation":23,"./material/ContactMaterial":24,"./material/Material":25,"./math/Mat3":27,"./math/Quaternion":28,"./math/Vec3":30,"./objects/Body":31,"./objects/RaycastVehicle":32,
"./objects/RigidVehicle":33,"./objects/SPHSystem":34,"./objects/Spring":35,"./shapes/Box":37,"./shapes/ConvexPolyhedron":38,"./shapes/Cylinder":39,"./shapes/Heightfield":40,"./shapes/Particle":41,"./shapes/Plane":42,"./shapes/Shape":43,"./shapes/Sphere":44,"./shapes/Trimesh":45,"./solver/GSSolver":46,"./solver/Solver":47,"./solver/SplitSolver":48,"./utils/EventTarget":49,"./utils/Pool":51,"./utils/Vec3Pool":54,"./world/Narrowphase":55,"./world/World":56}],3:[function(e,n,q){function b(k){k=k||{};
this.lowerBound=new c;k.lowerBound&&this.lowerBound.copy(k.lowerBound);this.upperBound=new c;k.upperBound&&this.upperBound.copy(k.upperBound)}var c=e("../math/Vec3");e("../utils/Utils");n.exports=b;var a=new c;b.prototype.setFromPoints=function(k,d,f,h){var m=this.lowerBound,l=this.upperBound;m.copy(k[0]);f&&f.vmult(m,m);l.copy(m);for(var r=1;r<k.length;r++){var u=k[r];f&&(f.vmult(u,a),u=a);u.x>l.x&&(l.x=u.x);u.x<m.x&&(m.x=u.x);u.y>l.y&&(l.y=u.y);u.y<m.y&&(m.y=u.y);u.z>l.z&&(l.z=u.z);u.z<m.z&&(m.z=
u.z)}d&&(d.vadd(m,m),d.vadd(l,l));h&&(m.x-=h,m.y-=h,m.z-=h,l.x+=h,l.y+=h,l.z+=h);return this};b.prototype.copy=function(k){this.lowerBound.copy(k.lowerBound);this.upperBound.copy(k.upperBound);return this};b.prototype.clone=function(){return(new b).copy(this)};b.prototype.extend=function(k){var d=k.lowerBound.x;this.lowerBound.x>d&&(this.lowerBound.x=d);d=k.upperBound.x;this.upperBound.x<d&&(this.upperBound.x=d);d=k.lowerBound.y;this.lowerBound.y>d&&(this.lowerBound.y=d);d=k.upperBound.y;this.upperBound.y<
d&&(this.upperBound.y=d);d=k.lowerBound.z;this.lowerBound.z>d&&(this.lowerBound.z=d);d=k.upperBound.z;this.upperBound.z<d&&(this.upperBound.z=d)};b.prototype.overlaps=function(k){var d=this.lowerBound,f=this.upperBound,h=k.lowerBound;k=k.upperBound;return(h.x<=f.x&&f.x<=k.x||d.x<=k.x&&k.x<=f.x)&&(h.y<=f.y&&f.y<=k.y||d.y<=k.y&&k.y<=f.y)&&(h.z<=f.z&&f.z<=k.z||d.z<=k.z&&k.z<=f.z)};b.prototype.contains=function(k){var d=this.lowerBound,f=this.upperBound,h=k.lowerBound;k=k.upperBound;return d.x<=h.x&&
f.x>=k.x&&d.y<=h.y&&f.y>=k.y&&d.z<=h.z&&f.z>=k.z};b.prototype.getCorners=function(k,d,f,h,m,l,r,u){var v=this.lowerBound,x=this.upperBound;k.copy(v);d.set(x.x,v.y,v.z);f.set(x.x,x.y,v.z);h.set(v.x,x.y,x.z);m.set(x.x,v.y,v.z);l.set(v.x,x.y,v.z);r.set(v.x,v.y,x.z);u.copy(x)};var g=[new c,new c,new c,new c,new c,new c,new c,new c];b.prototype.toLocalFrame=function(k,d){this.getCorners(g[0],g[1],g[2],g[3],g[4],g[5],g[6],g[7]);for(var f=0;8!==f;f++){var h=g[f];k.pointToLocal(h,h)}return d.setFromPoints(g)};
b.prototype.toWorldFrame=function(k,d){this.getCorners(g[0],g[1],g[2],g[3],g[4],g[5],g[6],g[7]);for(var f=0;8!==f;f++){var h=g[f];k.pointToWorld(h,h)}return d.setFromPoints(g)}},{"../math/Vec3":30,"../utils/Utils":53}],4:[function(e,n,q){function b(){this.matrix=[]}n.exports=b;b.prototype.get=function(c,a){c=c.index;a=a.index;if(a>c){var g=a;a=c;c=g}return this.matrix[(c*(c+1)>>1)+a-1]};b.prototype.set=function(c,a,g){c=c.index;a=a.index;if(a>c){var k=a;a=c;c=k}this.matrix[(c*(c+1)>>1)+a-1]=g?1:0};
b.prototype.reset=function(){for(var c=0,a=this.matrix.length;c!==a;c++)this.matrix[c]=0};b.prototype.setNumObjects=function(c){this.matrix.length=c*(c-1)>>1}},{}],5:[function(e,n,q){function b(){this.world=null;this.useBoundingBoxes=!1;this.dirty=!0}var c=e("../objects/Body");q=e("../math/Vec3");var a=e("../math/Quaternion");e("../shapes/Shape");e("../shapes/Plane");n.exports=b;b.prototype.collisionPairs=function(l,r,u){throw Error("collisionPairs not implemented for this BroadPhase class!");};var g=
c.STATIC|c.KINEMATIC;b.prototype.needBroadphaseCollision=function(l,r){return 0!==(l.collisionFilterGroup&r.collisionFilterMask)&&0!==(r.collisionFilterGroup&l.collisionFilterMask)&&(0===(l.type&g)&&l.sleepState!==c.SLEEPING||0===(r.type&g)&&r.sleepState!==c.SLEEPING)?!0:!1};b.prototype.intersectionTest=function(l,r,u,v){this.useBoundingBoxes?this.doBoundingBoxBroadphase(l,r,u,v):this.doBoundingSphereBroadphase(l,r,u,v)};var k=new q;new q;new a;new q;b.prototype.doBoundingSphereBroadphase=function(l,
r,u,v){r.position.vsub(l.position,k);var x=Math.pow(l.boundingRadius+r.boundingRadius,2);k.norm2()<x&&(u.push(l),v.push(r))};b.prototype.doBoundingBoxBroadphase=function(l,r,u,v){l.aabbNeedsUpdate&&l.computeAABB();r.aabbNeedsUpdate&&r.computeAABB();l.aabb.overlaps(r.aabb)&&(u.push(l),v.push(r))};var d={keys:[]},f=[],h=[];b.prototype.makePairsUnique=function(l,r){for(var u=l.length,v=0;v!==u;v++)f[v]=l[v],h[v]=r[v];l.length=0;for(v=r.length=0;v!==u;v++){var x=f[v].id,w=h[v].id;x=x<w?x+","+w:w+","+
x;d[x]=v;d.keys.push(x)}for(v=0;v!==d.keys.length;v++)x=d.keys.pop(),u=d[x],l.push(f[u]),r.push(h[u]),delete d[x]};b.prototype.setWorld=function(l){};var m=new q;b.boundingSphereCheck=function(l,r){l.position.vsub(r.position,m);return Math.pow(l.shape.boundingSphereRadius+r.shape.boundingSphereRadius,2)>m.norm2()};b.prototype.aabbQuery=function(l,r,u){console.warn(".aabbQuery is not implemented in this Broadphase subclass.");return[]}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,
"../shapes/Plane":42,"../shapes/Shape":43}],6:[function(e,n,q){function b(d,f,h,m,l){c.apply(this);this.nx=h||10;this.ny=m||10;this.nz=l||10;this.aabbMin=d||new a(100,100,100);this.aabbMax=f||new a(-100,-100,-100);d=this.nx*this.ny*this.nz;if(0>=d)throw"GridBroadphase: Each dimension's n must be >0";this.bins=[];this.binLengths=[];this.bins.length=d;this.binLengths.length=d;for(f=0;f<d;f++)this.bins[f]=[],this.binLengths[f]=0}n.exports=b;var c=e("./Broadphase"),a=e("../math/Vec3"),g=e("../shapes/Shape");
b.prototype=new c;b.prototype.constructor=b;var k=new a;new a;b.prototype.collisionPairs=function(d,f,h){function m(qa,aa,ca,da,ta,va,ua){qa=(qa-C)*P|0;aa=(aa-D)*y|0;ca=(ca-H)*V|0;da=z((da-C)*P);ta=z((ta-D)*y);va=z((va-H)*V);0>qa?qa=0:qa>=v&&(qa=v-1);0>aa?aa=0:aa>=x&&(aa=x-1);0>ca?ca=0:ca>=w&&(ca=w-1);0>da?da=0:da>=v&&(da=v-1);0>ta?ta=0:ta>=x&&(ta=x-1);0>va?va=0:va>=w&&(va=w-1);qa*=G;aa*=N;ca*=1;da*=G;ta*=N;for(va*=1;qa<=da;qa+=G)for(var Ca=aa;Ca<=ta;Ca+=N)for(var Sa=ca;Sa<=va;Sa+=1){var Ua=qa+Ca+
Sa;B[Ua][t[Ua]++]=ua}}var l=d.numObjects();d=d.bodies;var r=this.aabbMax,u=this.aabbMin,v=this.nx,x=this.ny,w=this.nz,G=x*w,N=w,K=r.x,T=r.y,L=r.z,C=u.x,D=u.y,H=u.z,P=v/(K-C),y=x/(T-D),V=w/(L-H);K=(K-C)/v;var E=(T-D)/x;L=(L-H)/w;var R=.5*Math.sqrt(K*K+E*E+L*L);T=g.types;var M=T.SPHERE,A=T.PLANE,B=this.bins,t=this.binLengths;T=this.bins.length;for(u=0;u!==T;u++)t[u]=0;var z=Math.ceil;u=Math.min;r=Math.max;for(u=0;u!==l;u++){r=d[u];var J=r.shape;switch(J.type){case M:var I=r.position.x,Q=r.position.y,
F=r.position.z;J=J.radius;m(I-J,Q-J,F-J,I+J,Q+J,F+J,r);break;case A:J.worldNormalNeedsUpdate&&J.computeWorldNormal(r.quaternion);F=J.worldNormal;J=D+.5*E-r.position.y;var U=H+.5*L-r.position.z,Z=k;Z.set(C+.5*K-r.position.x,J,U);for(var S=I=0;I!==v;I++,S+=G,Z.y=J,Z.x+=K)for(var W=Q=0;Q!==x;Q++,W+=N,Z.z=U,Z.y+=E)for(var ma=0,ja=0;ma!==w;ma++,ja+=1,Z.z+=L)if(Z.dot(F)<R){var fa=S+W+ja;B[fa][t[fa]++]=r}break;default:r.aabbNeedsUpdate&&r.computeAABB(),m(r.aabb.lowerBound.x,r.aabb.lowerBound.y,r.aabb.lowerBound.z,
r.aabb.upperBound.x,r.aabb.upperBound.y,r.aabb.upperBound.z,r)}}for(u=0;u!==T;u++)if(l=t[u],1<l)for(d=B[u],I=0;I!==l;I++)for(r=d[I],Q=0;Q!==I;Q++)K=d[Q],this.needBroadphaseCollision(r,K)&&this.intersectionTest(r,K,f,h);this.makePairsUnique(f,h)}},{"../math/Vec3":30,"../shapes/Shape":43,"./Broadphase":5}],7:[function(e,n,q){function b(){c.apply(this)}n.exports=b;var c=e("./Broadphase");e=e("./AABB");b.prototype=new c;b.prototype.constructor=b;b.prototype.collisionPairs=function(a,g,k){a=a.bodies;var d=
a.length,f,h;for(f=0;f!==d;f++)for(h=0;h!==f;h++){var m=a[f];var l=a[h];this.needBroadphaseCollision(m,l)&&this.intersectionTest(m,l,g,k)}};new e;b.prototype.aabbQuery=function(a,g,k){k=k||[];for(var d=0;d<a.bodies.length;d++){var f=a.bodies[d];f.aabbNeedsUpdate&&f.computeAABB();f.aabb.overlaps(g)&&k.push(f)}return k}},{"./AABB":3,"./Broadphase":5}],8:[function(e,n,q){function b(){this.matrix={}}n.exports=b;b.prototype.get=function(c,a){c=c.id;a=a.id;if(a>c){var g=a;a=c;c=g}return c+"-"+a in this.matrix};
b.prototype.set=function(c,a,g){c=c.id;a=a.id;if(a>c){var k=a;a=c;c=k}g?this.matrix[c+"-"+a]=!0:delete this.matrix[c+"-"+a]};b.prototype.reset=function(){this.matrix={}};b.prototype.setNumObjects=function(c){}},{}],9:[function(e,n,q){function b(B,t){this.from=B?B.clone():new a;this.to=t?t.clone():new a;this._direction=new a;this.precision=1E-4;this.checkCollisionResponse=!0;this.skipBackfaces=!1;this.collisionFilterGroup=this.collisionFilterMask=-1;this.mode=b.ANY;this.result=new k;this.hasHit=!1;
this.callback=function(z){}}function c(B,t,z,J){J.vsub(t,M);z.vsub(t,h);B.vsub(t,m);B=M.dot(M);t=M.dot(h);z=M.dot(m);J=h.dot(h);var I=h.dot(m),Q,F;return 0<=(Q=J*z-t*I)&&0<=(F=B*I-t*z)&&Q+F<B*J-t*t}n.exports=b;var a=e("../math/Vec3");n=e("../math/Quaternion");var g=e("../math/Transform");e("../shapes/ConvexPolyhedron");e("../shapes/Box");var k=e("../collision/RaycastResult");q=e("../shapes/Shape");e=e("../collision/AABB");b.prototype.constructor=b;b.CLOSEST=1;b.ANY=2;b.ALL=4;var d=new e,f=[];b.prototype.intersectWorld=
function(B,t){this.mode=t.mode||b.ANY;this.result=t.result||new k;this.skipBackfaces=!!t.skipBackfaces;this.collisionFilterMask="undefined"!==typeof t.collisionFilterMask?t.collisionFilterMask:-1;this.collisionFilterGroup="undefined"!==typeof t.collisionFilterGroup?t.collisionFilterGroup:-1;t.from&&this.from.copy(t.from);t.to&&this.to.copy(t.to);this.callback=t.callback||function(){};this.hasHit=!1;this.result.reset();this._updateDirection();this.getAABB(d);f.length=0;B.broadphase.aabbQuery(B,d,f);
this.intersectBodies(f);return this.hasHit};var h=new a,m=new a;b.pointInTriangle=c;var l=new a,r=new n;b.prototype.intersectBody=function(B,t){t&&(this.result=t,this._updateDirection());var z=this.checkCollisionResponse;if((!z||B.collisionResponse)&&0!==(this.collisionFilterGroup&B.collisionFilterMask)&&0!==(B.collisionFilterGroup&this.collisionFilterMask))for(var J=0,I=B.shapes.length;J<I;J++){var Q=B.shapes[J];if(!z||Q.collisionResponse)if(B.quaternion.mult(B.shapeOrientations[J],r),B.quaternion.vmult(B.shapeOffsets[J],
l),l.vadd(B.position,l),this.intersectShape(Q,r,l,B),this.result._shouldStop)break}};b.prototype.intersectBodies=function(B,t){t&&(this.result=t,this._updateDirection());for(var z=0,J=B.length;!this.result._shouldStop&&z<J;z++)this.intersectBody(B[z])};b.prototype._updateDirection=function(){this.to.vsub(this.from,this._direction);this._direction.normalize()};b.prototype.intersectShape=function(B,t,z,J){var I=this.from,Q=this._direction;z.vsub(I,M);var F=M.dot(Q);Q.mult(F,A);A.vadd(I,A);z.distanceTo(A)>
B.boundingSphereRadius||(I=this[B.type])&&I.call(this,B,t,z,J)};new a;new a;var u=new a,v=new a,x=new a,w=new a;new a;new k;b.prototype.intersectBox=function(B,t,z,J){return this.intersectConvex(B.convexPolyhedronRepresentation,t,z,J)};b.prototype[q.types.BOX]=b.prototype.intersectBox;b.prototype.intersectPlane=function(B,t,z,J){var I=this.from,Q=this.to,F=this._direction,U=new a(0,0,1);t.vmult(U,U);var Z=new a;I.vsub(z,Z);t=Z.dot(U);Q.vsub(z,Z);Z=Z.dot(U);if(!(0<t*Z||I.distanceTo(Q)<t||(Z=U.dot(F),
Math.abs(Z)<this.precision))){var S=new a;Q=new a;t=new a;I.vsub(z,S);z=-U.dot(S)/Z;F.scale(z,Q);I.vadd(Q,t);this.reportIntersection(U,t,B,J,-1)}};b.prototype[q.types.PLANE]=b.prototype.intersectPlane;b.prototype.getAABB=function(B){var t=this.to,z=this.from;B.lowerBound.x=Math.min(t.x,z.x);B.lowerBound.y=Math.min(t.y,z.y);B.lowerBound.z=Math.min(t.z,z.z);B.upperBound.x=Math.max(t.x,z.x);B.upperBound.y=Math.max(t.y,z.y);B.upperBound.z=Math.max(t.z,z.z)};var G={faceList:[0]};b.prototype.intersectHeightfield=
function(B,t,z,J){var I=new a,Q=new b(this.from,this.to);g.pointToLocalFrame(z,t,Q.from,Q.from);g.pointToLocalFrame(z,t,Q.to,Q.to);var F=[],U=null,Z=null,S=null,W=null,ma=B.getIndexOfPosition(Q.from.x,Q.from.y,F,!1);ma&&(U=F[0],Z=F[1],S=F[0],W=F[1]);if(ma=B.getIndexOfPosition(Q.to.x,Q.to.y,F,!1)){if(null===U||F[0]<U)U=F[0];if(null===S||F[0]>S)S=F[0];if(null===Z||F[1]<Z)Z=F[1];if(null===W||F[1]>W)W=F[1]}if(null!==U)for(B.getRectMinMax(U,Z,S,W,[]),Q=U;Q<=S;Q++)for(F=Z;F<=W;F++){if(this.result._shouldStop)return;
B.getConvexTrianglePillar(Q,F,!1);g.pointToWorldFrame(z,t,B.pillarOffset,I);this.intersectConvex(B.pillarConvex,t,I,J,G);if(this.result._shouldStop)return;B.getConvexTrianglePillar(Q,F,!0);g.pointToWorldFrame(z,t,B.pillarOffset,I);this.intersectConvex(B.pillarConvex,t,I,J,G)}};b.prototype[q.types.HEIGHTFIELD]=b.prototype.intersectHeightfield;var N=new a,K=new a;b.prototype.intersectSphere=function(B,t,z,J){t=this.from;var I=this.to,Q=Math.pow(I.x-t.x,2)+Math.pow(I.y-t.y,2)+Math.pow(I.z-t.z,2),F=2*
((I.x-t.x)*(t.x-z.x)+(I.y-t.y)*(t.y-z.y)+(I.z-t.z)*(t.z-z.z)),U=Math.pow(F,2)-4*Q*(Math.pow(t.x-z.x,2)+Math.pow(t.y-z.y,2)+Math.pow(t.z-z.z,2)-Math.pow(B.radius,2));if(!(0>U))if(0===U)t.lerp(I,U,N),N.vsub(z,K),K.normalize(),this.reportIntersection(K,N,B,J,-1);else{var Z=(-F-Math.sqrt(U))/(2*Q);Q=(-F+Math.sqrt(U))/(2*Q);0<=Z&&1>=Z&&(t.lerp(I,Z,N),N.vsub(z,K),K.normalize(),this.reportIntersection(K,N,B,J,-1));!this.result._shouldStop&&0<=Q&&1>=Q&&(t.lerp(I,Q,N),N.vsub(z,K),K.normalize(),this.reportIntersection(K,
N,B,J,-1))}};b.prototype[q.types.SPHERE]=b.prototype.intersectSphere;var T=new a;new a;new a;var L=new a;b.prototype.intersectConvex=function(B,t,z,J,I){I=I&&I.faceList||null;for(var Q=B.faces,F=B.vertices,U=B.faceNormals,Z=this._direction,S=this.from,W=S.distanceTo(this.to),ma=I?I.length:Q.length,ja=this.result,fa=0;!ja._shouldStop&&fa<ma;fa++){var qa=I?I[fa]:fa,aa=Q[qa],ca=U[qa],da=t,ta=z;L.copy(F[aa[0]]);da.vmult(L,L);L.vadd(ta,L);L.vsub(S,L);da.vmult(ca,T);ca=Z.dot(T);if(!(Math.abs(ca)<this.precision||
(ca=T.dot(L)/ca,0>ca)))for(Z.mult(ca,u),u.vadd(S,u),v.copy(F[aa[0]]),da.vmult(v,v),ta.vadd(v,v),ca=1;!ja._shouldStop&&ca<aa.length-1;ca++){x.copy(F[aa[ca]]);w.copy(F[aa[ca+1]]);da.vmult(x,x);da.vmult(w,w);ta.vadd(x,x);ta.vadd(w,w);var va=u.distanceTo(S);!c(u,v,x,w)&&!c(u,x,v,w)||va>W||this.reportIntersection(T,u,B,J,qa)}}};b.prototype[q.types.CONVEXPOLYHEDRON]=b.prototype.intersectConvex;var C=new a,D=new a,H=new a,P=new a,y=new a,V=new a;new e;var E=[],R=new g;b.prototype.intersectTrimesh=function(B,
t,z,J,I){I=B.indices;var Q=this.from,F=this.to,U=this._direction;R.position.copy(z);R.quaternion.copy(t);g.vectorToLocalFrame(z,t,U,D);g.pointToLocalFrame(z,t,Q,H);g.pointToLocalFrame(z,t,F,P);Q=H.distanceSquared(P);B.tree.rayQuery(this,R,E);F=0;for(U=E.length;!this.result._shouldStop&&F!==U;F++){var Z=E[F];B.getNormal(Z,C);B.getVertex(I[3*Z],v);v.vsub(H,L);var S=D.dot(C);S=C.dot(L)/S;0>S||(D.scale(S,u),u.vadd(H,u),B.getVertex(I[3*Z+1],x),B.getVertex(I[3*Z+2],w),S=u.distanceSquared(H),!c(u,x,v,w)&&
!c(u,v,x,w)||S>Q||(g.vectorToWorldFrame(t,C,y),g.pointToWorldFrame(z,t,u,V),this.reportIntersection(y,V,B,J,Z)))}E.length=0};b.prototype[q.types.TRIMESH]=b.prototype.intersectTrimesh;b.prototype.reportIntersection=function(B,t,z,J,I){var Q=this.from,F=this.to,U=Q.distanceTo(t),Z=this.result;if(!(this.skipBackfaces&&0<B.dot(this._direction)))switch(Z.hitFaceIndex="undefined"!==typeof I?I:-1,this.mode){case b.ALL:this.hasHit=!0;Z.set(Q,F,B,t,z,J,U);Z.hasHit=!0;this.callback(Z);break;case b.CLOSEST:if(U<
Z.distance||!Z.hasHit)this.hasHit=!0,Z.hasHit=!0,Z.set(Q,F,B,t,z,J,U);break;case b.ANY:this.hasHit=!0,Z.hasHit=!0,Z.set(Q,F,B,t,z,J,U),Z._shouldStop=!0}};var M=new a,A=new a},{"../collision/AABB":3,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/Box":37,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43}],10:[function(e,n,q){function b(){this.rayFromWorld=new c;this.rayToWorld=new c;this.hitNormalWorld=new c;this.hitPointWorld=new c;this.hasHit=
!1;this.body=this.shape=null;this.distance=this.hitFaceIndex=-1;this._shouldStop=!1}var c=e("../math/Vec3");n.exports=b;b.prototype.reset=function(){this.rayFromWorld.setZero();this.rayToWorld.setZero();this.hitNormalWorld.setZero();this.hitPointWorld.setZero();this.hasHit=!1;this.body=this.shape=null;this.distance=this.hitFaceIndex=-1;this._shouldStop=!1};b.prototype.abort=function(){this._shouldStop=!0};b.prototype.set=function(a,g,k,d,f,h,m){this.rayFromWorld.copy(a);this.rayToWorld.copy(g);this.hitNormalWorld.copy(k);
this.hitPointWorld.copy(d);this.shape=f;this.body=h;this.distance=m}},{"../math/Vec3":30}],11:[function(e,n,q){function b(a){c.apply(this);this.axisList=[];this.world=null;this.axisIndex=0;var g=this.axisList;this._addBodyHandler=function(k){g.push(k.body)};this._removeBodyHandler=function(k){k=g.indexOf(k.body);-1!==k&&g.splice(k,1)};a&&this.setWorld(a)}e("../shapes/Shape");var c=e("../collision/Broadphase");n.exports=b;b.prototype=new c;b.prototype.setWorld=function(a){for(var g=this.axisList.length=
0;g<a.bodies.length;g++)this.axisList.push(a.bodies[g]);a.removeEventListener("addBody",this._addBodyHandler);a.removeEventListener("removeBody",this._removeBodyHandler);a.addEventListener("addBody",this._addBodyHandler);a.addEventListener("removeBody",this._removeBodyHandler);this.world=a;this.dirty=!0};b.insertionSortX=function(a){for(var g=1,k=a.length;g<k;g++){for(var d=a[g],f=g-1;0<=f&&!(a[f].aabb.lowerBound.x<=d.aabb.lowerBound.x);f--)a[f+1]=a[f];a[f+1]=d}return a};b.insertionSortY=function(a){for(var g=
1,k=a.length;g<k;g++){for(var d=a[g],f=g-1;0<=f&&!(a[f].aabb.lowerBound.y<=d.aabb.lowerBound.y);f--)a[f+1]=a[f];a[f+1]=d}return a};b.insertionSortZ=function(a){for(var g=1,k=a.length;g<k;g++){for(var d=a[g],f=g-1;0<=f&&!(a[f].aabb.lowerBound.z<=d.aabb.lowerBound.z);f--)a[f+1]=a[f];a[f+1]=d}return a};b.prototype.collisionPairs=function(a,g,k){a=this.axisList;var d=a.length,f=this.axisIndex,h,m;this.dirty&&(this.sortList(),this.dirty=!1);for(h=0;h!==d;h++){var l=a[h];for(m=h+1;m<d;m++){var r=a[m];if(this.needBroadphaseCollision(l,
r)){if(!b.checkBounds(l,r,f))break;this.intersectionTest(l,r,g,k)}}}};b.prototype.sortList=function(){for(var a=this.axisList,g=this.axisIndex,k=a.length,d=0;d!==k;d++){var f=a[d];f.aabbNeedsUpdate&&f.computeAABB()}0===g?b.insertionSortX(a):1===g?b.insertionSortY(a):2===g&&b.insertionSortZ(a)};b.checkBounds=function(a,g,k){if(0===k){var d=a.position.x;var f=g.position.x}else 1===k?(d=a.position.y,f=g.position.y):2===k&&(d=a.position.z,f=g.position.z);return f-g.boundingRadius<d+a.boundingRadius};
b.prototype.autoDetectAxis=function(){for(var a=0,g=0,k=0,d=0,f=0,h=0,m=this.axisList,l=m.length,r=1/l,u=0;u!==l;u++){var v=m[u],x=v.position.x;a+=x;g+=x*x;x=v.position.y;k+=x;d+=x*x;v=v.position.z;f+=v;h+=v*v}a=g-a*a*r;k=d-k*k*r;f=h-f*f*r;this.axisIndex=a>k?a>f?0:2:k>f?1:2};b.prototype.aabbQuery=function(a,g,k){k=k||[];this.dirty&&(this.sortList(),this.dirty=!1);a=this.axisList;for(var d=0;d<a.length;d++){var f=a[d];f.aabbNeedsUpdate&&f.computeAABB();f.aabb.overlaps(g)&&k.push(f)}return k}},{"../collision/Broadphase":5,
"../shapes/Shape":43}],12:[function(e,n,q){function b(d,f,h){h=h||{};var m="undefined"!==typeof h.maxForce?h.maxForce:1E6,l=h.pivotA?h.pivotA.clone():new k,r=h.pivotB?h.pivotB.clone():new k;this.axisA=h.axisA?h.axisA.clone():new k;this.axisB=h.axisB?h.axisB.clone():new k;c.call(this,d,l,f,r,m);this.collideConnected=!!h.collideConnected;this.angle="undefined"!==typeof h.angle?h.angle:0;l=this.coneEquation=new a(d,f,h);d=this.twistEquation=new g(d,f,h);this.twistAngle="undefined"!==typeof h.twistAngle?
h.twistAngle:0;l.maxForce=0;l.minForce=-m;d.maxForce=0;d.minForce=-m;this.equations.push(l,d)}n.exports=b;e("./Constraint");var c=e("./PointToPointConstraint"),a=e("../equations/ConeEquation"),g=e("../equations/RotationalEquation");e("../equations/ContactEquation");var k=e("../math/Vec3");b.prototype=new c;b.constructor=b;new k;new k;b.prototype.update=function(){var d=this.bodyA,f=this.bodyB,h=this.coneEquation,m=this.twistEquation;c.prototype.update.call(this);d.vectorToWorldFrame(this.axisA,h.axisA);
f.vectorToWorldFrame(this.axisB,h.axisB);this.axisA.tangents(m.axisA,m.axisA);d.vectorToWorldFrame(m.axisA,m.axisA);this.axisB.tangents(m.axisB,m.axisB);f.vectorToWorldFrame(m.axisB,m.axisB);h.angle=this.angle;m.maxAngle=this.twistAngle}},{"../equations/ConeEquation":18,"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],13:[function(e,n,q){function b(a,g,k){k=c.defaults(k,{collideConnected:!0,wakeUpBodies:!0});
this.equations=[];this.bodyA=a;this.bodyB=g;this.id=b.idCounter++;this.collideConnected=k.collideConnected;k.wakeUpBodies&&(a&&a.wakeUp(),g&&g.wakeUp())}n.exports=b;var c=e("../utils/Utils");b.prototype.update=function(){throw Error("method update() not implmemented in this Constraint subclass!");};b.prototype.enable=function(){for(var a=this.equations,g=0;g<a.length;g++)a[g].enabled=!0};b.prototype.disable=function(){for(var a=this.equations,g=0;g<a.length;g++)a[g].enabled=!1};b.idCounter=0},{"../utils/Utils":53}],
14:[function(e,n,q){function b(g,k,d,f){c.call(this,g,k);"undefined"===typeof d&&(d=g.position.distanceTo(k.position));"undefined"===typeof f&&(f=1E6);this.distance=d;g=this.distanceEquation=new a(g,k);this.equations.push(g);g.minForce=-f;g.maxForce=f}n.exports=b;var c=e("./Constraint"),a=e("../equations/ContactEquation");b.prototype=new c;b.prototype.update=function(){var g=this.distanceEquation,k=.5*this.distance,d=g.ni;this.bodyB.position.vsub(this.bodyA.position,d);d.normalize();d.mult(k,g.ri);
d.mult(-k,g.rj)}},{"../equations/ContactEquation":19,"./Constraint":13}],15:[function(e,n,q){function b(h,m,l){l=l||{};var r="undefined"!==typeof l.maxForce?l.maxForce:1E6,u=l.pivotA?l.pivotA.clone():new k,v=l.pivotB?l.pivotB.clone():new k;c.call(this,h,u,m,v,r);(this.axisA=l.axisA?l.axisA.clone():new k(1,0,0)).normalize();(this.axisB=l.axisB?l.axisB.clone():new k(1,0,0)).normalize();u=this.rotationalEquation1=new a(h,m,l);l=this.rotationalEquation2=new a(h,m,l);h=this.motorEquation=new g(h,m,r);
h.enabled=!1;this.equations.push(u,l,h)}n.exports=b;e("./Constraint");var c=e("./PointToPointConstraint"),a=e("../equations/RotationalEquation"),g=e("../equations/RotationalMotorEquation");e("../equations/ContactEquation");var k=e("../math/Vec3");b.prototype=new c;b.constructor=b;b.prototype.enableMotor=function(){this.motorEquation.enabled=!0};b.prototype.disableMotor=function(){this.motorEquation.enabled=!1};b.prototype.setMotorSpeed=function(h){this.motorEquation.targetVelocity=h};b.prototype.setMotorMaxForce=
function(h){this.motorEquation.maxForce=h;this.motorEquation.minForce=-h};var d=new k,f=new k;b.prototype.update=function(){var h=this.bodyA,m=this.bodyB,l=this.motorEquation,r=this.rotationalEquation1,u=this.rotationalEquation2,v=this.axisA,x=this.axisB;c.prototype.update.call(this);h.quaternion.vmult(v,d);m.quaternion.vmult(x,f);d.tangents(r.axisA,u.axisA);r.axisB.copy(f);u.axisB.copy(f);this.motorEquation.enabled&&(h.quaternion.vmult(this.axisA,l.axisA),m.quaternion.vmult(this.axisB,l.axisB))}},
{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],16:[function(e,n,q){function b(k,d,f){f=f||{};var h="undefined"!==typeof f.maxForce?f.maxForce:1E6,m=new g,l=new g,r=new g;k.position.vadd(d.position,r);r.scale(.5,r);d.pointToLocalFrame(r,l);k.pointToLocalFrame(r,m);c.call(this,k,m,d,l,h);h=this.rotationalEquation1=new a(k,d,f);m=this.rotationalEquation2=new a(k,d,f);
k=this.rotationalEquation3=new a(k,d,f);this.equations.push(h,m,k)}n.exports=b;e("./Constraint");var c=e("./PointToPointConstraint"),a=e("../equations/RotationalEquation");e("../equations/RotationalMotorEquation");e("../equations/ContactEquation");var g=e("../math/Vec3");b.prototype=new c;b.constructor=b;new g;new g;b.prototype.update=function(){var k=this.bodyA,d=this.bodyB,f=this.rotationalEquation1,h=this.rotationalEquation2,m=this.rotationalEquation3;c.prototype.update.call(this);k.vectorToWorldFrame(g.UNIT_X,
f.axisA);d.vectorToWorldFrame(g.UNIT_Y,f.axisB);k.vectorToWorldFrame(g.UNIT_Y,h.axisA);d.vectorToWorldFrame(g.UNIT_Z,h.axisB);k.vectorToWorldFrame(g.UNIT_Z,m.axisA);d.vectorToWorldFrame(g.UNIT_X,m.axisB)}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],17:[function(e,n,q){function b(k,d,f,h,m){c.call(this,k,f);m="undefined"!==typeof m?m:1E6;this.pivotA=d?d.clone():
new g;this.pivotB=h?h.clone():new g;d=this.equationX=new a(k,f);h=this.equationY=new a(k,f);k=this.equationZ=new a(k,f);this.equations.push(d,h,k);d.minForce=h.minForce=k.minForce=-m;d.maxForce=h.maxForce=k.maxForce=m;d.ni.set(1,0,0);h.ni.set(0,1,0);k.ni.set(0,0,1)}n.exports=b;var c=e("./Constraint"),a=e("../equations/ContactEquation"),g=e("../math/Vec3");b.prototype=new c;b.prototype.update=function(){var k=this.bodyB,d=this.equationX,f=this.equationY,h=this.equationZ;this.bodyA.quaternion.vmult(this.pivotA,
d.ri);k.quaternion.vmult(this.pivotB,d.rj);f.ri.copy(d.ri);f.rj.copy(d.rj);h.ri.copy(d.ri);h.rj.copy(d.rj)}},{"../equations/ContactEquation":19,"../math/Vec3":30,"./Constraint":13}],18:[function(e,n,q){function b(d,f,h){h=h||{};var m="undefined"!==typeof h.maxForce?h.maxForce:1E6;a.call(this,d,f,-m,m);this.axisA=h.axisA?h.axisA.clone():new c(1,0,0);this.axisB=h.axisB?h.axisB.clone():new c(0,1,0);this.angle="undefined"!==typeof h.angle?h.angle:0}n.exports=b;var c=e("../math/Vec3");e("../math/Mat3");
var a=e("./Equation");b.prototype=new a;b.prototype.constructor=b;var g=new c,k=new c;b.prototype.computeB=function(d){var f=this.a,h=this.b,m=this.axisA,l=this.axisB,r=this.jacobianElementA,u=this.jacobianElementB;m.cross(l,g);l.cross(m,k);r.rotational.copy(k);u.rotational.copy(g);m=Math.cos(this.angle)-m.dot(l);l=this.computeGW();r=this.computeGiMf();return-m*f-l*h-d*r}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],19:[function(e,n,q){function b(u,v,x){c.call(this,u,v,0,"undefined"!==
typeof x?x:1E6);this.restitution=0;this.ri=new a;this.rj=new a;this.ni=new a}n.exports=b;var c=e("./Equation"),a=e("../math/Vec3");e("../math/Mat3");b.prototype=new c;b.prototype.constructor=b;var g=new a,k=new a,d=new a;b.prototype.computeB=function(u){var v=this.a,x=this.b,w=this.bi,G=this.bj,N=this.ri,K=this.rj,T=w.velocity,L=w.angularVelocity,C=G.velocity,D=G.angularVelocity,H=this.jacobianElementA,P=this.jacobianElementB,y=this.ni;N.cross(y,g);K.cross(y,k);y.negate(H.spatial);g.negate(H.rotational);
P.spatial.copy(y);P.rotational.copy(k);d.copy(G.position);d.vadd(K,d);d.vsub(w.position,d);d.vsub(N,d);w=y.dot(d);G=this.restitution+1;T=G*C.dot(y)-G*T.dot(y)+D.dot(k)-L.dot(g);L=this.computeGiMf();return-w*v-T*x-u*L};var f=new a,h=new a,m=new a,l=new a,r=new a;b.prototype.getImpactVelocityAlongNormal=function(){this.bi.position.vadd(this.ri,m);this.bj.position.vadd(this.rj,l);this.bi.getVelocityAtWorldPoint(m,f);this.bj.getVelocityAtWorldPoint(l,h);f.vsub(h,r);return this.ni.dot(r)}},{"../math/Mat3":27,
"../math/Vec3":30,"./Equation":20}],20:[function(e,n,q){function b(l,r,u,v){this.id=b.id++;this.minForce="undefined"===typeof u?-1E6:u;this.maxForce="undefined"===typeof v?1E6:v;this.bi=l;this.bj=r;this.eps=this.b=this.a=0;this.jacobianElementA=new c;this.jacobianElementB=new c;this.enabled=!0;this.setSpookParams(1E7,4,1/60)}n.exports=b;var c=e("../math/JacobianElement");e=e("../math/Vec3");b.prototype.constructor=b;b.id=0;b.prototype.setSpookParams=function(l,r,u){this.a=4/(u*(1+4*r));this.b=4*r/
(1+4*r);this.eps=4/(u*u*l*(1+4*r))};b.prototype.computeB=function(l,r,u){var v=this.computeGW(),x=this.computeGq(),w=this.computeGiMf();return-x*l-v*r-w*u};b.prototype.computeGq=function(){var l=this.jacobianElementB,r=this.bj.position;return this.jacobianElementA.spatial.dot(this.bi.position)+l.spatial.dot(r)};var a=new e;b.prototype.computeGW=function(){var l=this.jacobianElementB,r=this.bi,u=this.bj,v=u.velocity;u=u.angularVelocity||a;return this.jacobianElementA.multiplyVectors(r.velocity,r.angularVelocity||
a)+l.multiplyVectors(v,u)};b.prototype.computeGWlambda=function(){var l=this.jacobianElementB,r=this.bi,u=this.bj,v=u.vlambda;u=u.wlambda||a;return this.jacobianElementA.multiplyVectors(r.vlambda,r.wlambda||a)+l.multiplyVectors(v,u)};var g=new e,k=new e,d=new e,f=new e;b.prototype.computeGiMf=function(){var l=this.jacobianElementA,r=this.jacobianElementB,u=this.bi,v=this.bj,x=u.force,w=u.torque,G=v.force,N=v.torque,K=u.invMassSolve,T=v.invMassSolve;u.invInertiaWorldSolve?u.invInertiaWorldSolve.vmult(w,
d):d.set(0,0,0);v.invInertiaWorldSolve?v.invInertiaWorldSolve.vmult(N,f):f.set(0,0,0);x.mult(K,g);G.mult(T,k);return l.multiplyVectors(g,d)+r.multiplyVectors(k,f)};var h=new e;b.prototype.computeGiMGt=function(){var l=this.jacobianElementA,r=this.jacobianElementB,u=this.bi,v=this.bj,x=u.invInertiaWorldSolve,w=v.invInertiaWorldSolve;u=u.invMassSolve+v.invMassSolve;x&&(x.vmult(l.rotational,h),u+=h.dot(l.rotational));w&&(w.vmult(r.rotational,h),u+=h.dot(r.rotational));return u};var m=new e;new e;new e;
new e;new e;new e;b.prototype.addToWlambda=function(l){var r=this.jacobianElementA,u=this.jacobianElementB,v=this.bi,x=this.bj;r.spatial.mult(v.invMassSolve*l,m);v.vlambda.vadd(m,v.vlambda);u.spatial.mult(x.invMassSolve*l,m);x.vlambda.vadd(m,x.vlambda);v.invInertiaWorldSolve&&(v.invInertiaWorldSolve.vmult(r.rotational,m),m.mult(l,m),v.wlambda.vadd(m,v.wlambda));x.invInertiaWorldSolve&&(x.invInertiaWorldSolve.vmult(u.rotational,m),m.mult(l,m),x.wlambda.vadd(m,x.wlambda))};b.prototype.computeC=function(){return this.computeGiMGt()+
this.eps}},{"../math/JacobianElement":26,"../math/Vec3":30}],21:[function(e,n,q){function b(d,f,h){c.call(this,d,f,-h,h);this.ri=new a;this.rj=new a;this.t=new a}n.exports=b;var c=e("./Equation"),a=e("../math/Vec3");e("../math/Mat3");b.prototype=new c;b.prototype.constructor=b;var g=new a,k=new a;b.prototype.computeB=function(d){var f=this.b,h=this.rj,m=this.t;this.ri.cross(m,g);h.cross(m,k);h=this.jacobianElementA;var l=this.jacobianElementB;m.negate(h.spatial);g.negate(h.rotational);l.spatial.copy(m);
l.rotational.copy(k);m=this.computeGW();h=this.computeGiMf();return-m*f-d*h}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],22:[function(e,n,q){function b(d,f,h){h=h||{};var m="undefined"!==typeof h.maxForce?h.maxForce:1E6;a.call(this,d,f,-m,m);this.axisA=h.axisA?h.axisA.clone():new c(1,0,0);this.axisB=h.axisB?h.axisB.clone():new c(0,1,0);this.maxAngle=Math.PI/2}n.exports=b;var c=e("../math/Vec3");e("../math/Mat3");var a=e("./Equation");b.prototype=new a;b.prototype.constructor=b;var g=new c,
k=new c;b.prototype.computeB=function(d){var f=this.a,h=this.b,m=this.axisA,l=this.axisB,r=this.jacobianElementA,u=this.jacobianElementB;m.cross(l,g);l.cross(m,k);r.rotational.copy(k);u.rotational.copy(g);m=Math.cos(this.maxAngle)-m.dot(l);l=this.computeGW();r=this.computeGiMf();return-m*f-l*h-d*r}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],23:[function(e,n,q){function b(g,k,d){d="undefined"!==typeof d?d:1E6;a.call(this,g,k,-d,d);this.axisA=new c;this.axisB=new c;this.targetVelocity=
0}n.exports=b;var c=e("../math/Vec3");e("../math/Mat3");var a=e("./Equation");b.prototype=new a;b.prototype.constructor=b;b.prototype.computeB=function(g){var k=this.b,d=this.axisB,f=this.jacobianElementB;this.jacobianElementA.rotational.copy(this.axisA);d.negate(f.rotational);d=this.computeGW()-this.targetVelocity;f=this.computeGiMf();return-d*k-g*f}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],24:[function(e,n,q){function b(a,g,k){k=c.defaults(k,{friction:.3,restitution:.3,contactEquationStiffness:1E7,
contactEquationRelaxation:3,frictionEquationStiffness:1E7,frictionEquationRelaxation:3});this.id=b.idCounter++;this.materials=[a,g];this.friction=k.friction;this.restitution=k.restitution;this.contactEquationStiffness=k.contactEquationStiffness;this.contactEquationRelaxation=k.contactEquationRelaxation;this.frictionEquationStiffness=k.frictionEquationStiffness;this.frictionEquationRelaxation=k.frictionEquationRelaxation}var c=e("../utils/Utils");n.exports=b;b.idCounter=0},{"../utils/Utils":53}],25:[function(e,
n,q){function b(c){var a="";c=c||{};"string"===typeof c?(a=c,c={}):"object"===typeof c&&(a="");this.name=a;this.id=b.idCounter++;this.friction="undefined"!==typeof c.friction?c.friction:-1;this.restitution="undefined"!==typeof c.restitution?c.restitution:-1}n.exports=b;b.idCounter=0},{}],26:[function(e,n,q){function b(){this.spatial=new c;this.rotational=new c}n.exports=b;var c=e("./Vec3");b.prototype.multiplyElement=function(a){return a.spatial.dot(this.spatial)+a.rotational.dot(this.rotational)};
b.prototype.multiplyVectors=function(a,g){return a.dot(this.spatial)+g.dot(this.rotational)}},{"./Vec3":30}],27:[function(e,n,q){function b(a){this.elements=a?a:[0,0,0,0,0,0,0,0,0]}n.exports=b;var c=e("./Vec3");b.prototype.identity=function(){var a=this.elements;a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1};b.prototype.setZero=function(){var a=this.elements;a[0]=0;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=0;a[6]=0;a[7]=0;a[8]=0};b.prototype.setTrace=function(a){var g=this.elements;g[0]=a.x;
g[4]=a.y;g[8]=a.z};b.prototype.getTrace=function(a){a=a||new c;var g=this.elements;a.x=g[0];a.y=g[4];a.z=g[8]};b.prototype.vmult=function(a,g){g=g||new c;var k=this.elements,d=a.x,f=a.y,h=a.z;g.x=k[0]*d+k[1]*f+k[2]*h;g.y=k[3]*d+k[4]*f+k[5]*h;g.z=k[6]*d+k[7]*f+k[8]*h;return g};b.prototype.smult=function(a){for(var g=0;g<this.elements.length;g++)this.elements[g]*=a};b.prototype.mmult=function(a,g){for(var k=g||new b,d=0;3>d;d++)for(var f=0;3>f;f++){for(var h=0,m=0;3>m;m++)h+=a.elements[d+3*m]*this.elements[m+
3*f];k.elements[d+3*f]=h}return k};b.prototype.scale=function(a,g){g=g||new b;for(var k=this.elements,d=g.elements,f=0;3!==f;f++)d[3*f]=a.x*k[3*f],d[3*f+1]=a.y*k[3*f+1],d[3*f+2]=a.z*k[3*f+2];return g};b.prototype.solve=function(a,g){g=g||new c;for(var k=[],d=0;12>d;d++)k.push(0);var f;for(d=0;3>d;d++)for(f=0;3>f;f++)k[d+4*f]=this.elements[d+3*f];k[3]=a.x;k[7]=a.y;k[11]=a.z;var h=3,m=h;do{d=m-h;if(0===k[d+4*d])for(f=d+1;f<m;f++)if(0!==k[d+4*f]){var l=4;do{var r=4-l;k[r+4*d]+=k[r+4*f]}while(--l);break}if(0!==
k[d+4*d])for(f=d+1;f<m;f++){var u=k[d+4*f]/k[d+4*d];l=4;do r=4-l,k[r+4*f]=r<=d?0:k[r+4*f]-k[r+4*d]*u;while(--l)}}while(--h);g.z=k[11]/k[10];g.y=(k[7]-k[6]*g.z)/k[5];g.x=(k[3]-k[2]*g.z-k[1]*g.y)/k[0];if(isNaN(g.x)||isNaN(g.y)||isNaN(g.z)||Infinity===g.x||Infinity===g.y||Infinity===g.z)throw"Could not solve equation! Got x=["+g.toString()+"], b=["+a.toString()+"], A=["+this.toString()+"]";return g};b.prototype.e=function(a,g,k){if(void 0===k)return this.elements[g+3*a];this.elements[g+3*a]=k};b.prototype.copy=
function(a){for(var g=0;g<a.elements.length;g++)this.elements[g]=a.elements[g];return this};b.prototype.toString=function(){for(var a="",g=0;9>g;g++)a+=this.elements[g]+",";return a};b.prototype.reverse=function(a){a=a||new b;for(var g=[],k=0;18>k;k++)g.push(0);var d;for(k=0;3>k;k++)for(d=0;3>d;d++)g[k+6*d]=this.elements[k+3*d];g[3]=1;g[9]=0;g[15]=0;g[4]=0;g[10]=1;g[16]=0;g[5]=0;g[11]=0;g[17]=1;var f=3,h=f;do{k=h-f;if(0===g[k+6*k])for(d=k+1;d<h;d++)if(0!==g[k+6*d]){var m=6;do{var l=6-m;g[l+6*k]+=
g[l+6*d]}while(--m);break}if(0!==g[k+6*k])for(d=k+1;d<h;d++){var r=g[k+6*d]/g[k+6*k];m=6;do l=6-m,g[l+6*d]=l<=k?0:g[l+6*d]-g[l+6*k]*r;while(--m)}}while(--f);k=2;do{d=k-1;do{r=g[k+6*d]/g[k+6*k];m=6;do l=6-m,g[l+6*d]-=g[l+6*k]*r;while(--m)}while(d--)}while(--k);k=2;do{r=1/g[k+6*k];m=6;do l=6-m,g[l+6*k]*=r;while(--m)}while(k--);k=2;do{d=2;do{l=g[3+d+6*k];if(isNaN(l)||Infinity===l)throw"Could not reverse! A=["+this.toString()+"]";a.e(k,d,l)}while(d--)}while(k--);return a};b.prototype.setRotationFromQuaternion=
function(a){var g=a.x,k=a.y,d=a.z,f=a.w,h=g+g,m=k+k,l=d+d;a=g*h;var r=g*m;g*=l;var u=k*m;k*=l;d*=l;h*=f;m*=f;f*=l;l=this.elements;l[0]=1-(u+d);l[1]=r-f;l[2]=g+m;l[3]=r+f;l[4]=1-(a+d);l[5]=k-h;l[6]=g-m;l[7]=k+h;l[8]=1-(a+u);return this};b.prototype.transpose=function(a){a=a||new b;for(var g=a.elements,k=this.elements,d=0;3!==d;d++)for(var f=0;3!==f;f++)g[3*d+f]=k[3*f+d];return a}},{"./Vec3":30}],28:[function(e,n,q){function b(h,m,l,r){this.x=void 0!==h?h:0;this.y=void 0!==m?m:0;this.z=void 0!==l?l:
0;this.w=void 0!==r?r:1}n.exports=b;var c=e("./Vec3");b.prototype.set=function(h,m,l,r){this.x=h;this.y=m;this.z=l;this.w=r};b.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w};b.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]};b.prototype.setFromAxisAngle=function(h,m){var l=Math.sin(.5*m);this.x=h.x*l;this.y=h.y*l;this.z=h.z*l;this.w=Math.cos(.5*m)};b.prototype.toAxisAngle=function(h){h=h||new c;this.normalize();var m=2*Math.acos(this.w),l=Math.sqrt(1-
this.w*this.w);.001>l?(h.x=this.x,h.y=this.y,h.z=this.z):(h.x=this.x/l,h.y=this.y/l,h.z=this.z/l);return[h,m]};var a=new c,g=new c;b.prototype.setFromVectors=function(h,m){if(h.isAntiparallelTo(m))h.tangents(a,g),this.setFromAxisAngle(a,Math.PI);else{var l=h.cross(m);this.x=l.x;this.y=l.y;this.z=l.z;this.w=Math.sqrt(Math.pow(h.norm(),2)*Math.pow(m.norm(),2))+h.dot(m);this.normalize()}};var k=new c,d=new c,f=new c;b.prototype.mult=function(h,m){m=m||new b;var l=this.w;k.set(this.x,this.y,this.z);d.set(h.x,
h.y,h.z);m.w=l*h.w-k.dot(d);k.cross(d,f);m.x=l*d.x+h.w*k.x+f.x;m.y=l*d.y+h.w*k.y+f.y;m.z=l*d.z+h.w*k.z+f.z;return m};b.prototype.inverse=function(h){var m=this.x,l=this.y,r=this.z,u=this.w;h=h||new b;this.conjugate(h);m=1/(m*m+l*l+r*r+u*u);h.x*=m;h.y*=m;h.z*=m;h.w*=m;return h};b.prototype.conjugate=function(h){h=h||new b;h.x=-this.x;h.y=-this.y;h.z=-this.z;h.w=this.w;return h};b.prototype.normalize=function(){var h=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);0===h?this.w=this.z=
this.y=this.x=0:(h=1/h,this.x*=h,this.y*=h,this.z*=h,this.w*=h)};b.prototype.normalizeFast=function(){var h=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;0===h?this.w=this.z=this.y=this.x=0:(this.x*=h,this.y*=h,this.z*=h,this.w*=h)};b.prototype.vmult=function(h,m){m=m||new c;var l=h.x,r=h.y,u=h.z,v=this.x,x=this.y,w=this.z,G=this.w,N=G*l+x*u-w*r,K=G*r+w*l-v*u,T=G*u+v*r-x*l;l=-v*l-x*r-w*u;m.x=N*G+l*-v+K*-w-T*-x;m.y=K*G+l*-x+T*-v-N*-w;m.z=T*G+l*-w+N*-x-K*-v;return m};b.prototype.copy=
function(h){this.x=h.x;this.y=h.y;this.z=h.z;this.w=h.w;return this};b.prototype.toEuler=function(h,m){m=m||"YZX";var l=this.x,r=this.y,u=this.z,v=this.w;switch(m){case "YZX":var x=l*r+u*v;if(.499<x){var w=2*Math.atan2(l,v);var G=Math.PI/2;var N=0}-.499>x&&(w=-2*Math.atan2(l,v),G=-Math.PI/2,N=0);isNaN(w)&&(N=u*u,w=Math.atan2(2*r*v-2*l*u,1-2*r*r-2*N),G=Math.asin(2*x),N=Math.atan2(2*l*v-2*r*u,1-2*l*l-2*N));break;default:throw Error("Euler order "+m+" not supported yet.");}h.y=w;h.z=G;h.x=N};b.prototype.setFromEuler=
function(h,m,l,r){r=r||"XYZ";var u=Math.cos(h/2),v=Math.cos(m/2),x=Math.cos(l/2);h=Math.sin(h/2);m=Math.sin(m/2);l=Math.sin(l/2);"XYZ"===r?(this.x=h*v*x+u*m*l,this.y=u*m*x-h*v*l,this.z=u*v*l+h*m*x,this.w=u*v*x-h*m*l):"YXZ"===r?(this.x=h*v*x+u*m*l,this.y=u*m*x-h*v*l,this.z=u*v*l-h*m*x,this.w=u*v*x+h*m*l):"ZXY"===r?(this.x=h*v*x-u*m*l,this.y=u*m*x+h*v*l,this.z=u*v*l+h*m*x,this.w=u*v*x-h*m*l):"ZYX"===r?(this.x=h*v*x-u*m*l,this.y=u*m*x+h*v*l,this.z=u*v*l-h*m*x,this.w=u*v*x+h*m*l):"YZX"===r?(this.x=h*
v*x+u*m*l,this.y=u*m*x+h*v*l,this.z=u*v*l-h*m*x,this.w=u*v*x-h*m*l):"XZY"===r&&(this.x=h*v*x-u*m*l,this.y=u*m*x-h*v*l,this.z=u*v*l+h*m*x,this.w=u*v*x+h*m*l);return this};b.prototype.clone=function(){return new b(this.x,this.y,this.z,this.w)}},{"./Vec3":30}],29:[function(e,n,q){function b(k){k=k||{};this.position=new c;k.position&&this.position.copy(k.position);this.quaternion=new a;k.quaternion&&this.quaternion.copy(k.quaternion)}var c=e("./Vec3"),a=e("./Quaternion");n.exports=b;var g=new a;b.pointToLocalFrame=
function(k,d,f,h){h=h||new c;f.vsub(k,h);d.conjugate(g);g.vmult(h,h);return h};b.prototype.pointToLocal=function(k,d){return b.pointToLocalFrame(this.position,this.quaternion,k,d)};b.pointToWorldFrame=function(k,d,f,h){h=h||new c;d.vmult(f,h);h.vadd(k,h);return h};b.prototype.pointToWorld=function(k,d){return b.pointToWorldFrame(this.position,this.quaternion,k,d)};b.prototype.vectorToWorldFrame=function(k,d){d=d||new c;this.quaternion.vmult(k,d);return d};b.vectorToWorldFrame=function(k,d,f){k.vmult(d,
f);return f};b.vectorToLocalFrame=function(k,d,f,h){h=h||new c;d.w*=-1;d.vmult(f,h);d.w*=-1;return h}},{"./Quaternion":28,"./Vec3":30}],30:[function(e,n,q){function b(d,f,h){this.x=d||0;this.y=f||0;this.z=h||0}n.exports=b;var c=e("./Mat3");b.ZERO=new b(0,0,0);b.UNIT_X=new b(1,0,0);b.UNIT_Y=new b(0,1,0);b.UNIT_Z=new b(0,0,1);b.prototype.cross=function(d,f){var h=d.x,m=d.y,l=d.z,r=this.x,u=this.y,v=this.z;f=f||new b;f.x=u*l-v*m;f.y=v*h-r*l;f.z=r*m-u*h;return f};b.prototype.set=function(d,f,h){this.x=
d;this.y=f;this.z=h;return this};b.prototype.setZero=function(){this.x=this.y=this.z=0};b.prototype.vadd=function(d,f){if(f)f.x=d.x+this.x,f.y=d.y+this.y,f.z=d.z+this.z;else return new b(this.x+d.x,this.y+d.y,this.z+d.z)};b.prototype.vsub=function(d,f){if(f)f.x=this.x-d.x,f.y=this.y-d.y,f.z=this.z-d.z;else return new b(this.x-d.x,this.y-d.y,this.z-d.z)};b.prototype.crossmat=function(){return new c([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])};b.prototype.normalize=function(){var d=this.x,
f=this.y,h=this.z;d=Math.sqrt(d*d+f*f+h*h);0<d?(f=1/d,this.x*=f,this.y*=f,this.z*=f):this.z=this.y=this.x=0;return d};b.prototype.unit=function(d){d=d||new b;var f=this.x,h=this.y,m=this.z,l=Math.sqrt(f*f+h*h+m*m);0<l?(l=1/l,d.x=f*l,d.y=h*l,d.z=m*l):(d.x=1,d.y=0,d.z=0);return d};b.prototype.norm=function(){var d=this.x,f=this.y,h=this.z;return Math.sqrt(d*d+f*f+h*h)};b.prototype.length=b.prototype.norm;b.prototype.norm2=function(){return this.dot(this)};b.prototype.lengthSquared=b.prototype.norm2;
b.prototype.distanceTo=function(d){var f=this.x,h=this.y,m=this.z,l=d.x,r=d.y;d=d.z;return Math.sqrt((l-f)*(l-f)+(r-h)*(r-h)+(d-m)*(d-m))};b.prototype.distanceSquared=function(d){var f=this.x,h=this.y,m=this.z,l=d.x,r=d.y;d=d.z;return(l-f)*(l-f)+(r-h)*(r-h)+(d-m)*(d-m)};b.prototype.mult=function(d,f){f=f||new b;var h=this.y,m=this.z;f.x=d*this.x;f.y=d*h;f.z=d*m;return f};b.prototype.scale=b.prototype.mult;b.prototype.dot=function(d){return this.x*d.x+this.y*d.y+this.z*d.z};b.prototype.isZero=function(){return 0===
this.x&&0===this.y&&0===this.z};b.prototype.negate=function(d){d=d||new b;d.x=-this.x;d.y=-this.y;d.z=-this.z;return d};var a=new b,g=new b;b.prototype.tangents=function(d,f){var h=this.norm();0<h?(h=1/h,a.set(this.x*h,this.y*h,this.z*h),.9>Math.abs(a.x)?g.set(1,0,0):g.set(0,1,0),a.cross(g,d),a.cross(d,f)):(d.set(1,0,0),f.set(0,1,0))};b.prototype.toString=function(){return this.x+","+this.y+","+this.z};b.prototype.toArray=function(){return[this.x,this.y,this.z]};b.prototype.copy=function(d){this.x=
d.x;this.y=d.y;this.z=d.z;return this};b.prototype.lerp=function(d,f,h){var m=this.x,l=this.y,r=this.z;h.x=m+(d.x-m)*f;h.y=l+(d.y-l)*f;h.z=r+(d.z-r)*f};b.prototype.almostEquals=function(d,f){void 0===f&&(f=1E-6);return Math.abs(this.x-d.x)>f||Math.abs(this.y-d.y)>f||Math.abs(this.z-d.z)>f?!1:!0};b.prototype.almostZero=function(d){void 0===d&&(d=1E-6);return Math.abs(this.x)>d||Math.abs(this.y)>d||Math.abs(this.z)>d?!1:!0};var k=new b;b.prototype.isAntiparallelTo=function(d,f){this.negate(k);return k.almostEquals(d,
f)};b.prototype.clone=function(){return new b(this.x,this.y,this.z)}},{"./Mat3":27}],31:[function(e,n,q){function b(H){H=H||{};c.apply(this);this.id=b.idCounter++;this.postStep=this.preStep=this.world=null;this.vlambda=new a;this.collisionFilterGroup="number"===typeof H.collisionFilterGroup?H.collisionFilterGroup:1;this.collisionFilterMask="number"===typeof H.collisionFilterMask?H.collisionFilterMask:1;this.collisionResponse=!0;this.position=new a;H.position&&this.position.copy(H.position);this.previousPosition=
new a;this.initPosition=new a;this.velocity=new a;H.velocity&&this.velocity.copy(H.velocity);this.initVelocity=new a;this.force=new a;var P="number"===typeof H.mass?H.mass:0;this.mass=P;this.invMass=0<P?1/P:0;this.material=H.material||null;this.linearDamping="number"===typeof H.linearDamping?H.linearDamping:.01;this.type=0>=P?b.STATIC:b.DYNAMIC;typeof H.type===typeof b.STATIC&&(this.type=H.type);this.allowSleep="undefined"!==typeof H.allowSleep?H.allowSleep:!0;this.sleepState=0;this.sleepSpeedLimit=
"undefined"!==typeof H.sleepSpeedLimit?H.sleepSpeedLimit:.1;this.sleepTimeLimit="undefined"!==typeof H.sleepTimeLimit?H.sleepTimeLimit:1;this.timeLastSleepy=0;this._wakeUpAfterNarrowphase=!1;this.torque=new a;this.quaternion=new k;H.quaternion&&this.quaternion.copy(H.quaternion);this.initQuaternion=new k;this.angularVelocity=new a;H.angularVelocity&&this.angularVelocity.copy(H.angularVelocity);this.initAngularVelocity=new a;this.interpolatedPosition=new a;this.interpolatedQuaternion=new k;this.shapes=
[];this.shapeOffsets=[];this.shapeOrientations=[];this.inertia=new a;this.invInertia=new a;this.invInertiaWorld=new g;this.invMassSolve=0;this.invInertiaSolve=new a;this.invInertiaWorldSolve=new g;this.fixedRotation="undefined"!==typeof H.fixedRotation?H.fixedRotation:!1;this.angularDamping="undefined"!==typeof H.angularDamping?H.angularDamping:.01;this.aabb=new d;this.aabbNeedsUpdate=!0;this.wlambda=new a;H.shape&&this.addShape(H.shape);this.updateMassProperties()}n.exports=b;var c=e("../utils/EventTarget");
e("../shapes/Shape");var a=e("../math/Vec3"),g=e("../math/Mat3"),k=e("../math/Quaternion");e("../material/Material");var d=e("../collision/AABB"),f=e("../shapes/Box");b.prototype=new c;b.prototype.constructor=b;b.DYNAMIC=1;b.STATIC=2;b.KINEMATIC=4;b.AWAKE=0;b.SLEEPY=1;b.SLEEPING=2;b.idCounter=0;b.prototype.wakeUp=function(){var H=this.sleepState;this.sleepState=0;H===b.SLEEPING&&this.dispatchEvent({type:"wakeup"})};b.prototype.sleep=function(){this.sleepState=b.SLEEPING;this.velocity.set(0,0,0);this.angularVelocity.set(0,
0,0)};b.sleepyEvent={type:"sleepy"};b.sleepEvent={type:"sleep"};b.prototype.sleepTick=function(H){if(this.allowSleep){var P=this.sleepState,y=this.velocity.norm2()+this.angularVelocity.norm2(),V=Math.pow(this.sleepSpeedLimit,2);P===b.AWAKE&&y<V?(this.sleepState=b.SLEEPY,this.timeLastSleepy=H,this.dispatchEvent(b.sleepyEvent)):P===b.SLEEPY&&y>V?this.wakeUp():P===b.SLEEPY&&H-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(b.sleepEvent))}};b.prototype.updateSolveMassProperties=
function(){this.sleepState===b.SLEEPING||this.type===b.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))};b.prototype.pointToLocalFrame=function(H,P){P=P||new a;H.vsub(this.position,P);this.quaternion.conjugate().vmult(P,P);return P};b.prototype.vectorToLocalFrame=function(H,P){P=P||new a;this.quaternion.conjugate().vmult(H,
P);return P};b.prototype.pointToWorldFrame=function(H,P){P=P||new a;this.quaternion.vmult(H,P);P.vadd(this.position,P);return P};b.prototype.vectorToWorldFrame=function(H,P){P=P||new a;this.quaternion.vmult(H,P);return P};var h=new a,m=new k;b.prototype.addShape=function(H,P,y){var V=new a,E=new k;P&&V.copy(P);y&&E.copy(y);this.shapes.push(H);this.shapeOffsets.push(V);this.shapeOrientations.push(E);this.updateMassProperties();this.updateBoundingRadius();this.aabbNeedsUpdate=!0;return this};b.prototype.updateBoundingRadius=
function(){for(var H=this.shapes,P=this.shapeOffsets,y=H.length,V=0,E=0;E!==y;E++){var R=H[E];R.updateBoundingSphereRadius();var M=P[E].norm();R=R.boundingSphereRadius;M+R>V&&(V=M+R)}this.boundingRadius=V};var l=new d;b.prototype.computeAABB=function(){for(var H=this.shapes,P=this.shapeOffsets,y=this.shapeOrientations,V=H.length,E=this.quaternion,R=this.aabb,M=0;M!==V;M++){var A=H[M];y[M].mult(E,m);m.vmult(P[M],h);h.vadd(this.position,h);A.calculateWorldAABB(h,m,l.lowerBound,l.upperBound);0===M?R.copy(l):
R.extend(l)}this.aabbNeedsUpdate=!1};var r=new g,u=new g;new g;b.prototype.updateInertiaWorld=function(H){var P=this.invInertia;if(P.x!==P.y||P.y!==P.z||H)r.setRotationFromQuaternion(this.quaternion),r.transpose(u),r.scale(P,r),r.mmult(u,this.invInertiaWorld)};var v=new a,x=new a;b.prototype.applyForce=function(H,P){this.type===b.DYNAMIC&&(P.vsub(this.position,v),v.cross(H,x),this.force.vadd(H,this.force),this.torque.vadd(x,this.torque))};var w=new a,G=new a;b.prototype.applyLocalForce=function(H,
P){this.type===b.DYNAMIC&&(this.vectorToWorldFrame(H,w),this.pointToWorldFrame(P,G),this.applyForce(w,G))};var N=new a,K=new a,T=new a;b.prototype.applyImpulse=function(H,P){this.type===b.DYNAMIC&&(P.vsub(this.position,N),K.copy(H),K.mult(this.invMass,K),this.velocity.vadd(K,this.velocity),N.cross(H,T),this.invInertiaWorld.vmult(T,T),this.angularVelocity.vadd(T,this.angularVelocity))};var L=new a,C=new a;b.prototype.applyLocalImpulse=function(H,P){this.type===b.DYNAMIC&&(this.vectorToWorldFrame(H,
L),this.pointToWorldFrame(P,C),this.applyImpulse(L,C))};var D=new a;b.prototype.updateMassProperties=function(){this.invMass=0<this.mass?1/this.mass:0;var H=this.inertia,P=this.fixedRotation;this.computeAABB();D.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2);f.calculateInertia(D,this.mass,H);this.invInertia.set(0<H.x&&!P?1/H.x:0,0<H.y&&!P?1/H.y:0,0<H.z&&!P?1/H.z:0);this.updateInertiaWorld(!0)};
b.prototype.getVelocityAtWorldPoint=function(H,P){var y=new a;H.vsub(this.position,y);this.angularVelocity.cross(y,P);this.velocity.vadd(P,P);return P}},{"../collision/AABB":3,"../material/Material":25,"../math/Mat3":27,"../math/Quaternion":28,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Shape":43,"../utils/EventTarget":49}],32:[function(e,n,q){function b(y){this.chassisBody=y.chassisBody;this.wheelInfos=[];this.sliding=!1;this.world=null;this.indexRightAxis="undefined"!==typeof y.indexRightAxis?
y.indexRightAxis:1;this.indexForwardAxis="undefined"!==typeof y.indexForwardAxis?y.indexForwardAxis:0;this.indexUpAxis="undefined"!==typeof y.indexUpAxis?y.indexUpAxis:2}function c(y,V,E){var R=K,M=T,A=L,B=C;V.vsub(y.position,R);R.cross(E,M);y.invInertiaWorld.vmult(M,B);B.cross(R,A);return y.invMass+E.dot(A)}e("./Body");var a=e("../math/Vec3"),g=e("../math/Quaternion");e("../collision/RaycastResult");q=e("../collision/Ray");var k=e("../objects/WheelInfo");n.exports=b;new a;new a;new a;var d=new a,
f=new a,h=new a;new q;b.prototype.addWheel=function(y){y=y||{};y=new k(y);var V=this.wheelInfos.length;this.wheelInfos.push(y);return V};b.prototype.setSteeringValue=function(y,V){this.wheelInfos[V].steering=y};new a;b.prototype.applyEngineForce=function(y,V){this.wheelInfos[V].engineForce=y};b.prototype.setBrake=function(y,V){this.wheelInfos[V].brake=y};b.prototype.addToWorld=function(y){y.add(this.chassisBody);var V=this;this.preStepCallback=function(){V.updateVehicle(y.dt)};y.addEventListener("preStep",
this.preStepCallback);this.world=y};b.prototype.getVehicleAxisWorld=function(y,V){V.set(0===y?1:0,1===y?1:0,2===y?1:0);this.chassisBody.vectorToWorldFrame(V,V)};b.prototype.updateVehicle=function(y){for(var V=this.wheelInfos,E=V.length,R=this.chassisBody,M=0;M<E;M++)this.updateWheelTransform(M);this.currentVehicleSpeedKmHour=3.6*R.velocity.norm();M=new a;this.getVehicleAxisWorld(this.indexForwardAxis,M);0>M.dot(R.velocity)&&(this.currentVehicleSpeedKmHour*=-1);for(M=0;M<E;M++)this.castRay(V[M]);this.updateSuspension(y);
var A=new a,B=new a;for(M=0;M<E;M++){var t=V[M],z=t.suspensionForce;z>t.maxSuspensionForce&&(z=t.maxSuspensionForce);t.raycastResult.hitNormalWorld.scale(z*y,A);t.raycastResult.hitPointWorld.vsub(R.position,B);R.applyImpulse(A,t.raycastResult.hitPointWorld)}this.updateFriction(y);A=new a;B=new a;z=new a;for(M=0;M<E;M++){t=V[M];R.getVelocityAtWorldPoint(t.chassisConnectionPointWorld,z);var J=1;switch(this.indexUpAxis){case 1:J=-1}if(t.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,B);
var I=B.dot(t.raycastResult.hitNormalWorld);t.raycastResult.hitNormalWorld.scale(I,A);B.vsub(A,B);I=B.dot(z);t.deltaRotation=J*I*y/t.radius}!t.sliding&&t.isInContact||0===t.engineForce||!t.useCustomSlidingRotationalSpeed||(t.deltaRotation=(0<t.engineForce?1:-1)*t.customSlidingRotationalSpeed*y);Math.abs(t.brake)>Math.abs(t.engineForce)&&(t.deltaRotation=0);t.rotation+=t.deltaRotation;t.deltaRotation*=.99}};b.prototype.updateSuspension=function(y){y=this.chassisBody.mass;for(var V=this.wheelInfos,
E=V.length,R=0;R<E;R++){var M=V[R];if(M.isInContact){var A=M.suspensionStiffness*(M.suspensionRestLength-M.suspensionLength)*M.clippedInvContactDotSuspension;var B=M.suspensionRelativeVelocity;A-=(0>B?M.dampingCompression:M.dampingRelaxation)*B;M.suspensionForce=A*y;0>M.suspensionForce&&(M.suspensionForce=0)}else M.suspensionForce=0}};b.prototype.removeFromWorld=function(y){y.remove(this.chassisBody);y.removeEventListener("preStep",this.preStepCallback);this.world=null};var m=new a,l=new a;b.prototype.castRay=
function(y){this.updateWheelTransformWorld(y);var V=this.chassisBody,E=-1;y.directionWorld.scale(y.suspensionRestLength+y.radius,m);var R=y.chassisConnectionPointWorld;R.vadd(m,l);var M=y.raycastResult;M.reset();var A=V.collisionResponse;V.collisionResponse=!1;this.world.rayTest(R,l,M);V.collisionResponse=A;R=M.body;y.raycastResult.groundObject=0;R?(E=M.distance,y.raycastResult.hitNormalWorld=M.hitNormalWorld,y.isInContact=!0,y.suspensionLength=M.distance-y.radius,M=y.suspensionRestLength-y.maxSuspensionTravel,
R=y.suspensionRestLength+y.maxSuspensionTravel,y.suspensionLength<M&&(y.suspensionLength=M),y.suspensionLength>R&&(y.suspensionLength=R,y.raycastResult.reset()),M=y.raycastResult.hitNormalWorld.dot(y.directionWorld),R=new a,V.getVelocityAtWorldPoint(y.raycastResult.hitPointWorld,R),V=y.raycastResult.hitNormalWorld.dot(R),-.1<=M?(y.suspensionRelativeVelocity=0,y.clippedInvContactDotSuspension=10):(M=-1/M,y.suspensionRelativeVelocity=V*M,y.clippedInvContactDotSuspension=M)):(y.suspensionLength=y.suspensionRestLength+
0*y.maxSuspensionTravel,y.suspensionRelativeVelocity=0,y.directionWorld.scale(-1,y.raycastResult.hitNormalWorld),y.clippedInvContactDotSuspension=1);return E};b.prototype.updateWheelTransformWorld=function(y){y.isInContact=!1;var V=this.chassisBody;V.pointToWorldFrame(y.chassisConnectionPointLocal,y.chassisConnectionPointWorld);V.vectorToWorldFrame(y.directionLocal,y.directionWorld);V.vectorToWorldFrame(y.axleLocal,y.axleWorld)};b.prototype.updateWheelTransform=function(y){y=this.wheelInfos[y];this.updateWheelTransformWorld(y);
y.directionLocal.scale(-1,d);f.copy(y.axleLocal);d.cross(f,h);h.normalize();f.normalize();var V=y.steering,E=new g;E.setFromAxisAngle(d,V);V=new g;V.setFromAxisAngle(f,y.rotation);var R=y.worldTransform.quaternion;this.chassisBody.quaternion.mult(E,R);R.mult(V,R);R.normalize();E=y.worldTransform.position;E.copy(y.directionWorld);E.scale(y.suspensionLength,E);E.vadd(y.chassisConnectionPointWorld,E)};var r=[new a(1,0,0),new a(0,1,0),new a(0,0,1)];b.prototype.getWheelTransformWorld=function(y){return this.wheelInfos[y].worldTransform};
var u=new a,v=[],x=[];b.prototype.updateFriction=function(y){for(var V=this.wheelInfos,E=V.length,R=this.chassisBody,M=0,A=0;A<E;A++){var B=V[A],t=B.raycastResult.body;t&&M++;B.sideImpulse=0;B.forwardImpulse=0;x[A]||(x[A]=new a);v[A]||(v[A]=new a)}for(A=0;A<E;A++)if(B=V[A],t=B.raycastResult.body){var z=v[A];this.getWheelTransformWorld(A).vectorToWorldFrame(r[this.indexRightAxis],z);M=B.raycastResult.hitNormalWorld;var J=z.dot(M);M.scale(J,u);z.vsub(u,z);z.normalize();M.cross(z,x[A]);x[A].normalize();
M=B;J=R;var I=B.raycastResult.hitPointWorld,Q=B.raycastResult.hitPointWorld;if(1.1<z.norm2())t=0;else{var F=D,U=H,Z=P;J.getVelocityAtWorldPoint(I,F);t.getVelocityAtWorldPoint(Q,U);F.vsub(U,Z);t=-.2*z.dot(Z)*(1/(J.invMass+t.invMass))}M.sideImpulse=t;B.sideImpulse*=1}this.sliding=!1;for(A=0;A<E;A++){B=V[A];t=B.raycastResult.body;J=0;B.slipInfo=1;if(t){M=B.brake?B.brake:0;F=R;I=t;Q=B.raycastResult.hitPointWorld;z=x[A];J=M;U=Q;Z=w;var S=G,W=N;F.getVelocityAtWorldPoint(U,Z);I.getVelocityAtWorldPoint(U,
S);Z.vsub(S,W);U=z.dot(W);F=c(F,Q,z);I=c(I,Q,z);I=1/(F+I)*-U;J<I&&(I=J);I<-J&&(I=-J);J=I;J+=B.engineForce*y;M/=J;B.slipInfo*=M}B.forwardImpulse=0;B.skidInfo=1;t&&(B.skidInfo=1,t=B.suspensionForce*y*B.frictionSlip,M=t*t,B.forwardImpulse=J,J=.5*B.forwardImpulse,I=1*B.sideImpulse,J=J*J+I*I,B.sliding=!1,J>M&&(this.sliding=!0,B.sliding=!0,M=t/Math.sqrt(J),B.skidInfo*=M))}if(this.sliding)for(A=0;A<E;A++)B=V[A],0!==B.sideImpulse&&1>B.skidInfo&&(B.forwardImpulse*=B.skidInfo,B.sideImpulse*=B.skidInfo);for(A=
0;A<E;A++)B=V[A],y=new a,y.copy(B.raycastResult.hitPointWorld),0!==B.forwardImpulse&&(t=new a,x[A].scale(B.forwardImpulse,t),R.applyImpulse(t,y)),0!==B.sideImpulse&&(t=B.raycastResult.body,M=new a,M.copy(B.raycastResult.hitPointWorld),J=new a,v[A].scale(B.sideImpulse,J),R.pointToLocalFrame(y,y),y["xyz"[this.indexUpAxis]]*=B.rollInfluence,R.pointToWorldFrame(y,y),R.applyImpulse(J,y),J.scale(-1,J),t.applyImpulse(J,M))};var w=new a,G=new a,N=new a,K=new a,T=new a,L=new a,C=new a,D=new a,H=new a,P=new a},
{"../collision/Ray":9,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Vec3":30,"../objects/WheelInfo":36,"./Body":31}],33:[function(e,n,q){function b(m){this.wheelBodies=[];this.coordinateSystem="undefined"===typeof m.coordinateSystem?new k(1,2,3):m.coordinateSystem.clone();this.chassisBody=m.chassisBody;this.chassisBody||(m=new g(new k(5,2,.5)),this.chassisBody=new c(1,m));this.constraints=[];this.wheelAxes=[];this.wheelForces=[]}var c=e("./Body"),a=e("../shapes/Sphere"),g=e("../shapes/Box"),
k=e("../math/Vec3"),d=e("../constraints/HingeConstraint");n.exports=b;b.prototype.addWheel=function(m){m=m||{};var l=m.body;l||(l=new c(1,new a(1.2)));this.wheelBodies.push(l);this.wheelForces.push(0);new k;var r="undefined"!==typeof m.position?m.position.clone():new k,u=new k;this.chassisBody.pointToWorldFrame(r,u);l.position.set(u.x,u.y,u.z);m="undefined"!==typeof m.axis?m.axis.clone():new k(0,1,0);this.wheelAxes.push(m);l=new d(this.chassisBody,l,{pivotA:r,axisA:m,pivotB:k.ZERO,axisB:m,collideConnected:!1});
this.constraints.push(l);return this.wheelBodies.length-1};b.prototype.setSteeringValue=function(m,l){var r=this.wheelAxes[l],u=Math.cos(m),v=Math.sin(m),x=r.x;r=r.y;this.constraints[l].axisA.set(u*x-v*r,v*x+u*r,0)};b.prototype.setMotorSpeed=function(m,l){var r=this.constraints[l];r.enableMotor();r.motorTargetVelocity=m};b.prototype.disableMotor=function(m){this.constraints[m].disableMotor()};var f=new k;b.prototype.setWheelForce=function(m,l){this.wheelForces[l]=m};b.prototype.applyWheelForce=function(m,
l){var r=this.wheelBodies[l],u=r.torque;this.wheelAxes[l].scale(m,f);r.vectorToWorldFrame(f,f);u.vadd(f,u)};b.prototype.addToWorld=function(m){for(var l=this.constraints,r=this.wheelBodies.concat([this.chassisBody]),u=0;u<r.length;u++)m.add(r[u]);for(u=0;u<l.length;u++)m.addConstraint(l[u]);m.addEventListener("preStep",this._update.bind(this))};b.prototype._update=function(){for(var m=this.wheelForces,l=0;l<m.length;l++)this.applyWheelForce(m[l],l)};b.prototype.removeFromWorld=function(m){for(var l=
this.constraints,r=this.wheelBodies.concat([this.chassisBody]),u=0;u<r.length;u++)m.remove(r[u]);for(u=0;u<l.length;u++)m.removeConstraint(l[u])};var h=new k;b.prototype.getWheelSpeed=function(m){var l=this.wheelBodies[m].angularVelocity;this.chassisBody.vectorToWorldFrame(this.wheelAxes[m],h);return l.dot(h)}},{"../constraints/HingeConstraint":15,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Sphere":44,"./Body":31}],34:[function(e,n,q){function b(){this.particles=[];this.speedOfSound=this.smoothingRadius=
this.density=1;this.viscosity=.01;this.eps=1E-6;this.pressures=[];this.densities=[];this.neighbors=[]}n.exports=b;e("../shapes/Shape");n=e("../math/Vec3");e("../math/Quaternion");e("../shapes/Particle");e("../objects/Body");e("../material/Material");b.prototype.add=function(m){this.particles.push(m);this.neighbors.length<this.particles.length&&this.neighbors.push([])};b.prototype.remove=function(m){m=this.particles.indexOf(m);-1!==m&&(this.particles.splice(m,1),this.neighbors.length>this.particles.length&&
this.neighbors.pop())};var c=new n;b.prototype.getNeighbors=function(m,l){for(var r=this.particles.length,u=m.id,v=this.smoothingRadius*this.smoothingRadius,x=0;x!==r;x++){var w=this.particles[x];w.position.vsub(m.position,c);u!==w.id&&c.norm2()<v&&l.push(w)}};var a=new n,g=new n,k=new n,d=new n,f=new n,h=new n;b.prototype.update=function(){for(var m=this.particles.length,l=this.speedOfSound,r=this.eps,u=0;u!==m;u++){var v=this.particles[u],x=this.neighbors[u];x.length=0;this.getNeighbors(v,x);x.push(this.particles[u]);
for(var w=x.length,G=0,N=0;N!==w;N++){v.position.vsub(x[N].position,a);var K=a.norm();K=this.w(K);G+=x[N].mass*K}this.densities[u]=G;this.pressures[u]=l*l*(this.densities[u]-this.density)}for(u=0;u!==m;u++){l=this.particles[u];g.set(0,0,0);k.set(0,0,0);x=this.neighbors[u];w=x.length;for(N=0;N!==w;N++)G=x[N],l.position.vsub(G.position,f),K=f.norm(),v=-G.mass*(this.pressures[u]/(this.densities[u]*this.densities[u]+r)+this.pressures[N]/(this.densities[N]*this.densities[N]+r)),this.gradw(f,d),d.mult(v,
d),g.vadd(d,g),G.velocity.vsub(l.velocity,h),h.mult(1/(1E-4+this.densities[u]*this.densities[N])*this.viscosity*G.mass,h),v=this.nablaw(K),h.mult(v,h),k.vadd(h,k);k.mult(l.mass,k);g.mult(l.mass,g);l.force.vadd(k,l.force);l.force.vadd(g,l.force)}};b.prototype.w=function(m){var l=this.smoothingRadius;return 315/(64*Math.PI*Math.pow(l,9))*Math.pow(l*l-m*m,3)};b.prototype.gradw=function(m,l){var r=m.norm(),u=this.smoothingRadius;m.mult(945/(32*Math.PI*Math.pow(u,9))*Math.pow(u*u-r*r,2),l)};b.prototype.nablaw=
function(m){var l=this.smoothingRadius;return 945/(32*Math.PI*Math.pow(l,9))*(l*l-m*m)*(7*m*m-3*l*l)}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Particle":41,"../shapes/Shape":43}],35:[function(e,n,q){function b(x,w,G){G=G||{};this.restLength="number"===typeof G.restLength?G.restLength:1;this.stiffness=G.stiffness||100;this.damping=G.damping||1;this.bodyA=x;this.bodyB=w;this.localAnchorA=new c;this.localAnchorB=new c;G.localAnchorA&&this.localAnchorA.copy(G.localAnchorA);
G.localAnchorB&&this.localAnchorB.copy(G.localAnchorB);G.worldAnchorA&&this.setWorldAnchorA(G.worldAnchorA);G.worldAnchorB&&this.setWorldAnchorB(G.worldAnchorB)}var c=e("../math/Vec3");n.exports=b;b.prototype.setWorldAnchorA=function(x){this.bodyA.pointToLocalFrame(x,this.localAnchorA)};b.prototype.setWorldAnchorB=function(x){this.bodyB.pointToLocalFrame(x,this.localAnchorB)};b.prototype.getWorldAnchorA=function(x){this.bodyA.pointToWorldFrame(this.localAnchorA,x)};b.prototype.getWorldAnchorB=function(x){this.bodyB.pointToWorldFrame(this.localAnchorB,
x)};var a=new c,g=new c,k=new c,d=new c,f=new c,h=new c,m=new c,l=new c,r=new c,u=new c,v=new c;b.prototype.applyForce=function(){var x=this.stiffness,w=this.damping,G=this.restLength,N=this.bodyA,K=this.bodyB;this.getWorldAnchorA(f);this.getWorldAnchorB(h);f.vsub(N.position,m);h.vsub(K.position,l);h.vsub(f,a);var T=a.norm();g.copy(a);g.normalize();K.velocity.vsub(N.velocity,k);K.angularVelocity.cross(l,v);k.vadd(v,k);N.angularVelocity.cross(m,v);k.vsub(v,k);g.mult(-x*(T-G)-w*k.dot(g),d);N.force.vsub(d,
N.force);K.force.vadd(d,K.force);m.cross(d,r);l.cross(d,u);N.torque.vsub(r,N.torque);K.torque.vadd(u,K.torque)}},{"../math/Vec3":30}],36:[function(e,n,q){function b(h){h=k.defaults(h,{chassisConnectionPointLocal:new c,chassisConnectionPointWorld:new c,directionLocal:new c,directionWorld:new c,axleLocal:new c,axleWorld:new c,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1E4,steering:0,rotation:0,deltaRotation:0,
rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1});this.maxSuspensionTravel=h.maxSuspensionTravel;this.customSlidingRotationalSpeed=h.customSlidingRotationalSpeed;this.useCustomSlidingRotationalSpeed=h.useCustomSlidingRotationalSpeed;this.sliding=!1;this.chassisConnectionPointLocal=
h.chassisConnectionPointLocal.clone();this.chassisConnectionPointWorld=h.chassisConnectionPointWorld.clone();this.directionLocal=h.directionLocal.clone();this.directionWorld=h.directionWorld.clone();this.axleLocal=h.axleLocal.clone();this.axleWorld=h.axleWorld.clone();this.suspensionRestLength=h.suspensionRestLength;this.suspensionMaxLength=h.suspensionMaxLength;this.radius=h.radius;this.suspensionStiffness=h.suspensionStiffness;this.dampingCompression=h.dampingCompression;this.dampingRelaxation=
h.dampingRelaxation;this.frictionSlip=h.frictionSlip;this.deltaRotation=this.rotation=this.steering=0;this.rollInfluence=h.rollInfluence;this.maxSuspensionForce=h.maxSuspensionForce;this.brake=this.engineForce=0;this.isFrontWheel=h.isFrontWheel;this.clippedInvContactDotSuspension=1;this.forwardImpulse=this.sideImpulse=this.suspensionLength=this.skidInfo=this.suspensionForce=this.suspensionRelativeVelocity=0;this.raycastResult=new g;this.worldTransform=new a;this.isInContact=!1}var c=e("../math/Vec3"),
a=e("../math/Transform"),g=e("../collision/RaycastResult"),k=e("../utils/Utils");n.exports=b;var d=new c,f=new c;d=new c;b.prototype.updateWheel=function(h){var m=this.raycastResult;if(this.isInContact){var l=m.hitNormalWorld.dot(m.directionWorld);m.hitPointWorld.vsub(h.position,f);h.getVelocityAtWorldPoint(f,d);h=m.hitNormalWorld.dot(d);-.1<=l?(this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10):(l=-1/l,this.suspensionRelativeVelocity=h*l,this.clippedInvContactDotSuspension=
l)}else m.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,m.directionWorld.scale(-1,m.hitNormalWorld),this.clippedInvContactDotSuspension=1}},{"../collision/RaycastResult":10,"../math/Transform":29,"../math/Vec3":30,"../utils/Utils":53}],37:[function(e,n,q){function b(f){c.call(this);this.type=c.types.BOX;this.halfExtents=f;this.convexPolyhedronRepresentation=null;this.updateConvexPolyhedronRepresentation();this.updateBoundingSphereRadius()}n.exports=b;var c=e("./Shape"),
a=e("../math/Vec3"),g=e("./ConvexPolyhedron");b.prototype=new c;b.prototype.constructor=b;b.prototype.updateConvexPolyhedronRepresentation=function(){var f=this.halfExtents.x,h=this.halfExtents.y,m=this.halfExtents.z;f=[new a(-f,-h,-m),new a(f,-h,-m),new a(f,h,-m),new a(-f,h,-m),new a(-f,-h,m),new a(f,-h,m),new a(f,h,m),new a(-f,h,m)];new a(0,0,1);new a(0,1,0);new a(1,0,0);this.convexPolyhedronRepresentation=f=new g(f,[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]]);f.material=this.material};
b.prototype.calculateLocalInertia=function(f,h){h=h||new a;b.calculateInertia(this.halfExtents,f,h);return h};b.calculateInertia=function(f,h,m){m.x=1/12*h*(4*f.y*f.y+4*f.z*f.z);m.y=1/12*h*(4*f.x*f.x+4*f.z*f.z);m.z=1/12*h*(4*f.y*f.y+4*f.x*f.x)};b.prototype.getSideNormals=function(f,h){var m=this.halfExtents;f[0].set(m.x,0,0);f[1].set(0,m.y,0);f[2].set(0,0,m.z);f[3].set(-m.x,0,0);f[4].set(0,-m.y,0);f[5].set(0,0,-m.z);if(void 0!==h)for(m=0;m!==f.length;m++)h.vmult(f[m],f[m]);return f};b.prototype.volume=
function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z};b.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.halfExtents.norm()};var k=new a;new a;b.prototype.forEachWorldCorner=function(f,h,m){var l=this.halfExtents;l=[[l.x,l.y,l.z],[-l.x,l.y,l.z],[-l.x,-l.y,l.z],[-l.x,-l.y,-l.z],[l.x,-l.y,-l.z],[l.x,l.y,-l.z],[-l.x,l.y,-l.z],[l.x,-l.y,l.z]];for(var r=0;r<l.length;r++)k.set(l[r][0],l[r][1],l[r][2]),h.vmult(k,k),f.vadd(k,k),m(k.x,k.y,k.z)};var d=[new a,
new a,new a,new a,new a,new a,new a,new a];b.prototype.calculateWorldAABB=function(f,h,m,l){var r=this.halfExtents;d[0].set(r.x,r.y,r.z);d[1].set(-r.x,r.y,r.z);d[2].set(-r.x,-r.y,r.z);d[3].set(-r.x,-r.y,-r.z);d[4].set(r.x,-r.y,-r.z);d[5].set(r.x,r.y,-r.z);d[6].set(-r.x,r.y,-r.z);d[7].set(r.x,-r.y,r.z);var u=d[0];h.vmult(u,u);f.vadd(u,u);l.copy(u);m.copy(u);for(r=1;8>r;r++){u=d[r];h.vmult(u,u);f.vadd(u,u);var v=u.x,x=u.y;u=u.z;v>l.x&&(l.x=v);x>l.y&&(l.y=x);u>l.z&&(l.z=u);v<m.x&&(m.x=v);x<m.y&&(m.y=
x);u<m.z&&(m.z=u)}}},{"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],38:[function(e,n,q){function b(z,J,I){c.call(this);this.type=c.types.CONVEXPOLYHEDRON;this.vertices=z||[];this.worldVertices=[];this.worldVerticesNeedsUpdate=!0;this.faces=J||[];this.faceNormals=[];this.computeNormals();this.worldFaceNormalsNeedsUpdate=!0;this.worldFaceNormals=[];this.uniqueEdges=[];this.uniqueAxes=I?I.slice():null;this.computeEdges();this.updateBoundingSphereRadius()}n.exports=b;var c=e("./Shape"),a=e("../math/Vec3");
e("../math/Quaternion");var g=e("../math/Transform");b.prototype=new c;b.prototype.constructor=b;var k=new a;b.prototype.computeEdges=function(){for(var z=this.faces,J=this.vertices,I=this.uniqueEdges,Q=I.length=0;Q!==z.length;Q++)for(var F=z[Q],U=F.length,Z=0;Z!==U;Z++){J[F[Z]].vsub(J[F[(Z+1)%U]],k);k.normalize();for(var S=!1,W=0;W!==I.length;W++)if(I[W].almostEquals(k)||I[W].almostEquals(k)){S=!0;break}S||I.push(k.clone())}};b.prototype.computeNormals=function(){this.faceNormals.length=this.faces.length;
for(var z=0;z<this.faces.length;z++){for(var J=0;J<this.faces[z].length;J++)if(!this.vertices[this.faces[z][J]])throw Error("Vertex "+this.faces[z][J]+" not found!");J=this.faceNormals[z]||new a;this.getFaceNormal(z,J);J.negate(J);this.faceNormals[z]=J;if(0>J.dot(this.vertices[this.faces[z][0]]))for(console.error(".faceNormals["+z+"] = Vec3("+J.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule."),J=0;J<
this.faces[z].length;J++)console.warn(".vertices["+this.faces[z][J]+"] = Vec3("+this.vertices[this.faces[z][J]].toString()+")")}};var d=new a,f=new a;b.computeNormal=function(z,J,I,Q){J.vsub(z,f);I.vsub(J,d);d.cross(f,Q);Q.isZero()||Q.normalize()};b.prototype.getFaceNormal=function(z,J){var I=this.faces[z];return b.computeNormal(this.vertices[I[0]],this.vertices[I[1]],this.vertices[I[2]],J)};var h=new a;b.prototype.clipAgainstHull=function(z,J,I,Q,F,U,Z,S,W){for(var ma=-1,ja=-Number.MAX_VALUE,fa=
0;fa<I.faces.length;fa++){h.copy(I.faceNormals[fa]);F.vmult(h,h);var qa=h.dot(U);qa>ja&&(ja=qa,ma=fa)}ja=[];fa=I.faces[ma];qa=fa.length;for(var aa=0;aa<qa;aa++){var ca=I.vertices[fa[aa]],da=new a;da.copy(ca);F.vmult(da,da);Q.vadd(da,da);ja.push(da)}0<=ma&&this.clipFaceAgainstHull(U,z,J,ja,Z,S,W)};var m=new a,l=new a,r=new a,u=new a,v=new a,x=new a;b.prototype.findSeparatingAxis=function(z,J,I,Q,F,U,Z,S){var W=Number.MAX_VALUE,ma=0;if(this.uniqueAxes)for(fa=0;fa!==this.uniqueAxes.length;fa++){I.vmult(this.uniqueAxes[fa],
m);qa=this.testSepAxis(m,z,J,I,Q,F);if(!1===qa)return!1;qa<W&&(W=qa,U.copy(m))}else for(var ja=Z?Z.length:this.faces.length,fa=0;fa<ja;fa++){qa=Z?Z[fa]:fa;m.copy(this.faceNormals[qa]);I.vmult(m,m);var qa=this.testSepAxis(m,z,J,I,Q,F);if(!1===qa)return!1;qa<W&&(W=qa,U.copy(m))}if(z.uniqueAxes)for(fa=0;fa!==z.uniqueAxes.length;fa++){F.vmult(z.uniqueAxes[fa],l);ma++;qa=this.testSepAxis(l,z,J,I,Q,F);if(!1===qa)return!1;qa<W&&(W=qa,U.copy(l))}else for(Z=S?S.length:z.faces.length,fa=0;fa<Z;fa++){qa=S?S[fa]:
fa;l.copy(z.faceNormals[qa]);F.vmult(l,l);ma++;qa=this.testSepAxis(l,z,J,I,Q,F);if(!1===qa)return!1;qa<W&&(W=qa,U.copy(l))}for(S=0;S!==this.uniqueEdges.length;S++)for(I.vmult(this.uniqueEdges[S],u),ma=0;ma!==z.uniqueEdges.length;ma++)if(F.vmult(z.uniqueEdges[ma],v),u.cross(v,x),!x.almostZero()){x.normalize();fa=this.testSepAxis(x,z,J,I,Q,F);if(!1===fa)return!1;fa<W&&(W=fa,U.copy(x))}Q.vsub(J,r);0<r.dot(U)&&U.negate(U);return!0};var w=[],G=[];b.prototype.testSepAxis=function(z,J,I,Q,F,U){b.project(this,
z,I,Q,w);b.project(J,z,F,U,G);I=w[0];z=w[1];J=G[0];Q=G[1];if(I<Q||J<z)return!1;I-=Q;z=J-z;return I<z?I:z};var N=new a,K=new a;b.prototype.calculateLocalInertia=function(z,J){this.computeLocalAABB(N,K);var I=K.x-N.x,Q=K.y-N.y,F=K.z-N.z;J.x=1/12*z*(4*Q*Q+4*F*F);J.y=1/12*z*(4*I*I+4*F*F);J.z=1/12*z*(4*Q*Q+4*I*I)};b.prototype.getPlaneConstantOfFace=function(z){return-this.faceNormals[z].dot(this.vertices[this.faces[z][0]])};var T=new a,L=new a,C=new a,D=new a,H=new a,P=new a,y=new a,V=new a;b.prototype.clipFaceAgainstHull=
function(z,J,I,Q,F,U,Z){for(var S=[],W=-1,ma=Number.MAX_VALUE,ja=0;ja<this.faces.length;ja++){T.copy(this.faceNormals[ja]);I.vmult(T,T);var fa=T.dot(z);fa<ma&&(ma=fa,W=ja)}if(!(0>W)){z=this.faces[W];z.connectedFaces=[];for(ma=0;ma<this.faces.length;ma++)for(ja=0;ja<this.faces[ma].length;ja++)-1!==z.indexOf(this.faces[ma][ja])&&ma!==W&&-1===z.connectedFaces.indexOf(ma)&&z.connectedFaces.push(ma);ma=z.length;for(ja=0;ja<ma;ja++){fa=this.vertices[z[ja]];fa.vsub(this.vertices[z[(ja+1)%ma]],L);C.copy(L);
I.vmult(C,C);J.vadd(C,C);D.copy(this.faceNormals[W]);I.vmult(D,D);J.vadd(D,D);C.cross(D,H);H.negate(H);P.copy(fa);I.vmult(P,P);J.vadd(P,P);P.dot(H);fa=z.connectedFaces[ja];y.copy(this.faceNormals[fa]);fa=this.getPlaneConstantOfFace(fa);V.copy(y);I.vmult(V,V);fa-=V.dot(J);for(this.clipFaceAgainstPlane(Q,S,V,fa);Q.length;)Q.shift();for(;S.length;)Q.push(S.shift())}y.copy(this.faceNormals[W]);fa=this.getPlaneConstantOfFace(W);V.copy(y);I.vmult(V,V);fa-=V.dot(J);for(ma=0;ma<Q.length;ma++)J=V.dot(Q[ma])+
fa,J<=F&&(console.log("clamped: depth="+J+" to minDist="+(F+"")),J=F),J<=U&&(I=Q[ma],0>=J&&Z.push({point:I,normal:V,depth:J}))}};b.prototype.clipFaceAgainstPlane=function(z,J,I,Q){var F=z.length;if(2>F)return J;var U=z[z.length-1];var Z=I.dot(U)+Q;for(var S=0;S<F;S++){var W=z[S];var ma=I.dot(W)+Q;if(0>Z){if(0>ma){var ja=new a;ja.copy(W)}else ja=new a,U.lerp(W,Z/(Z-ma),ja);J.push(ja)}else 0>ma&&(ja=new a,U.lerp(W,Z/(Z-ma),ja),J.push(ja),J.push(W));U=W;Z=ma}return J};b.prototype.computeWorldVertices=
function(z,J){for(var I=this.vertices.length;this.worldVertices.length<I;)this.worldVertices.push(new a);for(var Q=this.vertices,F=this.worldVertices,U=0;U!==I;U++)J.vmult(Q[U],F[U]),z.vadd(F[U],F[U]);this.worldVerticesNeedsUpdate=!1};new a;b.prototype.computeLocalAABB=function(z,J){var I=this.vertices.length,Q=this.vertices;z.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);J.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var F=0;F<I;F++){var U=Q[F];U.x<z.x?z.x=U.x:U.x>J.x&&
(J.x=U.x);U.y<z.y?z.y=U.y:U.y>J.y&&(J.y=U.y);U.z<z.z?z.z=U.z:U.z>J.z&&(J.z=U.z)}};b.prototype.computeWorldFaceNormals=function(z){for(var J=this.faceNormals.length;this.worldFaceNormals.length<J;)this.worldFaceNormals.push(new a);for(var I=this.faceNormals,Q=this.worldFaceNormals,F=0;F!==J;F++)z.vmult(I[F],Q[F]);this.worldFaceNormalsNeedsUpdate=!1};b.prototype.updateBoundingSphereRadius=function(){for(var z=0,J=this.vertices,I=0,Q=J.length;I!==Q;I++){var F=J[I].norm2();F>z&&(z=F)}this.boundingSphereRadius=
Math.sqrt(z)};var E=new a;b.prototype.calculateWorldAABB=function(z,J,I,Q){for(var F=this.vertices.length,U=this.vertices,Z,S,W,ma,ja,fa,qa=0;qa<F;qa++){E.copy(U[qa]);J.vmult(E,E);z.vadd(E,E);var aa=E;if(aa.x<Z||void 0===Z)Z=aa.x;else if(aa.x>ma||void 0===ma)ma=aa.x;if(aa.y<S||void 0===S)S=aa.y;else if(aa.y>ja||void 0===ja)ja=aa.y;if(aa.z<W||void 0===W)W=aa.z;else if(aa.z>fa||void 0===fa)fa=aa.z}I.set(Z,S,W);Q.set(ma,ja,fa)};b.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/
3};b.prototype.getAveragePointLocal=function(z){z=z||new a;for(var J=this.vertices.length,I=this.vertices,Q=0;Q<J;Q++)z.vadd(I[Q],z);z.mult(1/J,z);return z};b.prototype.transformAllPoints=function(z,J){var I=this.vertices.length,Q=this.vertices;if(J){for(var F=0;F<I;F++){var U=Q[F];J.vmult(U,U)}for(F=0;F<this.faceNormals.length;F++)U=this.faceNormals[F],J.vmult(U,U)}if(z)for(F=0;F<I;F++)U=Q[F],U.vadd(z,U)};var R=new a,M=new a,A=new a;b.prototype.pointIsInside=function(z){var J=this.vertices,I=this.faces,
Q=this.faceNormals,F=this.faces.length;this.getAveragePointLocal(R);for(var U=0;U<F;U++){var Z=Q[U];var S=J[I[U][0]],W=M;z.vsub(S,W);W=Z.dot(W);var ma=A;R.vsub(S,ma);Z=Z.dot(ma);if(0>W&&0<Z||0<W&&0>Z)return!1}return-1};new a;var B=new a,t=new a;b.project=function(z,J,I,Q,F){var U=z.vertices.length;z=z.vertices;t.setZero();g.vectorToLocalFrame(I,Q,J,B);g.pointToLocalFrame(I,Q,t,t);Q=t.dot(B);I=J=z[0].dot(B);for(var Z=1;Z<U;Z++){var S=z[Z].dot(B);S>J&&(J=S);S<I&&(I=S)}I-=Q;J-=Q;I>J&&(U=I,I=J,J=U);F[0]=
J;F[1]=I}},{"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"./Shape":43}],39:[function(e,n,q){function b(k,d,f,h){var m=[],l=[],r=[],u=[],v=[],x=Math.cos,w=Math.sin;m.push(new a(d*x(0),d*w(0),.5*-f));u.push(0);m.push(new a(k*x(0),k*w(0),.5*f));v.push(1);for(var G=0;G<h;G++){var N=2*Math.PI/h*(G+1),K=2*Math.PI/h*(G+.5);G<h-1?(m.push(new a(d*x(N),d*w(N),.5*-f)),u.push(2*G+2),m.push(new a(k*x(N),k*w(N),.5*f)),v.push(2*G+3),r.push([2*G+2,2*G+3,2*G+1,2*G])):r.push([0,1,2*G+1,2*G]);(1===
h%2||G<h/2)&&l.push(new a(x(K),w(K),0))}r.push(v);l.push(new a(0,0,1));k=[];for(G=0;G<u.length;G++)k.push(u[u.length-G-1]);r.push(k);this.type=c.types.CONVEXPOLYHEDRON;g.call(this,m,r,l)}n.exports=b;var c=e("./Shape"),a=e("../math/Vec3");e("../math/Quaternion");var g=e("./ConvexPolyhedron");b.prototype=new g},{"../math/Quaternion":28,"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],40:[function(e,n,q){function b(d,f){f=k.defaults(f,{maxValue:null,minValue:null,elementSize:1});this.data=d;
this.maxValue=f.maxValue;this.minValue=f.minValue;this.elementSize=f.elementSize;null===f.minValue&&this.updateMinValue();null===f.maxValue&&this.updateMaxValue();this.cacheEnabled=!0;c.call(this);this.pillarConvex=new a;this.pillarOffset=new g;this.type=c.types.HEIGHTFIELD;this.updateBoundingSphereRadius();this._cachedPillars={}}var c=e("./Shape"),a=e("./ConvexPolyhedron"),g=e("../math/Vec3"),k=e("../utils/Utils");n.exports=b;b.prototype=new c;b.prototype.update=function(){this._cachedPillars={}};
b.prototype.updateMinValue=function(){for(var d=this.data,f=d[0][0],h=0;h!==d.length;h++)for(var m=0;m!==d[h].length;m++){var l=d[h][m];l<f&&(f=l)}this.minValue=f};b.prototype.updateMaxValue=function(){for(var d=this.data,f=d[0][0],h=0;h!==d.length;h++)for(var m=0;m!==d[h].length;m++){var l=d[h][m];l>f&&(f=l)}this.maxValue=f};b.prototype.setHeightValueAtIndex=function(d,f,h){this.data[d][f]=h;this.clearCachedConvexTrianglePillar(d,f,!1);0<d&&(this.clearCachedConvexTrianglePillar(d-1,f,!0),this.clearCachedConvexTrianglePillar(d-
1,f,!1));0<f&&(this.clearCachedConvexTrianglePillar(d,f-1,!0),this.clearCachedConvexTrianglePillar(d,f-1,!1));0<f&&0<d&&this.clearCachedConvexTrianglePillar(d-1,f-1,!0)};b.prototype.getRectMinMax=function(d,f,h,m,l){l=l||[];for(var r=this.data,u=this.minValue;d<=h;d++)for(var v=f;v<=m;v++){var x=r[d][v];x>u&&(u=x)}l[0]=this.minValue;l[1]=u};b.prototype.getIndexOfPosition=function(d,f,h,m){var l=this.elementSize,r=this.data;d=Math.floor(d/l);f=Math.floor(f/l);h[0]=d;h[1]=f;m&&(0>d&&(d=0),0>f&&(f=0),
d>=r.length-1&&(d=r.length-1),f>=r[0].length-1&&(f=r[0].length-1));return 0>d||0>f||d>=r.length-1||f>=r[0].length-1?!1:!0};b.prototype.getHeightAt=function(d,f,h){var m=[];this.getIndexOfPosition(d,f,m,h);d=[];this.getRectMinMax(m[0],m[1]+1,m[0],m[1]+1,d);return(d[0]+d[1])/2};b.prototype.getCacheConvexTrianglePillarKey=function(d,f,h){return d+"_"+f+"_"+(h?1:0)};b.prototype.getCachedConvexTrianglePillar=function(d,f,h){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(d,f,h)]};b.prototype.setCachedConvexTrianglePillar=
function(d,f,h,m,l){this._cachedPillars[this.getCacheConvexTrianglePillarKey(d,f,h)]={convex:m,offset:l}};b.prototype.clearCachedConvexTrianglePillar=function(d,f,h){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(d,f,h)]};b.prototype.getConvexTrianglePillar=function(d,f,h){var m=this.pillarConvex,l=this.pillarOffset;if(this.cacheEnabled){var r=this.getCachedConvexTrianglePillar(d,f,h);if(r){this.pillarConvex=r.convex;this.pillarOffset=r.offset;return}m=new a;l=new g;this.pillarConvex=
m;this.pillarOffset=l}r=this.data;var u=this.elementSize,v=m.faces;m.vertices.length=6;for(var x=0;6>x;x++)m.vertices[x]||(m.vertices[x]=new g);v.length=5;for(x=0;5>x;x++)v[x]||(v[x]=[]);x=m.vertices;var w=(Math.min(r[d][f],r[d+1][f],r[d][f+1],r[d+1][f+1])-this.minValue)/2+this.minValue;h?(l.set((d+.75)*u,(f+.75)*u,w),x[0].set(.25*u,.25*u,r[d+1][f+1]-w),x[1].set(-.75*u,.25*u,r[d][f+1]-w),x[2].set(.25*u,-.75*u,r[d+1][f]-w),x[3].set(.25*u,.25*u,-w-1),x[4].set(-.75*u,.25*u,-w-1),x[5].set(.25*u,-.75*
u,-w-1),v[0][0]=0,v[0][1]=1,v[0][2]=2,v[1][0]=5,v[1][1]=4,v[1][2]=3,v[2][0]=2,v[2][1]=5,v[2][2]=3,v[2][3]=0,v[3][0]=3,v[3][1]=4,v[3][2]=1,v[3][3]=0,v[4][0]=1,v[4][1]=4,v[4][2]=5,v[4][3]=2):(l.set((d+.25)*u,(f+.25)*u,w),x[0].set(-.25*u,-.25*u,r[d][f]-w),x[1].set(.75*u,-.25*u,r[d+1][f]-w),x[2].set(-.25*u,.75*u,r[d][f+1]-w),x[3].set(-.25*u,-.25*u,-w-1),x[4].set(.75*u,-.25*u,-w-1),x[5].set(-.25*u,.75*u,-w-1),v[0][0]=0,v[0][1]=1,v[0][2]=2,v[1][0]=5,v[1][1]=4,v[1][2]=3,v[2][0]=0,v[2][1]=2,v[2][2]=5,v[2][3]=
3,v[3][0]=1,v[3][1]=0,v[3][2]=3,v[3][3]=4,v[4][0]=4,v[4][1]=5,v[4][2]=2,v[4][3]=1);m.computeNormals();m.computeEdges();m.updateBoundingSphereRadius();this.setCachedConvexTrianglePillar(d,f,h,m,l)};b.prototype.calculateLocalInertia=function(d,f){f=f||new g;f.set(0,0,0);return f};b.prototype.volume=function(){return Number.MAX_VALUE};b.prototype.calculateWorldAABB=function(d,f,h,m){h.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);m.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)};
b.prototype.updateBoundingSphereRadius=function(){var d=this.data,f=this.elementSize;this.boundingSphereRadius=(new g(d.length*f,d[0].length*f,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue)))).norm()}},{"../math/Vec3":30,"../utils/Utils":53,"./ConvexPolyhedron":38,"./Shape":43}],41:[function(e,n,q){function b(){c.call(this);this.type=c.types.PARTICLE}n.exports=b;var c=e("./Shape"),a=e("../math/Vec3");b.prototype=new c;b.prototype.constructor=b;b.prototype.calculateLocalInertia=function(g,
k){k=k||new a;k.set(0,0,0);return k};b.prototype.volume=function(){return 0};b.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0};b.prototype.calculateWorldAABB=function(g,k,d,f){d.copy(g);f.copy(g)}},{"../math/Vec3":30,"./Shape":43}],42:[function(e,n,q){function b(){c.call(this);this.type=c.types.PLANE;this.worldNormal=new a;this.worldNormalNeedsUpdate=!0;this.boundingSphereRadius=Number.MAX_VALUE}n.exports=b;var c=e("./Shape"),a=e("../math/Vec3");b.prototype=new c;b.prototype.constructor=
b;b.prototype.computeWorldNormal=function(k){var d=this.worldNormal;d.set(0,0,1);k.vmult(d,d);this.worldNormalNeedsUpdate=!1};b.prototype.calculateLocalInertia=function(k,d){return d=d||new a};b.prototype.volume=function(){return Number.MAX_VALUE};var g=new a;b.prototype.calculateWorldAABB=function(k,d,f,h){g.set(0,0,1);d.vmult(g,g);d=Number.MAX_VALUE;f.set(-d,-d,-d);h.set(d,d,d);1===g.x&&(h.x=k.x);1===g.y&&(h.y=k.y);1===g.z&&(h.z=k.z);-1===g.x&&(f.x=k.x);-1===g.y&&(f.y=k.y);-1===g.z&&(f.z=k.z)};
b.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE}},{"../math/Vec3":30,"./Shape":43}],43:[function(e,n,q){function b(){this.id=b.idCounter++;this.boundingSphereRadius=this.type=0;this.collisionResponse=!0;this.material=null}n.exports=b;b=e("./Shape");e("../math/Vec3");e("../math/Quaternion");e("../material/Material");b.prototype.constructor=b;b.prototype.updateBoundingSphereRadius=function(){throw"computeBoundingSphereRadius() not implemented for shape type "+
this.type;};b.prototype.volume=function(){throw"volume() not implemented for shape type "+this.type;};b.prototype.calculateLocalInertia=function(c,a){throw"calculateLocalInertia() not implemented for shape type "+this.type;};b.idCounter=0;b.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"./Shape":43}],44:[function(e,n,q){function b(g){c.call(this);this.radius=void 0!==
g?Number(g):1;this.type=c.types.SPHERE;if(0>this.radius)throw Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}n.exports=b;var c=e("./Shape"),a=e("../math/Vec3");b.prototype=new c;b.prototype.constructor=b;b.prototype.calculateLocalInertia=function(g,k){k=k||new a;var d=2*g*this.radius*this.radius/5;k.x=d;k.y=d;k.z=d;return k};b.prototype.volume=function(){return 4*Math.PI*this.radius/3};b.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius};
b.prototype.calculateWorldAABB=function(g,k,d,f){k=this.radius;for(var h=["x","y","z"],m=0;m<h.length;m++){var l=h[m];d[l]=g[l]-k;f[l]=g[l]+k}}},{"../math/Vec3":30,"./Shape":43}],45:[function(e,n,q){function b(L,C){c.call(this);this.type=c.types.TRIMESH;this.vertices=new Float32Array(L);this.indices=new Int16Array(C);this.normals=new Float32Array(C.length);this.aabb=new k;this.edges=null;this.scale=new a(1,1,1);this.tree=new d;this.updateEdges();this.updateNormals();this.updateAABB();this.updateBoundingSphereRadius();
this.updateTree()}n.exports=b;var c=e("./Shape"),a=e("../math/Vec3");e("../math/Quaternion");var g=e("../math/Transform"),k=e("../collision/AABB"),d=e("../utils/Octree");b.prototype=new c;b.prototype.constructor=b;var f=new a;b.prototype.updateTree=function(){var L=this.tree;L.reset();L.aabb.copy(this.aabb);var C=this.scale;L.aabb.lowerBound.x*=1/C.x;L.aabb.lowerBound.y*=1/C.y;L.aabb.lowerBound.z*=1/C.z;L.aabb.upperBound.x*=1/C.x;L.aabb.upperBound.y*=1/C.y;L.aabb.upperBound.z*=1/C.z;C=new k;for(var D=
new a,H=new a,P=new a,y=[D,H,P],V=0;V<this.indices.length/3;V++){var E=3*V;this._getUnscaledVertex(this.indices[E],D);this._getUnscaledVertex(this.indices[E+1],H);this._getUnscaledVertex(this.indices[E+2],P);C.setFromPoints(y);L.insert(C,V)}L.removeEmptyNodes()};var h=new k;b.prototype.getTrianglesInAABB=function(L,C){h.copy(L);var D=this.scale,H=D.x,P=D.y;D=D.z;var y=h.lowerBound,V=h.upperBound;y.x/=H;y.y/=P;y.z/=D;V.x/=H;V.y/=P;V.z/=D;return this.tree.aabbQuery(h,C)};b.prototype.setScale=function(L){var C=
L.x===L.y===L.z;this.scale.x===this.scale.y===this.scale.z&&C||this.updateNormals();this.scale.copy(L);this.updateAABB();this.updateBoundingSphereRadius()};b.prototype.updateNormals=function(){for(var L=this.normals,C=0;C<this.indices.length/3;C++){var D=3*C,H=this.indices[D+1],P=this.indices[D+2];this.getVertex(this.indices[D],v);this.getVertex(H,x);this.getVertex(P,w);b.computeNormal(x,v,w,f);L[D]=f.x;L[D+1]=f.y;L[D+2]=f.z}};b.prototype.updateEdges=function(){for(var L={},C=function(V,E){L[P<y?
P+"_"+y:y+"_"+P]=!0},D=0;D<this.indices.length/3;D++){var H=3*D,P=this.indices[H],y=this.indices[H+1];H=this.indices[H+2];C(P,y);C(y,H);C(H,P)}C=Object.keys(L);this.edges=new Int16Array(2*C.length);for(D=0;D<C.length;D++)H=C[D].split("_"),this.edges[2*D]=parseInt(H[0],10),this.edges[2*D+1]=parseInt(H[1],10)};b.prototype.getEdgeVertex=function(L,C,D){this.getVertex(this.edges[2*L+(C?1:0)],D)};var m=new a,l=new a;b.prototype.getEdgeVector=function(L,C){this.getEdgeVertex(L,0,m);this.getEdgeVertex(L,
1,l);l.vsub(m,C)};var r=new a,u=new a;b.computeNormal=function(L,C,D,H){C.vsub(L,u);D.vsub(C,r);r.cross(u,H);H.isZero()||H.normalize()};var v=new a,x=new a,w=new a;b.prototype.getVertex=function(L,C){var D=this.scale;this._getUnscaledVertex(L,C);C.x*=D.x;C.y*=D.y;C.z*=D.z;return C};b.prototype._getUnscaledVertex=function(L,C){var D=3*L,H=this.vertices;return C.set(H[D],H[D+1],H[D+2])};b.prototype.getWorldVertex=function(L,C,D,H){this.getVertex(L,H);g.pointToWorldFrame(C,D,H,H);return H};b.prototype.getTriangleVertices=
function(L,C,D,H){L*=3;this.getVertex(this.indices[L],C);this.getVertex(this.indices[L+1],D);this.getVertex(this.indices[L+2],H)};b.prototype.getNormal=function(L,C){var D=3*L;return C.set(this.normals[D],this.normals[D+1],this.normals[D+2])};var G=new k;b.prototype.calculateLocalInertia=function(L,C){this.computeLocalAABB(G);var D=G.upperBound.x-G.lowerBound.x,H=G.upperBound.y-G.lowerBound.y,P=G.upperBound.z-G.lowerBound.z;return C.set(1/12*L*(4*H*H+4*P*P),1/12*L*(4*D*D+4*P*P),1/12*L*(4*H*H+4*D*
D))};var N=new a;b.prototype.computeLocalAABB=function(L){var C=L.lowerBound;L=L.upperBound;var D=this.vertices.length;this.getVertex(0,N);C.copy(N);L.copy(N);for(var H=0;H!==D;H++)this.getVertex(H,N),N.x<C.x?C.x=N.x:N.x>L.x&&(L.x=N.x),N.y<C.y?C.y=N.y:N.y>L.y&&(L.y=N.y),N.z<C.z?C.z=N.z:N.z>L.z&&(L.z=N.z)};b.prototype.updateAABB=function(){this.computeLocalAABB(this.aabb)};b.prototype.updateBoundingSphereRadius=function(){var L=0,C=this.vertices,D=new a,H=0;for(C=C.length/3;H!==C;H++){this.getVertex(H,
D);var P=D.norm2();P>L&&(L=P)}this.boundingSphereRadius=Math.sqrt(L)};new a;var K=new g,T=new k;b.prototype.calculateWorldAABB=function(L,C,D,H){K.position=L;K.quaternion=C;this.aabb.toWorldFrame(K,T);D.copy(T.lowerBound);H.copy(T.upperBound)};b.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3};b.createTorus=function(L,C,D,H,P){L=L||1;C=C||.5;D=D||8;H=H||6;P=P||2*Math.PI;for(var y=[],V=[],E=0;E<=D;E++)for(var R=0;R<=H;R++){var M=R/H*P,A=E/D*Math.PI*2;y.push((L+C*Math.cos(A))*
Math.cos(M),(L+C*Math.cos(A))*Math.sin(M),C*Math.sin(A))}for(E=1;E<=D;E++)for(R=1;R<=H;R++)L=(H+1)*(E-1)+R-1,C=(H+1)*(E-1)+R,P=(H+1)*E+R,V.push((H+1)*E+R-1,L,P),V.push(L,C,P);return new b(y,V)}},{"../collision/AABB":3,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../utils/Octree":50,"./Shape":43}],46:[function(e,n,q){function b(){c.call(this);this.iterations=10;this.tolerance=1E-7}n.exports=b;e("../math/Vec3");e("../math/Quaternion");var c=e("./Solver");b.prototype=new c;var a=
[],g=[],k=[];b.prototype.solve=function(d,f){var h=0,m=this.iterations,l=this.tolerance*this.tolerance,r=this.equations,u=r.length,v=f.bodies,x=v.length,w;if(0!==u)for(w=0;w!==x;w++)v[w].updateSolveMassProperties();g.length=u;k.length=u;a.length=u;for(w=0;w!==u;w++){var G=r[w];a[w]=0;k[w]=G.computeB(d);g[w]=1/G.computeC()}if(0!==u){for(w=0;w!==x;w++)G=v[w],h=G.wlambda,G.vlambda.set(0,0,0),h&&h.set(0,0,0);for(h=0;h!==m;h++){for(var N=w=0;N!==u;N++){G=r[N];var K=k[N];var T=g[N];var L=a[N];var C=G.computeGWlambda();
K=T*(K-C-G.eps*L);L+K<G.minForce?K=G.minForce-L:L+K>G.maxForce&&(K=G.maxForce-L);a[N]+=K;w+=0<K?K:-K;G.addToWlambda(K)}if(w*w<l)break}for(w=0;w!==x;w++)G=v[w],m=G.velocity,l=G.angularVelocity,m.vadd(G.vlambda,m),l&&l.vadd(G.wlambda,l)}return h}},{"../math/Quaternion":28,"../math/Vec3":30,"./Solver":47}],47:[function(e,n,q){function b(){this.equations=[]}n.exports=b;b.prototype.solve=function(c,a){return 0};b.prototype.addEquation=function(c){c.enabled&&this.equations.push(c)};b.prototype.removeEquation=
function(c){var a=this.equations;c=a.indexOf(c);-1!==c&&a.splice(c,1)};b.prototype.removeAllEquations=function(){this.equations.length=0}},{}],48:[function(e,n,q){function b(r){k.call(this);this.iterations=10;this.tolerance=1E-7;this.subsolver=r;this.nodes=[];for(this.nodePool=[];128>this.nodePool.length;)this.nodePool.push(this.createNode())}function c(r){for(var u=r.length,v=0;v!==u;v++){var x=r[v];if(!(x.visited||x.body.type&m))return x}return!1}function a(r,u,v){u.push(r.body);u=r.eqs.length;
for(var x=0;x!==u;x++){var w=r.eqs[x];-1===v.indexOf(w)&&v.push(w)}}function g(r,u){return u.id-r.id}n.exports=b;e("../math/Vec3");e("../math/Quaternion");var k=e("./Solver");e=e("../objects/Body");b.prototype=new k;var d=[],f=[],h={bodies:[]},m=e.STATIC,l=[];b.prototype.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}};b.prototype.solve=function(r,u){for(var v=this.nodePool,x=u.bodies,w=this.equations,G=w.length,N=x.length,K=this.subsolver;v.length<N;)v.push(this.createNode());
d.length=N;for(var T=0;T<N;T++)d[T]=v[T];for(T=0;T!==N;T++)v=d[T],v.body=x[T],v.children.length=0,v.eqs.length=0,v.visited=!1;for(N=0;N!==G;N++){v=w[N];T=x.indexOf(v.bi);var L=x.indexOf(v.bj);T=d[T];L=d[L];T.children.push(L);T.eqs.push(v);L.children.push(T);L.eqs.push(v)}x=0;w=f;K.tolerance=this.tolerance;for(K.iterations=this.iterations;T=c(d);){w.length=0;h.bodies.length=0;v=T;T=a;G=h.bodies;N=w;l.push(v);v.visited=!0;for(T(v,G,N);l.length;)for(v=l.pop();L=c(v.children);)L.visited=!0,T(L,G,N),l.push(L);
G=w.length;w=w.sort(g);for(T=0;T!==G;T++)K.addEquation(w[T]);K.solve(r,h);K.removeAllEquations();x++}return x}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"./Solver":47}],49:[function(e,n,q){e=function(){};n.exports=e;e.prototype={constructor:e,addEventListener:function(b,c){void 0===this._listeners&&(this._listeners={});var a=this._listeners;void 0===a[b]&&(a[b]=[]);-1===a[b].indexOf(c)&&a[b].push(c);return this},hasEventListener:function(b,c){if(void 0===this._listeners)return!1;
var a=this._listeners;return void 0!==a[b]&&-1!==a[b].indexOf(c)?!0:!1},removeEventListener:function(b,c){if(void 0===this._listeners)return this;var a=this._listeners;if(void 0===a[b])return this;var g=a[b].indexOf(c);-1!==g&&a[b].splice(g,1);return this},dispatchEvent:function(b){if(void 0===this._listeners)return this;var c=this._listeners[b.type];if(void 0!==c){b.target=this;for(var a=0,g=c.length;a<g;a++)c[a].call(this,b)}return this}}},{}],50:[function(e,n,q){function b(f){f=f||{};this.root=
f.root||null;this.aabb=f.aabb?f.aabb.clone():new a;this.data=[];this.children=[]}function c(f,h){h=h||{};h.root=null;h.aabb=f;b.call(this,h);this.maxDepth="undefined"!==typeof h.maxDepth?h.maxDepth:8}var a=e("../collision/AABB"),g=e("../math/Vec3");n.exports=c;c.prototype=new b;b.prototype.reset=function(f,h){this.children.length=this.data.length=0};b.prototype.insert=function(f,h,m){var l=this.data;m=m||0;if(!this.aabb.contains(f))return!1;var r=this.children;if(m<(this.maxDepth||this.root.maxDepth)){var u=
!1;r.length||(this.subdivide(),u=!0);for(var v=0;8!==v;v++)if(r[v].insert(f,h,m+1))return!0;u&&(r.length=0)}l.push(h);return!0};var k=new g;b.prototype.subdivide=function(){var f=this.aabb,h=f.lowerBound,m=f.upperBound;f=this.children;f.push(new b({aabb:new a({lowerBound:new g(0,0,0)})}),new b({aabb:new a({lowerBound:new g(1,0,0)})}),new b({aabb:new a({lowerBound:new g(1,1,0)})}),new b({aabb:new a({lowerBound:new g(1,1,1)})}),new b({aabb:new a({lowerBound:new g(0,1,1)})}),new b({aabb:new a({lowerBound:new g(0,
0,1)})}),new b({aabb:new a({lowerBound:new g(1,0,1)})}),new b({aabb:new a({lowerBound:new g(0,1,0)})}));m.vsub(h,k);k.scale(.5,k);m=this.root||this;for(var l=0;8!==l;l++){var r=f[l];r.root=m;var u=r.aabb.lowerBound;u.x*=k.x;u.y*=k.y;u.z*=k.z;u.vadd(h,u);u.vadd(k,r.aabb.upperBound)}};b.prototype.aabbQuery=function(f,h){for(var m=[this];m.length;){var l=m.pop();l.aabb.overlaps(f)&&Array.prototype.push.apply(h,l.data);Array.prototype.push.apply(m,l.children)}return h};var d=new a;b.prototype.rayQuery=
function(f,h,m){f.getAABB(d);d.toLocalFrame(h,d);this.aabbQuery(d,m);return m};b.prototype.removeEmptyNodes=function(){for(var f=[this];f.length;){for(var h=f.pop(),m=h.children.length-1;0<=m;m--)h.children[m].data.length||h.children.splice(m,1);Array.prototype.push.apply(f,h.children)}}},{"../collision/AABB":3,"../math/Vec3":30}],51:[function(e,n,q){function b(){this.objects=[];this.type=Object}n.exports=b;b.prototype.release=function(){for(var c=arguments.length,a=0;a!==c;a++)this.objects.push(arguments[a])};
b.prototype.get=function(){return 0===this.objects.length?this.constructObject():this.objects.pop()};b.prototype.constructObject=function(){throw Error("constructObject() not implemented in this Pool subclass yet!");}},{}],52:[function(e,n,q){function b(){this.data={keys:[]}}n.exports=b;b.prototype.get=function(c,a){if(c>a){var g=a;a=c;c=g}return this.data[c+"-"+a]};b.prototype.set=function(c,a,g){if(c>a){var k=a;a=c;c=k}k=c+"-"+a;this.get(c,a)||this.data.keys.push(k);this.data[k]=g};b.prototype.reset=
function(){for(var c=this.data,a=c.keys;0<a.length;){var g=a.pop();delete c[g]}}},{}],53:[function(e,n,q){function b(){}n.exports=b;b.defaults=function(c,a){c=c||{};for(var g in a)g in c||(c[g]=a[g]);return c}},{}],54:[function(e,n,q){function b(){a.call(this);this.type=c}n.exports=b;var c=e("../math/Vec3"),a=e("./Pool");b.prototype=new a;b.prototype.constructObject=function(){return new c}},{"../math/Vec3":30,"./Pool":51}],55:[function(e,n,q){function b(O){this.contactPointPool=[];this.frictionEquationPool=
[];this.result=[];this.frictionResult=[];this.v3pool=new d;this.world=O;this.currentContactMaterial=null;this.enableFrictionReduction=!1}n.exports=b;n=e("../collision/AABB");q=e("../shapes/Shape");var c=e("../collision/Ray"),a=e("../math/Vec3"),g=e("../math/Transform");e("../shapes/ConvexPolyhedron");var k=e("../math/Quaternion");e("../solver/Solver");var d=e("../utils/Vec3Pool"),f=e("../equations/ContactEquation"),h=e("../equations/FrictionEquation");b.prototype.createContactEquation=function(O,
X,ha,ka,ba,ea){if(this.contactPointPool.length){var la=this.contactPointPool.pop();la.bi=O;la.bj=X}else la=new f(O,X);la.enabled=O.collisionResponse&&X.collisionResponse&&ha.collisionResponse&&ka.collisionResponse;var pa=this.currentContactMaterial;la.restitution=pa.restitution;la.setSpookParams(pa.contactEquationStiffness,pa.contactEquationRelaxation,this.world.dt);O=ha.material||O.material;X=ka.material||X.material;O&&X&&0<=O.restitution&&0<=X.restitution&&(la.restitution=O.restitution*X.restitution);
la.si=ba||ha;la.sj=ea||ka;return la};b.prototype.createFrictionEquationsFromContact=function(O,X){var ha=O.bi,ka=O.bj,ba=this.world,ea=this.currentContactMaterial,la=ea.friction,pa=O.si.material||ha.material,na=O.sj.material||ka.material;pa&&na&&0<=pa.friction&&0<=na.friction&&(la=pa.friction*na.friction);if(0<la){la*=ba.gravity.length();pa=ha.invMass+ka.invMass;0<pa&&(pa=1/pa);var ia=this.frictionEquationPool;na=ia.length?ia.pop():new h(ha,ka,la*pa);ia=ia.length?ia.pop():new h(ha,ka,la*pa);na.bi=
ia.bi=ha;na.bj=ia.bj=ka;na.minForce=ia.minForce=-la*pa;na.maxForce=ia.maxForce=la*pa;na.ri.copy(O.ri);na.rj.copy(O.rj);ia.ri.copy(O.ri);ia.rj.copy(O.rj);O.ni.tangents(na.t,ia.t);na.setSpookParams(ea.frictionEquationStiffness,ea.frictionEquationRelaxation,ba.dt);ia.setSpookParams(ea.frictionEquationStiffness,ea.frictionEquationRelaxation,ba.dt);na.enabled=ia.enabled=O.enabled;X.push(na,ia);return!0}return!1};var m=new a,l=new a,r=new a;b.prototype.createFrictionFromAverage=function(O){var X=this.result[this.result.length-
1];if(this.createFrictionEquationsFromContact(X,this.frictionResult)&&1!==O){var ha=this.frictionResult[this.frictionResult.length-2],ka=this.frictionResult[this.frictionResult.length-1];m.setZero();l.setZero();r.setZero();for(var ba=X.bi,ea=0;ea!==O;ea++)X=this.result[this.result.length-1-ea],X.bodyA!==ba?(m.vadd(X.ni,m),l.vadd(X.ri,l),r.vadd(X.rj,r)):(m.vsub(X.ni,m),l.vadd(X.rj,l),r.vadd(X.ri,r));O=1/O;l.scale(O,ha.ri);r.scale(O,ha.rj);ka.ri.copy(ha.ri);ka.rj.copy(ha.rj);m.normalize();m.tangents(ha.t,
ka.t)}};var u=new a,v=new a,x=new k,w=new k;b.prototype.getContacts=function(O,X,ha,ka,ba,ea,la){this.contactPointPool=ba;this.frictionEquationPool=la;this.result=ka;this.frictionResult=ea;ka=0;for(ba=O.length;ka!==ba;ka++){ea=O[ka];la=X[ka];var pa=null;ea.material&&la.material&&(pa=ha.getContactMaterial(ea.material,la.material)||null);for(var na=0;na<ea.shapes.length;na++){ea.quaternion.mult(ea.shapeOrientations[na],x);ea.quaternion.vmult(ea.shapeOffsets[na],u);u.vadd(ea.position,u);for(var ia=ea.shapes[na],
Y=0;Y<la.shapes.length;Y++){la.quaternion.mult(la.shapeOrientations[Y],w);la.quaternion.vmult(la.shapeOffsets[Y],v);v.vadd(la.position,v);var ra=la.shapes[Y];if(!(u.distanceTo(v)>ia.boundingSphereRadius+ra.boundingSphereRadius)){var oa=null;ia.material&&ra.material&&(oa=ha.getContactMaterial(ia.material,ra.material)||null);this.currentContactMaterial=oa||pa||ha.defaultContactMaterial;(oa=this[ia.type|ra.type])&&(ia.type<ra.type?oa.call(this,ia,ra,u,v,x,w,ea,la,ia,ra):oa.call(this,ra,ia,v,u,w,x,la,
ea,ia,ra))}}}}};b.prototype[q.types.BOX|q.types.BOX]=b.prototype.boxBox=function(O,X,ha,ka,ba,ea,la,pa){O.convexPolyhedronRepresentation.material=O.material;X.convexPolyhedronRepresentation.material=X.material;O.convexPolyhedronRepresentation.collisionResponse=O.collisionResponse;X.convexPolyhedronRepresentation.collisionResponse=X.collisionResponse;this.convexConvex(O.convexPolyhedronRepresentation,X.convexPolyhedronRepresentation,ha,ka,ba,ea,la,pa,O,X)};b.prototype[q.types.BOX|q.types.CONVEXPOLYHEDRON]=
b.prototype.boxConvex=function(O,X,ha,ka,ba,ea,la,pa){O.convexPolyhedronRepresentation.material=O.material;O.convexPolyhedronRepresentation.collisionResponse=O.collisionResponse;this.convexConvex(O.convexPolyhedronRepresentation,X,ha,ka,ba,ea,la,pa,O,X)};b.prototype[q.types.BOX|q.types.PARTICLE]=b.prototype.boxParticle=function(O,X,ha,ka,ba,ea,la,pa){O.convexPolyhedronRepresentation.material=O.material;O.convexPolyhedronRepresentation.collisionResponse=O.collisionResponse;this.convexParticle(O.convexPolyhedronRepresentation,
X,ha,ka,ba,ea,la,pa,O,X)};b.prototype[q.types.SPHERE]=b.prototype.sphereSphere=function(O,X,ha,ka,ba,ea,la,pa){ba=this.createContactEquation(la,pa,O,X);ka.vsub(ha,ba.ni);ba.ni.normalize();ba.ri.copy(ba.ni);ba.rj.copy(ba.ni);ba.ri.mult(O.radius,ba.ri);ba.rj.mult(-X.radius,ba.rj);ba.ri.vadd(ha,ba.ri);ba.ri.vsub(la.position,ba.ri);ba.rj.vadd(ka,ba.rj);ba.rj.vsub(pa.position,ba.rj);this.result.push(ba);this.createFrictionEquationsFromContact(ba,this.frictionResult)};var G=new a,N=new a,K=new a;b.prototype[q.types.PLANE|
q.types.TRIMESH]=b.prototype.planeTrimesh=function(O,X,ha,ka,ba,ea,la,pa){var na=new a;G.set(0,0,1);ba.vmult(G,G);for(ba=0;ba<X.vertices.length/3;ba++){X.getVertex(ba,na);var ia=new a;ia.copy(na);g.pointToWorldFrame(ka,ea,ia,na);ia=N;na.vsub(ha,ia);if(0>=G.dot(ia)){var Y=this.createContactEquation(la,pa,O,X);Y.ni.copy(G);var ra=K;G.scale(ia.dot(G),ra);na.vsub(ra,ra);Y.ri.copy(ra);Y.ri.vsub(la.position,Y.ri);Y.rj.copy(na);Y.rj.vsub(pa.position,Y.rj);this.result.push(Y);this.createFrictionEquationsFromContact(Y,
this.frictionResult)}}};var T=new a,L=new a;new a;var C=new a,D=new a,H=new a,P=new a,y=new a,V=new a,E=new a,R=new a,M=new a,A=new a,B=new a,t=new n,z=[];b.prototype[q.types.SPHERE|q.types.TRIMESH]=b.prototype.sphereTrimesh=function(O,X,ha,ka,ba,ea,la,pa){g.pointToLocalFrame(ka,ea,ha,E);ba=O.radius;t.lowerBound.set(E.x-ba,E.y-ba,E.z-ba);t.upperBound.set(E.x+ba,E.y+ba,E.z+ba);X.getTrianglesInAABB(t,z);var na=O.radius*O.radius;for(ba=0;ba<z.length;ba++)for(var ia=0;3>ia;ia++)if(X.getVertex(X.indices[3*
z[ba]+ia],C),C.vsub(E,L),L.norm2()<=na){D.copy(C);g.pointToWorldFrame(ka,ea,D,C);C.vsub(ha,L);var Y=this.createContactEquation(la,pa,O,X);Y.ni.copy(L);Y.ni.normalize();Y.ri.copy(Y.ni);Y.ri.scale(O.radius,Y.ri);Y.ri.vadd(ha,Y.ri);Y.ri.vsub(la.position,Y.ri);Y.rj.copy(C);Y.rj.vsub(pa.position,Y.rj);this.result.push(Y);this.createFrictionEquationsFromContact(Y,this.frictionResult)}for(ba=0;ba<z.length;ba++)for(ia=0;3>ia;ia++)X.getVertex(X.indices[3*z[ba]+ia],H),X.getVertex(X.indices[3*z[ba]+(ia+1)%3],
P),P.vsub(H,y),E.vsub(P,R),ha=R.dot(y),E.vsub(H,R),Y=R.dot(y),0<Y&&0>ha&&(E.vsub(H,R),V.copy(y),V.normalize(),Y=R.dot(V),V.scale(Y,R),R.vadd(H,R),ha=R.distanceTo(E),ha<O.radius&&(Y=this.createContactEquation(la,pa,O,X),R.vsub(E,Y.ni),Y.ni.normalize(),Y.ni.scale(O.radius,Y.ri),g.pointToWorldFrame(ka,ea,R,R),R.vsub(pa.position,Y.rj),g.vectorToWorldFrame(ea,Y.ni,Y.ni),g.vectorToWorldFrame(ea,Y.ri,Y.ri),this.result.push(Y),this.createFrictionEquationsFromContact(Y,this.frictionResult)));ba=0;for(ia=z.length;ba!==
ia;ba++)X.getTriangleVertices(z[ba],M,A,B),X.getNormal(z[ba],T),E.vsub(M,R),ha=R.dot(T),T.scale(ha,R),E.vsub(R,R),ha=R.distanceTo(E),c.pointInTriangle(R,M,A,B)&&ha<O.radius&&(Y=this.createContactEquation(la,pa,O,X),R.vsub(E,Y.ni),Y.ni.normalize(),Y.ni.scale(O.radius,Y.ri),g.pointToWorldFrame(ka,ea,R,R),R.vsub(pa.position,Y.rj),g.vectorToWorldFrame(ea,Y.ni,Y.ni),g.vectorToWorldFrame(ea,Y.ri,Y.ri),this.result.push(Y),this.createFrictionEquationsFromContact(Y,this.frictionResult));z.length=0};var J=
new a,I=new a;b.prototype[q.types.SPHERE|q.types.PLANE]=b.prototype.spherePlane=function(O,X,ha,ka,ba,ea,la,pa){X=this.createContactEquation(la,pa,O,X);X.ni.set(0,0,1);ea.vmult(X.ni,X.ni);X.ni.negate(X.ni);X.ni.normalize();X.ni.mult(O.radius,X.ri);ha.vsub(ka,J);X.ni.mult(X.ni.dot(J),I);J.vsub(I,X.rj);-J.dot(X.ni)<=O.radius&&(O=X.ri,ea=X.rj,O.vadd(ha,O),O.vsub(la.position,O),ea.vadd(ka,ea),ea.vsub(pa.position,ea),this.result.push(X),this.createFrictionEquationsFromContact(X,this.frictionResult))};
var Q=new a,F=new a,U=new a,Z=new a,S=new a,W=new a,ma=new a,ja=[new a,new a,new a,new a,new a,new a],fa=new a,qa=new a,aa=new a,ca=new a;b.prototype[q.types.SPHERE|q.types.BOX]=b.prototype.sphereBox=function(O,X,ha,ka,ba,ea,la,pa){ba=this.v3pool;ha.vsub(ka,Z);X.getSideNormals(ja,ea);ea=O.radius;for(var na=!1,ia=null,Y=0,ra=0,oa=0,wa=null,xa=0,ya=ja.length;xa!==ya&&!1===na;xa++){var za=S;za.copy(ja[xa]);var Aa=za.norm();za.normalize();var sa=Z.dot(za);if(sa<Aa+ea&&0<sa){var Ba=W,Da=ma;Ba.copy(ja[(xa+
1)%3]);Da.copy(ja[(xa+2)%3]);var Ea=Ba.norm(),Ha=Da.norm();Ba.normalize();Da.normalize();var Fa=Z.dot(Ba),Ga=Z.dot(Da);Fa<Ea&&Fa>-Ea&&Ga<Ha&&Ga>-Ha&&(sa=Math.abs(sa-Aa-ea),null===wa||sa<wa)&&(wa=sa,ra=Fa,oa=Ga,ia=Aa,qa.copy(za),aa.copy(Ba),ca.copy(Da),Y++)}}Y&&(na=!0,Y=this.createContactEquation(la,pa,O,X),qa.mult(-ea,Y.ri),Y.ni.copy(qa),Y.ni.negate(Y.ni),qa.mult(ia,qa),aa.mult(ra,aa),qa.vadd(aa,qa),ca.mult(oa,ca),qa.vadd(ca,Y.rj),Y.ri.vadd(ha,Y.ri),Y.ri.vsub(la.position,Y.ri),Y.rj.vadd(ka,Y.rj),
Y.rj.vsub(pa.position,Y.rj),this.result.push(Y),this.createFrictionEquationsFromContact(Y,this.frictionResult));sa=ba.get();for(ia=0;2!==ia&&!na;ia++)for(ra=0;2!==ra&&!na;ra++)for(oa=0;2!==oa&&!na;oa++)sa.set(0,0,0),ia?sa.vadd(ja[0],sa):sa.vsub(ja[0],sa),ra?sa.vadd(ja[1],sa):sa.vsub(ja[1],sa),oa?sa.vadd(ja[2],sa):sa.vsub(ja[2],sa),ka.vadd(sa,fa),fa.vsub(ha,fa),fa.norm2()<ea*ea&&(na=!0,Y=this.createContactEquation(la,pa,O,X),Y.ri.copy(fa),Y.ri.normalize(),Y.ni.copy(Y.ri),Y.ri.mult(ea,Y.ri),Y.rj.copy(sa),
Y.ri.vadd(ha,Y.ri),Y.ri.vsub(la.position,Y.ri),Y.rj.vadd(ka,Y.rj),Y.rj.vsub(pa.position,Y.rj),this.result.push(Y),this.createFrictionEquationsFromContact(Y,this.frictionResult));ba.release(sa);wa=ba.get();xa=ba.get();Y=ba.get();ya=ba.get();sa=ba.get();za=ja.length;for(ia=0;ia!==za&&!na;ia++)for(ra=0;ra!==za&&!na;ra++)if(ia%3!==ra%3){ja[ra].cross(ja[ia],wa);wa.normalize();ja[ia].vadd(ja[ra],xa);Y.copy(ha);Y.vsub(xa,Y);Y.vsub(ka,Y);Aa=Y.dot(wa);wa.mult(Aa,ya);for(oa=0;oa===ia%3||oa===ra%3;)oa++;sa.copy(ha);
sa.vsub(ya,sa);sa.vsub(xa,sa);sa.vsub(ka,sa);Aa=Math.abs(Aa);Ba=sa.norm();Aa<ja[oa].norm()&&Ba<ea&&(na=!0,oa=this.createContactEquation(la,pa,O,X),xa.vadd(ya,oa.rj),oa.rj.copy(oa.rj),sa.negate(oa.ni),oa.ni.normalize(),oa.ri.copy(oa.rj),oa.ri.vadd(ka,oa.ri),oa.ri.vsub(ha,oa.ri),oa.ri.normalize(),oa.ri.mult(ea,oa.ri),oa.ri.vadd(ha,oa.ri),oa.ri.vsub(la.position,oa.ri),oa.rj.vadd(ka,oa.rj),oa.rj.vsub(pa.position,oa.rj),this.result.push(oa),this.createFrictionEquationsFromContact(oa,this.frictionResult))}ba.release(wa,
xa,Y,ya,sa)};var da=new a,ta=new a,va=new a,ua=new a,Ca=new a,Sa=new a,Ua=new a,eb=new a,fb=new a,gb=new a;b.prototype[q.types.SPHERE|q.types.CONVEXPOLYHEDRON]=b.prototype.sphereConvex=function(O,X,ha,ka,ba,ea,la,pa){ba=this.v3pool;ha.vsub(ka,da);for(var na=X.faceNormals,ia=X.faces,Y=X.vertices,ra=O.radius,oa=0;oa!==Y.length;oa++){var wa=Ca;ea.vmult(Y[oa],wa);ka.vadd(wa,wa);var xa=ua;wa.vsub(ha,xa);if(xa.norm2()<ra*ra){O=this.createContactEquation(la,pa,O,X);O.ri.copy(xa);O.ri.normalize();O.ni.copy(O.ri);
O.ri.mult(ra,O.ri);wa.vsub(ka,O.rj);O.ri.vadd(ha,O.ri);O.ri.vsub(la.position,O.ri);O.rj.vadd(ka,O.rj);O.rj.vsub(pa.position,O.rj);this.result.push(O);this.createFrictionEquationsFromContact(O,this.frictionResult);return}}oa=0;for(wa=ia.length;oa!==wa;oa++){xa=ia[oa];var ya=Sa;ea.vmult(na[oa],ya);var za=Ua;ea.vmult(Y[xa[0]],za);za.vadd(ka,za);var Aa=eb;ya.mult(-ra,Aa);ha.vadd(Aa,Aa);var sa=fb;Aa.vsub(za,sa);Aa=sa.dot(ya);sa=gb;ha.vsub(za,sa);if(0>Aa&&0<sa.dot(ya)){za=[];sa=0;for(var Ba=xa.length;sa!==
Ba;sa++){var Da=ba.get();ea.vmult(Y[xa[sa]],Da);ka.vadd(Da,Da);za.push(Da)}a:{sa=za;Ba=ya;Da=ha;for(var Ea=null,Ha=sa.length,Fa=0;Fa!==Ha;Fa++){var Ga=sa[Fa],Ta=Q;sa[(Fa+1)%Ha].vsub(Ga,Ta);var $a=F;Ta.cross(Ba,$a);Ta=U;Da.vsub(Ga,Ta);Ga=$a.dot(Ta);if(null===Ea||0<Ga&&!0===Ea||0>=Ga&&!1===Ea)null===Ea&&(Ea=0<Ga);else{sa=!1;break a}}sa=!0}if(sa){O=this.createContactEquation(la,pa,O,X);ya.mult(-ra,O.ri);ya.negate(O.ni);X=ba.get();ya.mult(-Aa,X);ea=ba.get();ya.mult(-ra,ea);ha.vsub(ka,O.rj);O.rj.vadd(ea,
O.rj);O.rj.vadd(X,O.rj);O.rj.vadd(ka,O.rj);O.rj.vsub(pa.position,O.rj);O.ri.vadd(ha,O.ri);O.ri.vsub(la.position,O.ri);ba.release(X);ba.release(ea);this.result.push(O);this.createFrictionEquationsFromContact(O,this.frictionResult);sa=0;for(xa=za.length;sa!==xa;sa++)ba.release(za[sa]);break}else for(sa=0;sa!==xa.length;sa++){ya=ba.get();Aa=ba.get();ea.vmult(Y[xa[(sa+1)%xa.length]],ya);ea.vmult(Y[xa[(sa+2)%xa.length]],Aa);ka.vadd(ya,ya);ka.vadd(Aa,Aa);Ha=ta;Aa.vsub(ya,Ha);Ea=va;Ha.unit(Ea);Ba=ba.get();
Da=ba.get();ha.vsub(ya,Da);Fa=Da.dot(Ea);Ea.mult(Fa,Ba);Ba.vadd(ya,Ba);Ea=ba.get();Ba.vsub(ha,Ea);if(0<Fa&&Fa*Fa<Ha.norm2()&&Ea.norm2()<ra*ra){O=this.createContactEquation(la,pa,O,X);Ba.vsub(ka,O.rj);Ba.vsub(ha,O.ni);O.ni.normalize();O.ni.mult(ra,O.ri);O.rj.vadd(ka,O.rj);O.rj.vsub(pa.position,O.rj);O.ri.vadd(ha,O.ri);O.ri.vsub(la.position,O.ri);this.result.push(O);this.createFrictionEquationsFromContact(O,this.frictionResult);sa=0;for(xa=za.length;sa!==xa;sa++)ba.release(za[sa]);ba.release(ya);ba.release(Aa);
ba.release(Ba);ba.release(Ea);ba.release(Da);return}ba.release(ya);ba.release(Aa);ba.release(Ba);ba.release(Ea);ba.release(Da)}sa=0;for(xa=za.length;sa!==xa;sa++)ba.release(za[sa])}}};new a;new a;b.prototype[q.types.PLANE|q.types.BOX]=b.prototype.planeBox=function(O,X,ha,ka,ba,ea,la,pa){X.convexPolyhedronRepresentation.material=X.material;X.convexPolyhedronRepresentation.collisionResponse=X.collisionResponse;this.planeConvex(O,X.convexPolyhedronRepresentation,ha,ka,ba,ea,la,pa)};var Ia=new a,Ja=new a,
Xa=new a,hb=new a;b.prototype[q.types.PLANE|q.types.CONVEXPOLYHEDRON]=b.prototype.planeConvex=function(O,X,ha,ka,ba,ea,la,pa){Ja.set(0,0,1);ba.vmult(Ja,Ja);for(var na=ba=0;na!==X.vertices.length;na++)if(Ia.copy(X.vertices[na]),ea.vmult(Ia,Ia),ka.vadd(Ia,Ia),Ia.vsub(ha,Xa),0>=Ja.dot(Xa)){var ia=this.createContactEquation(la,pa,O,X),Y=hb;Ja.mult(Ja.dot(Xa),Y);Ia.vsub(Y,Y);Y.vsub(ha,ia.ri);ia.ni.copy(Ja);Ia.vsub(ka,ia.rj);ia.ri.vadd(ha,ia.ri);ia.ri.vsub(la.position,ia.ri);ia.rj.vadd(ka,ia.rj);ia.rj.vsub(pa.position,
ia.rj);this.result.push(ia);ba++;this.enableFrictionReduction||this.createFrictionEquationsFromContact(ia,this.frictionResult)}this.enableFrictionReduction&&ba&&this.createFrictionFromAverage(ba)};var Ya=new a,Va=new a;b.prototype[q.types.CONVEXPOLYHEDRON]=b.prototype.convexConvex=function(O,X,ha,ka,ba,ea,la,pa,na,ia,Y,ra){if(!(ha.distanceTo(ka)>O.boundingSphereRadius+X.boundingSphereRadius)&&O.findSeparatingAxis(X,ha,ba,ka,ea,Ya,Y,ra)){Y=[];O.clipAgainstHull(ha,ba,X,ka,ea,Ya,-100,100,Y);for(ea=ba=
0;ea!==Y.length;ea++){ra=this.createContactEquation(la,pa,O,X,na,ia);var oa=ra.ri,wa=ra.rj;Ya.negate(ra.ni);Y[ea].normal.negate(Va);Va.mult(Y[ea].depth,Va);Y[ea].point.vadd(Va,oa);wa.copy(Y[ea].point);oa.vsub(ha,oa);wa.vsub(ka,wa);oa.vadd(ha,oa);oa.vsub(la.position,oa);wa.vadd(ka,wa);wa.vsub(pa.position,wa);this.result.push(ra);ba++;this.enableFrictionReduction||this.createFrictionEquationsFromContact(ra,this.frictionResult)}this.enableFrictionReduction&&ba&&this.createFrictionFromAverage(ba)}};var Ka=
new a,ab=new a,Wa=new a;b.prototype[q.types.PLANE|q.types.PARTICLE]=b.prototype.planeParticle=function(O,X,ha,ka,ba,ea,la,pa){Ka.set(0,0,1);la.quaternion.vmult(Ka,Ka);ka.vsub(la.position,ab);0>=Ka.dot(ab)&&(O=this.createContactEquation(pa,la,X,O),O.ni.copy(Ka),O.ni.negate(O.ni),O.ri.set(0,0,0),Ka.mult(Ka.dot(ka),Wa),ka.vsub(Wa,Wa),O.rj.copy(Wa),this.result.push(O),this.createFrictionEquationsFromContact(O,this.frictionResult))};var Na=new a;b.prototype[q.types.PARTICLE|q.types.SPHERE]=b.prototype.sphereParticle=
function(O,X,ha,ka,ba,ea,la,pa){Na.set(0,0,1);ka.vsub(ha,Na);Na.norm2()<=O.radius*O.radius&&(X=this.createContactEquation(pa,la,X,O),Na.normalize(),X.rj.copy(Na),X.rj.mult(O.radius,X.rj),X.ni.copy(Na),X.ni.negate(X.ni),X.ri.set(0,0,0),this.result.push(X),this.createFrictionEquationsFromContact(X,this.frictionResult))};var bb=new k,Oa=new a;new a;var Za=new a,cb=new a,Pa=new a;b.prototype[q.types.PARTICLE|q.types.CONVEXPOLYHEDRON]=b.prototype.convexParticle=function(O,X,ha,ka,ba,ea,la,pa){var na=-1;
ea=null;var ia=0;Oa.copy(ka);Oa.vsub(ha,Oa);ba.conjugate(bb);bb.vmult(Oa,Oa);if(O.pointIsInside(Oa)){O.worldVerticesNeedsUpdate&&O.computeWorldVertices(ha,ba);O.worldFaceNormalsNeedsUpdate&&O.computeWorldFaceNormals(ba);ba=0;for(var Y=O.faces.length;ba!==Y;ba++){var ra=O.worldFaceNormals[ba];ka.vsub(O.worldVertices[O.faces[ba][0]],cb);var oa=-ra.dot(cb);if(null===ea||Math.abs(oa)<Math.abs(ea))ea=oa,na=ba,Za.copy(ra),ia++}-1!==na?(O=this.createContactEquation(pa,la,X,O),Za.mult(ea,Pa),Pa.vadd(ka,Pa),
Pa.vsub(ha,Pa),O.rj.copy(Pa),Za.negate(O.ni),O.ri.set(0,0,0),X=O.ri,ea=O.rj,X.vadd(ka,X),X.vsub(pa.position,X),ea.vadd(ha,ea),ea.vsub(la.position,ea),this.result.push(O),this.createFrictionEquationsFromContact(O,this.frictionResult)):console.warn("Point found inside convex, but did not find penetrating face!")}};b.prototype[q.types.BOX|q.types.HEIGHTFIELD]=b.prototype.boxHeightfield=function(O,X,ha,ka,ba,ea,la,pa){O.convexPolyhedronRepresentation.material=O.material;O.convexPolyhedronRepresentation.collisionResponse=
O.collisionResponse;this.convexHeightfield(O.convexPolyhedronRepresentation,X,ha,ka,ba,ea,la,pa)};var La=new a,Qa=new a,db=[0];b.prototype[q.types.CONVEXPOLYHEDRON|q.types.HEIGHTFIELD]=b.prototype.convexHeightfield=function(O,X,ha,ka,ba,ea,la,pa){var na=X.data,ia=X.elementSize,Y=O.boundingSphereRadius;g.pointToLocalFrame(ka,ea,ha,La);var ra=Math.floor((La.x-Y)/ia)-1,oa=Math.ceil((La.x+Y)/ia)+1,wa=Math.floor((La.y-Y)/ia)-1;ia=Math.ceil((La.y+Y)/ia)+1;if(!(0>oa||0>ia||ra>na.length||wa>na[0].length)){0>
ra&&(ra=0);0>oa&&(oa=0);0>wa&&(wa=0);0>ia&&(ia=0);ra>=na.length&&(ra=na.length-1);oa>=na.length&&(oa=na.length-1);ia>=na[0].length&&(ia=na[0].length-1);wa>=na[0].length&&(wa=na[0].length-1);na=[];X.getRectMinMax(ra,wa,oa,ia,na);var xa=na[0];if(!(La.z-Y>na[1]||La.z+Y<xa))for(Y=ra;Y<oa;Y++)for(ra=wa;ra<ia;ra++)X.getConvexTrianglePillar(Y,ra,!1),g.pointToWorldFrame(ka,ea,X.pillarOffset,Qa),ha.distanceTo(Qa)<X.pillarConvex.boundingSphereRadius+O.boundingSphereRadius&&this.convexConvex(O,X.pillarConvex,
ha,Qa,ba,ea,la,pa,null,null,db,null),X.getConvexTrianglePillar(Y,ra,!0),g.pointToWorldFrame(ka,ea,X.pillarOffset,Qa),ha.distanceTo(Qa)<X.pillarConvex.boundingSphereRadius+O.boundingSphereRadius&&this.convexConvex(O,X.pillarConvex,ha,Qa,ba,ea,la,pa,null,null,db,null)}};var Ma=new a,Ra=new a;b.prototype[q.types.SPHERE|q.types.HEIGHTFIELD]=b.prototype.sphereHeightfield=function(O,X,ha,ka,ba,ea,la,pa){var na=X.data,ia=O.radius,Y=X.elementSize;g.pointToLocalFrame(ka,ea,ha,Ma);var ra=Math.floor((Ma.x-ia)/
Y)-1,oa=Math.ceil((Ma.x+ia)/Y)+1,wa=Math.floor((Ma.y-ia)/Y)-1;Y=Math.ceil((Ma.y+ia)/Y)+1;if(!(0>oa||0>Y||ra>na.length||Y>na[0].length)){0>ra&&(ra=0);0>oa&&(oa=0);0>wa&&(wa=0);0>Y&&(Y=0);ra>=na.length&&(ra=na.length-1);oa>=na.length&&(oa=na.length-1);Y>=na[0].length&&(Y=na[0].length-1);wa>=na[0].length&&(wa=na[0].length-1);na=[];X.getRectMinMax(ra,wa,oa,Y,na);var xa=na[0];if(!(Ma.z-ia>na[1]||Ma.z+ia<xa))for(ia=this.result;ra<oa;ra++)for(na=wa;na<Y;na++)if(xa=ia.length,X.getConvexTrianglePillar(ra,
na,!1),g.pointToWorldFrame(ka,ea,X.pillarOffset,Ra),ha.distanceTo(Ra)<X.pillarConvex.boundingSphereRadius+O.boundingSphereRadius&&this.sphereConvex(O,X.pillarConvex,ha,Ra,ba,ea,la,pa),X.getConvexTrianglePillar(ra,na,!0),g.pointToWorldFrame(ka,ea,X.pillarOffset,Ra),ha.distanceTo(Ra)<X.pillarConvex.boundingSphereRadius+O.boundingSphereRadius&&this.sphereConvex(O,X.pillarConvex,ha,Ra,ba,ea,la,pa),2<ia.length-xa)return}}},{"../collision/AABB":3,"../collision/Ray":9,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,
"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43,"../solver/Solver":47,"../utils/Vec3Pool":54}],56:[function(e,n,q){function b(){k.apply(this);this.dt=-1;this.allowSleep=!1;this.contacts=[];this.frictionEquations=[];this.quatNormalizeSkip=0;this.quatNormalizeFast=!1;this.stepnumber=this.time=0;this.default_dt=1/60;this.nextId=0;this.gravity=new c;this.broadphase=new v;this.bodies=[];this.solver=new a;this.constraints=[];this.narrowphase=
new g(this);this.collisionMatrix=new d;this.collisionMatrixPrevious=new d;this.materials=[];this.contactmaterials=[];this.contactMaterialTable=new l;this.defaultMaterial=new f("default");this.defaultContactMaterial=new h(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0});this.doProfiling=!1;this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0};this.subsystems=[];this.addBodyEvent={type:"addBody",body:null};this.removeBodyEvent={type:"removeBody",
body:null}}n.exports=b;e("../shapes/Shape");var c=e("../math/Vec3");n=e("../math/Quaternion");var a=e("../solver/GSSolver");e("../utils/Vec3Pool");e("../equations/ContactEquation");e("../equations/FrictionEquation");var g=e("./Narrowphase"),k=e("../utils/EventTarget"),d=e("../collision/ArrayCollisionMatrix"),f=e("../material/Material"),h=e("../material/ContactMaterial"),m=e("../objects/Body"),l=e("../utils/TupleDictionary"),r=e("../collision/RaycastResult");q=e("../collision/AABB");var u=e("../collision/Ray"),
v=e("../collision/NaiveBroadphase");b.prototype=new k;new q;var x=new u;b.prototype.getContactMaterial=function(E,R){return this.contactMaterialTable.get(E.id,R.id)};b.prototype.numObjects=function(){return this.bodies.length};b.prototype.collisionMatrixTick=function(){var E=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix;this.collisionMatrix=E;this.collisionMatrix.reset()};b.prototype.add=b.prototype.addBody=function(E){-1===this.bodies.indexOf(E)&&(E.index=this.bodies.length,
this.bodies.push(E),E.world=this,E.initPosition.copy(E.position),E.initVelocity.copy(E.velocity),E.timeLastSleepy=this.time,E instanceof m&&(E.initAngularVelocity.copy(E.angularVelocity),E.initQuaternion.copy(E.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=E,this.dispatchEvent(this.addBodyEvent))};b.prototype.addConstraint=function(E){this.constraints.push(E)};b.prototype.removeConstraint=function(E){E=this.constraints.indexOf(E);-1!==E&&this.constraints.splice(E,
1)};b.prototype.rayTest=function(E,R,M){M instanceof r?this.raycastClosest(E,R,{skipBackfaces:!0},M):this.raycastAll(E,R,{skipBackfaces:!0},M)};b.prototype.raycastAll=function(E,R,M,A){M.mode=u.ALL;M.from=E;M.to=R;M.callback=A;return x.intersectWorld(this,M)};b.prototype.raycastAny=function(E,R,M,A){M.mode=u.ANY;M.from=E;M.to=R;M.result=A;return x.intersectWorld(this,M)};b.prototype.raycastClosest=function(E,R,M,A){M.mode=u.CLOSEST;M.from=E;M.to=R;M.result=A;return x.intersectWorld(this,M)};b.prototype.remove=
function(E){E.world=null;var R=this.bodies.length-1,M=this.bodies,A=M.indexOf(E);if(-1!==A){M.splice(A,1);for(A=0;A!==M.length;A++)M[A].index=A;this.collisionMatrix.setNumObjects(R);this.removeBodyEvent.body=E;this.dispatchEvent(this.removeBodyEvent)}};b.prototype.removeBody=b.prototype.remove;b.prototype.addMaterial=function(E){this.materials.push(E)};b.prototype.addContactMaterial=function(E){this.contactmaterials.push(E);this.contactMaterialTable.set(E.materials[0].id,E.materials[1].id,E)};"undefined"===
typeof performance&&(performance={});if(!performance.now){var w=Date.now();performance.timing&&performance.timing.navigationStart&&(w=performance.timing.navigationStart);performance.now=function(){return Date.now()-w}}var G=new c;b.prototype.step=function(E,R,M){M=M||10;R=R||0;if(0===R)this.internalStep(E),this.time+=E;else{var A=Math.floor((this.time+R)/E)-Math.floor(this.time/E);A=Math.min(A,M);M=performance.now();for(var B=0;B!==A&&!(this.internalStep(E),performance.now()-M>1E3*E);B++);this.time+=
R;E=this.time%E/E;R=this.bodies;for(A=0;A!==R.length;A++)M=R[A],M.type!==m.STATIC&&M.sleepState!==m.SLEEPING?(M.position.vsub(M.previousPosition,G),G.scale(E,G),M.position.vadd(G,M.interpolatedPosition)):(M.interpolatedPosition.copy(M.position),M.interpolatedQuaternion.copy(M.quaternion))}};var N={type:"postStep"},K={type:"preStep"},T={type:"collide",body:null,contact:null},L=[],C=[],D=[],H=[];new c;new c;new c;new c;new c;new c;new c;new c;new c;new n;var P=new n,y=new n,V=new c;b.prototype.internalStep=
function(E){this.dt=E;var R=this.contacts,M=this.numObjects(),A=this.bodies,B=this.solver,t=this.gravity,z=this.doProfiling,J=this.profile,I=m.DYNAMIC,Q,F=this.constraints;t.norm();var U=t.x,Z=t.y,S=t.z;z&&(Q=performance.now());for(t=0;t!==M;t++){var W=A[t];if(W.type&I){var ma=W.force;W=W.mass;ma.x+=W*U;ma.y+=W*Z;ma.z+=W*S}}t=0;for(W=this.subsystems.length;t!==W;t++)this.subsystems[t].update();z&&(Q=performance.now());D.length=0;H.length=0;this.broadphase.collisionPairs(this,D,H);z&&(J.broadphase=
performance.now()-Q);W=F.length;for(t=0;t!==W;t++)if(U=F[t],!U.collideConnected)for(Z=D.length-1;0<=Z;--Z)if(U.bodyA===D[Z]&&U.bodyB===H[Z]||U.bodyB===D[Z]&&U.bodyA===H[Z])D.splice(Z,1),H.splice(Z,1);this.collisionMatrixTick();z&&(Q=performance.now());W=R.length;for(t=0;t!==W;t++)L.push(R[t]);R.length=0;W=this.frictionEquations.length;for(t=0;t!==W;t++)C.push(this.frictionEquations[t]);this.frictionEquations.length=0;this.narrowphase.getContacts(D,H,this,R,L,this.frictionEquations,C);z&&(J.narrowphase=
performance.now()-Q);z&&(Q=performance.now());for(t=0;t<this.frictionEquations.length;t++)B.addEquation(this.frictionEquations[t]);t=R.length;for(Z=0;Z!==t;Z++)U=R[Z],W=U.bi,S=U.bj,W.material&&S.material&&this.getContactMaterial(W.material,S.material),W.material&&S.material&&0<=W.material.restitution&&0<=S.material.restitution&&(U.restitution=W.material.restitution*S.material.restitution),B.addEquation(U),W.allowSleep&&W.type===m.DYNAMIC&&W.sleepState===m.SLEEPING&&S.sleepState===m.AWAKE&&S.type!==
m.STATIC&&S.velocity.norm2()+S.angularVelocity.norm2()>=2*Math.pow(S.sleepSpeedLimit,2)&&(W._wakeUpAfterNarrowphase=!0),S.allowSleep&&S.type===m.DYNAMIC&&S.sleepState===m.SLEEPING&&W.sleepState===m.AWAKE&&W.type!==m.STATIC&&W.velocity.norm2()+W.angularVelocity.norm2()>=2*Math.pow(W.sleepSpeedLimit,2)&&(S._wakeUpAfterNarrowphase=!0),this.collisionMatrix.set(W,S,!0),this.collisionMatrixPrevious.get(W,S)||(T.body=S,T.contact=U,W.dispatchEvent(T),T.body=W,S.dispatchEvent(T));z&&(J.makeContactConstraints=
performance.now()-Q,Q=performance.now());for(t=0;t!==M;t++)W=A[t],W._wakeUpAfterNarrowphase&&(W.wakeUp(),W._wakeUpAfterNarrowphase=!1);W=F.length;for(t=0;t!==W;t++)for(U=F[t],U.update(),Z=0,R=U.equations.length;Z!==R;Z++)B.addEquation(U.equations[Z]);B.solve(E,this);z&&(J.solve=performance.now()-Q);B.removeAllEquations();B=Math.pow;for(t=0;t!==M;t++)if(W=A[t],W.type&I&&(F=B(1-W.linearDamping,E),R=W.velocity,R.mult(F,R),F=W.angularVelocity))R=B(1-W.angularDamping,E),F.mult(R,F);this.dispatchEvent(K);
for(t=0;t!==M;t++)W=A[t],W.preStep&&W.preStep.call(W);z&&(Q=performance.now());I=m.DYNAMIC|m.KINEMATIC;B=0===this.stepnumber%(this.quatNormalizeSkip+1);F=this.quatNormalizeFast;R=.5*E;for(t=0;t!==M;t++)if(W=A[t],U=W.force,Z=W.torque,W.type&I&&W.sleepState!==m.SLEEPING){S=W.velocity;ma=W.angularVelocity;var ja=W.position,fa=W.quaternion,qa=W.invMass,aa=W.invInertiaWorld;S.x+=U.x*qa*E;S.y+=U.y*qa*E;S.z+=U.z*qa*E;W.angularVelocity&&(aa.vmult(Z,V),V.mult(E,V),V.vadd(ma,ma));ja.x+=S.x*E;ja.y+=S.y*E;ja.z+=
S.z*E;W.angularVelocity&&(P.set(ma.x,ma.y,ma.z,0),P.mult(fa,y),fa.x+=R*y.x,fa.y+=R*y.y,fa.z+=R*y.z,fa.w+=R*y.w,B&&(F?fa.normalizeFast():fa.normalize()));W.aabb&&(W.aabbNeedsUpdate=!0);W.updateInertiaWorld&&W.updateInertiaWorld()}this.clearForces();this.broadphase.dirty=!0;z&&(J.integrate=performance.now()-Q);this.time+=E;this.stepnumber+=1;this.dispatchEvent(N);for(t=0;t!==M;t++)W=A[t],(E=W.postStep)&&E.call(W);if(this.allowSleep)for(t=0;t!==M;t++)A[t].sleepTick(this.time)};b.prototype.clearForces=
function(){for(var E=this.bodies,R=E.length,M=0;M!==R;M++){var A=E[M];A.force.set(0,0,0);A.torque.set(0,0,0)}}},{"../collision/AABB":3,"../collision/ArrayCollisionMatrix":4,"../collision/NaiveBroadphase":7,"../collision/Ray":9,"../collision/RaycastResult":10,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../material/ContactMaterial":24,"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Shape":43,"../solver/GSSolver":46,"../utils/EventTarget":49,
"../utils/TupleDictionary":52,"../utils/Vec3Pool":54,"./Narrowphase":55}]},{},[2])(2)});CANNON=CANNON||{};var camera,scene,renderer;
CANNON.Demo=function(p){function e(){if(G){for(var aa in G.__controllers)G.__controllers[aa].updateDisplay();for(var ca in G.__folders)for(aa in G.__folders[ca].__controllers)G.__folders[ca].__controllers[aa].updateDisplay()}}function n(aa){function ca(ta,va){ta.material&&(ta.material=va);for(var ua=0;ua<ta.children.length;ua++)ca(ta.children[ua],va)}if(-1===J.indexOf(aa))throw Error("Render mode "+aa+" not found!");switch(aa){case "solid":m.currentMaterial=C;I.intensity=1;Q.color.setHex(2236962);
break;case "wireframe":m.currentMaterial=D,I.intensity=0,Q.color.setHex(16777215)}for(var da=0;da<x.length;da++)ca(x[da],m.currentMaterial);r.rendermode=aa}function q(){for(var aa=v.length,ca=0;ca<aa;ca++){var da=v[ca];da.position.copy(da.initPosition);da.velocity.copy(da.initVelocity);da.initAngularVelocity&&(da.angularVelocity.copy(da.initAngularVelocity),da.quaternion.copy(da.initQuaternion))}}function b(aa){0===aa.x&&(aa.x=1E-6);0===aa.y&&(aa.y=1E-6);0===aa.z&&(aa.z=1E-6)}function c(){for(var aa=
v.length,ca=0;ca<aa;ca++){var da=v[ca],ta=x[ca];ta.position.copy(da.position);da.quaternion&&ta.quaternion.copy(da.quaternion)}P.restart();if(r.contacts)for(ca=0;ca<z.contacts.length;ca++)for(aa=0;2>aa;aa++){ta=P.request();var va=z.contacts[ca];da=0===aa?va.bi:va.bj;var ua=0===aa?va.ri:va.rj;ta.position.set(da.position.x+ua.x,da.position.y+ua.y,da.position.z+ua.z)}P.hideCached();y.restart();if(r.cm2contact)for(ca=0;ca<z.contacts.length;ca++)for(aa=0;2>aa;aa++)ta=y.request(),va=z.contacts[ca],da=0===
aa?va.bi:va.bj,ua=0===aa?va.ri:va.rj,ta.scale.set(ua.x,ua.y,ua.z),b(ta.scale),ta.position.copy(da.position);y.hideCached();M.restart();A.restart();if(r.constraints){for(ca=0;ca<z.constraints.length;ca++)va=z.constraints[ca],va instanceof CANNON.DistanceConstraint&&(da=va.equations.normal,aa=da.bi,da=da.bj,ta=M.request(),da=da.position?da.position:da,ta.scale.set(da.x-aa.position.x,da.y-aa.position.y,da.z-aa.position.z),b(ta.scale),ta.position.copy(aa.position));for(ca=0;ca<z.constraints.length;ca++)if(va=
z.constraints[ca],va instanceof CANNON.PointToPointConstraint){ua=va.equations.normal;aa=ua.bi;da=ua.bj;ta=A.request();va=A.request();var Ca=A.request();ta.scale.set(ua.ri.x,ua.ri.y,ua.ri.z);va.scale.set(ua.rj.x,ua.rj.y,ua.rj.z);Ca.scale.set(-ua.penetrationVec.x,-ua.penetrationVec.y,-ua.penetrationVec.z);b(ta.scale);b(va.scale);b(Ca.scale);ta.position.copy(aa.position);va.position.copy(da.position);ua.bj.position.vadd(ua.rj,Ca.position)}}A.hideCached();M.hideCached();B.restart();if(r.normals)for(ca=
0;ca<z.contacts.length;ca++)va=z.contacts[ca],aa=va.bi,ta=B.request(),ua=va.ni,da=aa,ta.scale.set(ua.x,ua.y,ua.z),b(ta.scale),ta.position.copy(da.position),va.ri.vadd(ta.position,ta.position);B.hideCached();t.restart();if(r.axes)for(aa=0;aa<v.length;aa++)da=v[aa],ta=t.request(),ta.position.copy(da.position),da.quaternion&&ta.quaternion.copy(da.quaternion);t.hideCached();R.restart();if(r.aabbs)for(ca=0;ca<v.length;ca++)da=v[ca],da.computeAABB&&(da.aabbNeedsUpdate&&da.computeAABB(),isFinite(da.aabb.lowerBound.x)&&
isFinite(da.aabb.lowerBound.y)&&isFinite(da.aabb.lowerBound.z)&&isFinite(da.aabb.upperBound.x)&&isFinite(da.aabb.upperBound.y)&&isFinite(da.aabb.upperBound.z)&&0!=da.aabb.lowerBound.x-da.aabb.upperBound.x&&0!=da.aabb.lowerBound.y-da.aabb.upperBound.y&&0!=da.aabb.lowerBound.z-da.aabb.upperBound.z&&(ta=R.request(),ta.scale.set(da.aabb.lowerBound.x-da.aabb.upperBound.x,da.aabb.lowerBound.y-da.aabb.upperBound.y,da.aabb.lowerBound.z-da.aabb.upperBound.z),ta.position.set(.5*(da.aabb.lowerBound.x+da.aabb.upperBound.x),
.5*(da.aabb.lowerBound.y+da.aabb.upperBound.y),.5*(da.aabb.lowerBound.z+da.aabb.upperBound.z))));R.hideCached()}function a(){requestAnimationFrame(a);if(!r.paused){c();var aa=1/r.stepFrequency,ca=Date.now()/1E3;qa?z.step(aa,ca-qa,r.maxSubSteps):z.step(aa);qa=ca}CAMERA_TEST&&W.update();renderer.clear();renderer.render(m.scene,camera);F.update()}function g(aa){mouseX=aa.clientX-ja;mouseY=aa.clientY-fa}function k(aa){Z=s_iCanvasResizeWidth+2*s_iCanvasOffsetWidth;S=s_iCanvasResizeHeight+2*s_iCanvasOffsetHeight;
CAMERA_TEST&&(W.screen.width=Z,W.screen.height=S)}function d(aa){m.dispatchEvent({type:"destroy"});r.paused=!1;e();f(aa)}function f(aa){for(var ca=x.length,da=0;da<ca;da++){z.remove(v.pop());var ta=x.pop();m.scene.remove(ta)}for(;z.constraints.length;)z.removeConstraint(z.constraints[0]);w[aa]();r.iterations=z.solver.iterations;r.gx=z.gravity.x+0;r.gy=z.gravity.y+0;r.gz=z.gravity.z+0;r.quatNormalizeSkip=z.quatNormalizeSkip;r.quatNormalizeFast=z.quatNormalizeFast;e();P.restart();P.hideCached();y.restart();
y.hideCached();M.restart();M.hideCached();B.restart();B.hideCached()}function h(aa){var ca=[],da=[];this.request=function(){geo=ca.length?ca.pop():aa();scene.add(geo);da.push(geo);return geo};this.restart=function(){for(;da.length;)ca.push(da.pop())};this.hideCached=function(){for(var ta=0;ta<ca.length;ta++)scene.remove(ca[ta])}}var m=this;this.addScene=function(aa,ca){if("string"!==typeof aa)throw Error("1st argument of Demo.addScene(title,initfunc) must be a string!");if("function"!==typeof ca)throw Error("2nd argument of Demo.addScene(title,initfunc) must be a function!");
w.push(ca);var da=w.length-1;T[aa]=function(){d(da)};l.add(T,aa)};this.restartCurrentScene=q;this.changeScene=d;this.start=function(){f(0)};var l,r=this.settings={stepFrequency:60,quatNormalizeSkip:2,quatNormalizeFast:!0,gx:0,gy:0,gz:0,iterations:3,tolerance:1E-4,k:1E6,d:3,scene:0,paused:!1,rendermode:"solid",constraints:!1,contacts:!1,cm2contact:!1,normals:!1,axes:!1,particleSize:.1,shadows:!1,aabbs:!1,profiling:!1,maxSubSteps:3};p=p||{};for(var u in p)u in r&&(r[u]=p[u]);if(0!==r.stepFrequency%
60)throw Error("stepFrequency must be a multiple of 60.");var v=this.bodies=[],x=this.visuals=[],w=[],G=null,N=null,K=null,T={},L=new THREE.SphereGeometry(.1,6,6);this.particleGeo=new THREE.SphereGeometry(1,16,8);var C=new THREE.MeshPhongMaterial({color:11184810,specular:1118481,shininess:100}),D=new THREE.MeshLambertMaterial({color:16777215,wireframe:!0});this.currentMaterial=C;var H=new THREE.MeshPhongMaterial({color:16711680});this.particleMaterial=new THREE.MeshLambertMaterial({color:16711680});
var P=new h(function(){return new THREE.Mesh(L,H)}),y=new h(function(){var aa=new THREE.Geometry;aa.vertices.push(new THREE.Vector3(0,0,0));aa.vertices.push(new THREE.Vector3(1,1,1));return new THREE.Line(aa,new THREE.LineBasicMaterial({color:16711680}))}),V=new THREE.BoxGeometry(1,1,1),E=new THREE.MeshBasicMaterial({color:11184810,wireframe:!0}),R=new h(function(){return new THREE.Mesh(V,E)}),M=new h(function(){var aa=new THREE.Geometry;aa.vertices.push(new THREE.Vector3(0,0,0));aa.vertices.push(new THREE.Vector3(1,
1,1));return new THREE.Line(aa,new THREE.LineBasicMaterial({color:16711680}))}),A=new h(function(){var aa=new THREE.Geometry;aa.vertices.push(new THREE.Vector3(0,0,0));aa.vertices.push(new THREE.Vector3(1,1,1));return new THREE.Line(aa,new THREE.LineBasicMaterial({color:16711680}))}),B=new h(function(){var aa=new THREE.Geometry;aa.vertices.push(new THREE.Vector3(0,0,0));aa.vertices.push(new THREE.Vector3(1,1,1));return new THREE.Line(aa,new THREE.LineBasicMaterial({color:65280}))}),t=new h(function(){var aa=
new THREE.Object3D,ca=new THREE.Vector3(0,0,0),da=new THREE.Geometry,ta=new THREE.Geometry,va=new THREE.Geometry;da.vertices.push(ca);ta.vertices.push(ca);va.vertices.push(ca);da.vertices.push(new THREE.Vector3(1,0,0));ta.vertices.push(new THREE.Vector3(0,1,0));va.vertices.push(new THREE.Vector3(0,0,1));ca=new THREE.Line(da,new THREE.LineBasicMaterial({color:16711680}));ta=new THREE.Line(ta,new THREE.LineBasicMaterial({color:65280}));va=new THREE.Line(va,new THREE.LineBasicMaterial({color:255}));
aa.add(ca);aa.add(ta);aa.add(va);return aa}),z=this.world=new CANNON.World;z.broadphase=new CANNON.NaiveBroadphase;var J=["solid","wireframe"],I,Q,F,U;Detector.webgl||Detector.addGetWebGLMessage();var Z=s_iCanvasResizeWidth+s_iCanvasOffsetWidth,S=s_iCanvasResizeHeight+s_iCanvasOffsetHeight,W,ma,ja=Z/2,fa=S/2;(function(){ma=document.createElement("div");document.body.appendChild(ma);CAMERA_TEST?(NEAR=5,camera=new THREE.PerspectiveCamera(45,Z/S,NEAR,FAR),camera.lookAt(new THREE.Vector3(0,0,0)),camera.position.set(0,
500,500),camera.up.set(0,0,1)):camera=createOrthoGraphicCamera();scene=m.scene=new THREE.Scene;scene.fog=new THREE.Fog(2236962,1E3,FAR);Q=new THREE.AmbientLight(4473924);scene.add(Q);I=new THREE.DirectionalLight(16777164,1);I.position.set(180,0,180);I.target.position.set(0,0,0);I.castShadow=!0;I.shadow.camera.near=10;I.shadow.camera.far=100;I.shadow.camera.fov=30;I.shadowMapBias=.0139;I.shadowMapDarkness=.1;I.shadow.mapSize.width=1024;I.shadow.mapSize.height=1024;scene.add(I);scene.add(camera);renderer=
SHOW_3D_RENDER?new THREE.WebGLRenderer({clearColor:0,clearAlpha:.5,antialias:!1,alpha:!0}):new THREE.CanvasRenderer({clearColor:0,clearAlpha:.5,antialias:!1,alpha:!0});renderer.setSize(Z,S);renderer.domElement.style.position="relative";renderer.domElement.style.top="0px";renderer.domElement.style.opacity=.5;ma.appendChild(renderer.domElement);U=document.createElement("div");U.style.position="absolute";U.style.top="10px";U.style.width="100%";U.style.textAlign="center";U.innerHTML='<a href="http://github.com/schteppe/cannon.js">cannon.js</a> - javascript 3d physics';
ma.appendChild(U);document.addEventListener("mousemove",g);window.addEventListener("resize",k);renderer.setClearColor(scene.fog.color,1);renderer.autoClear=!1;K=document.createElement("canvas");K.width=Z;K.height=S;K.style.opacity=.5;K.style.position="absolute";K.style.top="0px";K.style.zIndex=90;ma.appendChild(K);N=new SmoothieChart({labelOffsetY:50,maxDataSetLength:100,millisPerPixel:2,grid:{strokeStyle:"none",fillStyle:"none",lineWidth:1,millisPerLine:250,verticalSections:6},labels:{fillStyle:"rgb(180, 180, 180)"}});
N.streamTo(K);var aa={},ca=[[255,0,0],[0,255,0],[0,0,255],[255,255,0],[255,0,255],[0,255,255]],da=0,ta;for(ta in z.profile){var va=ca[da%ca.length];aa[ta]=new TimeSeries({label:ta,fillStyle:"rgb("+va[0]+","+va[1]+","+va[2]+")",maxDataLength:500});da++}z.addEventListener("postStep",function(ua){for(var Ca in z.profile)aa[Ca].append(1E3*z.time,z.profile[Ca])});da=0;for(ta in z.profile)va=ca[da%ca.length],N.addTimeSeries(aa[ta],{strokeStyle:"rgb("+va[0]+","+va[1]+","+va[2]+")",lineWidth:2}),da++;z.doProfiling=
!1;N.stop();K.style.display="none";F=new Stats;F.domElement.style.position="absolute";F.domElement.style.top="0px";F.domElement.style.zIndex=100;ma.appendChild(F.domElement);void 0!=window.dat&&(G=new dat.GUI,G.domElement.parentNode.style.zIndex=120,ca=G.addFolder("Rendering"),ca.add(r,"rendermode",{Solid:"solid",Wireframe:"wireframe"}).onChange(function(ua){n(ua)}),ca.add(r,"contacts"),ca.add(r,"cm2contact"),ca.add(r,"normals"),ca.add(r,"constraints"),ca.add(r,"axes"),ca.add(r,"particleSize").min(0).max(1).onChange(function(ua){for(var Ca=
0;Ca<x.length;Ca++)v[Ca]instanceof CANNON.Particle&&x[Ca].scale.set(ua,ua,ua)}),ca.add(r,"shadows").onChange(function(ua){ua?renderer.shadowMapAutoUpdate=!0:(renderer.shadowMapAutoUpdate=!1,renderer.clearTarget(I.shadowMap))}),ca.add(r,"aabbs"),ca.add(r,"profiling").onChange(function(ua){ua?(z.doProfiling=!0,N.start(),K.style.display="block"):(z.doProfiling=!1,N.stop(),K.style.display="none")}),ca=G.addFolder("World"),ca.add(r,"paused").onChange(function(ua){}),ca.add(r,"stepFrequency",60,600).step(60),
ca.add(r,"gx",-100,100).onChange(function(ua){isNaN(ua)||z.gravity.set(ua,r.gy,r.gz)}),ca.add(r,"gy",-100,100).onChange(function(ua){isNaN(ua)||z.gravity.set(r.gx,ua,r.gz)}),ca.add(r,"gz",-100,100).onChange(function(ua){isNaN(ua)||z.gravity.set(r.gx,r.gy,ua)}),ca.add(r,"quatNormalizeSkip",0,50).step(1).onChange(function(ua){isNaN(ua)||(z.quatNormalizeSkip=ua)}),ca.add(r,"quatNormalizeFast").onChange(function(ua){z.quatNormalizeFast=!!ua}),ca=G.addFolder("Solver"),ca.add(r,"iterations",1,50).step(1).onChange(function(ua){z.solver.iterations=
ua}),ca.add(r,"k",10,1E7).onChange(function(ua){m.setGlobalSpookParams(r.k,r.d,1/r.stepFrequency)}),ca.add(r,"d",0,20).step(.1).onChange(function(ua){m.setGlobalSpookParams(r.k,r.d,1/r.stepFrequency)}),ca.add(r,"tolerance",0,10).step(.01).onChange(function(ua){z.solver.tolerance=ua}),l=G.addFolder("Scenes"),l.open());CAMERA_TEST&&(W=new THREE.TrackballControls(camera,renderer.domElement),W.rotateSpeed=1,W.zoomSpeed=1.2,W.panSpeed=.2,W.noZoom=!1,W.noPan=!1,W.staticMoving=!1,W.dynamicDampingFactor=
.3,W.minDistance=0,W.maxDistance=1E5,W.screen.width=Z,W.screen.height=S)})();a();var qa=0;document.addEventListener("keypress",function(aa){if(aa.keyCode)switch(aa.keyCode){case 32:q();break;case 104:"none"==F.domElement.style.display?(F.domElement.style.display="block",U.style.display="block"):(F.domElement.style.display="none",U.style.display="none");break;case 97:r.aabbs=!r.aabbs;e();break;case 99:r.constraints=!r.constraints;e();break;case 112:r.paused=!r.paused;e();break;case 115:z.step(1/r.stepFrequency);
c();break;case 109:aa=J.indexOf(r.rendermode);aa++;aa%=J.length;n(J[aa]);e();break;case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:w.length>aa.keyCode-49&&!document.activeElement.localName.match(/input/)&&d(aa.keyCode-49)}})};CANNON.Demo.prototype=new CANNON.EventTarget;CANNON.Demo.constructor=CANNON.Demo;
CANNON.Demo.prototype.setGlobalSpookParams=function(p,e,n){for(var q=this.world,b=0;b<q.constraints.length;b++)for(var c=q.constraints[b],a=0;a<c.equations.length;a++)c.equations[a].setSpookParams(p,e,n);for(b=0;b<q.contactmaterials.length;b++)n=q.contactmaterials[b],n.contactEquationStiffness=p,n.frictionEquationStiffness=p,n.contactEquationRelaxation=e,n.frictionEquationRelaxation=e;q.defaultContactMaterial.contactEquationStiffness=p;q.defaultContactMaterial.frictionEquationStiffness=p;q.defaultContactMaterial.contactEquationRelaxation=
e;q.defaultContactMaterial.frictionEquationRelaxation=e};CANNON.Demo.prototype.getWorld=function(){return this.world};CANNON.Demo.prototype.addVisual=function(p){var e;p instanceof CANNON.Body&&(e=this.shape2mesh(p));e&&(this.bodies.push(p),this.visuals.push(e),p.visualref=e,p.visualref.visualId=this.bodies.length-1,this.scene.add(e));return e};CANNON.Demo.prototype.addVisuals=function(p){for(var e=0;e<p.length;e++)this.addVisual(p[e])};
CANNON.Demo.prototype.removeVisual=function(p){if(p.visualref){for(var e=this.bodies,n=this.visuals,q=[],b=[],c=e.length,a=0;a<c;a++)q.unshift(e.pop()),b.unshift(n.pop());c=p.visualref.visualId;for(var g=0;g<q.length;g++)g!==c&&(a=g>c?g-1:g,e[a]=q[g],n[a]=b[g],e[a].visualref=q[g].visualref,e[a].visualref.visualId=a);p.visualref.visualId=null;this.scene.remove(p.visualref);p.visualref=null}};CANNON.Demo.prototype.removeAllVisuals=function(){for(;this.bodies.length;)this.removeVisual(this.bodies[0])};
CANNON.Demo.prototype.shape2mesh=function(p){for(var e=new THREE.Object3D,n=0;n<p.shapes.length;n++){var q=p.shapes[n];switch(q.type){case CANNON.Shape.types.SPHERE:var b=new THREE.SphereGeometry(q.radius,8,8);q=new THREE.Mesh(b,this.currentMaterial);break;case CANNON.Shape.types.PARTICLE:q=new THREE.Mesh(this.particleGeo,this.particleMaterial);b=this.settings;q.scale.set(b.particleSize,b.particleSize,b.particleSize);break;case CANNON.Shape.types.PLANE:var c=new THREE.PlaneGeometry(10,10,4,4);q=new THREE.Object3D;
b=new THREE.Object3D;c=new THREE.Mesh(c,this.currentMaterial);c.scale.set(100,100,100);b.add(c);c.castShadow=!0;c.receiveShadow=!0;q.add(b);break;case CANNON.Shape.types.BOX:b=new THREE.BoxGeometry(2*q.halfExtents.x,2*q.halfExtents.y,2*q.halfExtents.z);q=new THREE.Mesh(b,this.currentMaterial);break;case CANNON.Shape.types.CONVEXPOLYHEDRON:c=new THREE.Geometry;for(b=0;b<q.vertices.length;b++){var a=q.vertices[b];c.vertices.push(new THREE.Vector3(a.x,a.y,a.z))}for(b=0;b<q.faces.length;b++){var g=q.faces[b],
k=g[0];for(a=1;a<g.length-1;a++)c.faces.push(new THREE.Face3(k,g[a],g[a+1]))}c.computeBoundingSphere();c.computeFaceNormals();q=new THREE.Mesh(c,this.currentMaterial);break;case CANNON.Shape.types.HEIGHTFIELD:c=new THREE.Geometry;g=new CANNON.Vec3;k=new CANNON.Vec3;var d=new CANNON.Vec3;for(a=0;a<q.data.length-1;a++)for(var f=0;f<q.data[a].length-1;f++)for(var h=0;2>h;h++)q.getConvexTrianglePillar(a,f,0===h),g.copy(q.pillarConvex.vertices[0]),k.copy(q.pillarConvex.vertices[1]),d.copy(q.pillarConvex.vertices[2]),
g.vadd(q.pillarOffset,g),k.vadd(q.pillarOffset,k),d.vadd(q.pillarOffset,d),c.vertices.push(new THREE.Vector3(g.x,g.y,g.z),new THREE.Vector3(k.x,k.y,k.z),new THREE.Vector3(d.x,d.y,d.z)),b=c.vertices.length-3,c.faces.push(new THREE.Face3(b,b+1,b+2));c.computeBoundingSphere();c.computeFaceNormals();q=new THREE.Mesh(c,this.currentMaterial);break;case CANNON.Shape.types.TRIMESH:c=new THREE.Geometry;g=new CANNON.Vec3;k=new CANNON.Vec3;d=new CANNON.Vec3;for(b=0;b<q.indices.length/3;b++)q.getTriangleVertices(b,
g,k,d),c.vertices.push(new THREE.Vector3(g.x,g.y,g.z),new THREE.Vector3(k.x,k.y,k.z),new THREE.Vector3(d.x,d.y,d.z)),a=c.vertices.length-3,c.faces.push(new THREE.Face3(a,a+1,a+2));c.computeBoundingSphere();c.computeFaceNormals();q=new THREE.Mesh(c,this.currentMaterial);break;default:throw"Visual type not recognized: "+q.type;}q.receiveShadow=!0;q.castShadow=!0;if(q.children)for(b=0;b<q.children.length;b++)if(q.children[b].castShadow=!0,q.children[b].receiveShadow=!0,q.children[b])for(a=0;a<q.children[b].length;a++)q.children[b].children[a].castShadow=
!0,q.children[b].children[a].receiveShadow=!0;b=p.shapeOffsets[n];c=p.shapeOrientations[n];q.position.set(b.x,b.y,b.z);q.quaternion.set(c.x,c.y,c.z,c.w);e.add(q)}this.camera=function(){return camera};this.getScene=function(){return scene};return e};var NUM_ROWS_PAGE_LEVEL=2,NUM_COLS_PAGE_LEVEL=5;
function CLevelMenu(p){var e,n,q,b,c,a,g,k,d,f,h,m,l,r,u,v,x=null,w=null,G,N,K,T=null,L=null;this._init=function(){f=0;G=new createjs.Container;s_oStage.addChild(G);var C=createBitmap(s_oSpriteLibrary.getSprite("bg_game"));G.addChild(C);C=s_oSpriteLibrary.getSprite("goal");new CGoal(0,0,C,null,G);C=s_oSpriteLibrary.getSprite("msg_box");var D=createBitmap(C);D.x=CANVAS_WIDTH_HALF;D.y=CANVAS_HEIGHT_HALF;D.regX=.5*C.width;D.regY=.5*C.height;G.addChild(D);new CTLText(s_oStage,CANVAS_WIDTH/2-C.width/2+
20,CANVAS_HEIGHT_HALF-220,C.width-40,60,60,"center","#fff",FONT_GAME,1,0,0,TEXT_SELECT_A_LEVEL,!0,!0,!1,!1);C=s_oSpriteLibrary.getSprite("but_exit");k=CANVAS_WIDTH-C.height/2-10;d=C.height/2+10;u=new CGfxButton(k,d,C,s_oStage);u.addEventListener(ON_MOUSE_UP,this._onExit,this);h=C.height;if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)a=u.getX()-C.width-10,g=C.height/2+10,v=new CToggle(a,g,s_oSpriteLibrary.getSprite("audio_icon"),s_bAudioActive),v.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);
C=window.document;D=C.documentElement;T=D.requestFullscreen||D.mozRequestFullScreen||D.webkitRequestFullScreen||D.msRequestFullscreen;L=C.exitFullscreen||C.mozCancelFullScreen||C.webkitExitFullscreen||C.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(T=!1);T&&screenfull.isEnabled&&(C=s_oSpriteLibrary.getSprite("but_fullscreen"),e=C.width/4+10,n=d,K=new CToggle(e,n,C,s_bFullscreen,s_oStage),K.addEventListener(ON_MOUSE_UP,this._onFullscreenRelease,this));this._checkBoundLimits();l=[];C=Math.floor((CANVAS_WIDTH+
EDGEBOARD_X)/NUM_COLS_PAGE_LEVEL)/2;D=.7*-EDGEBOARD_X;for(var H=0;H<NUM_COLS_PAGE_LEVEL;H++)l.push(D),D+=C;r=[];this._createNewLevelPage(0,p);if(1<r.length){for(C=1;C<r.length;C++)r[C].visible=!1;b=CANVAS_WIDTH-180;c=CANVAS_HEIGHT_HALF;x=new CGfxButton(b,c,s_oSpriteLibrary.getSprite("arrow_right"),s_oStage);x.addEventListener(ON_MOUSE_UP,this._onRight,this);q=CANVAS_HEIGHT_HALF;w=new CGfxButton(180,q,s_oSpriteLibrary.getSprite("arrow_left"),s_oStage);w.addEventListener(ON_MOUSE_UP,this._onLeft,this)}N=
new createjs.Shape;N.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);s_oStage.addChild(N);createjs.Tween.get(N).to({alpha:0},1E3).call(function(){s_oStage.removeChild(N);N=null});this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.unload=function(){for(var C=0;C<m.length;C++)m[C].unload();if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)v.unload(),v=null;T&&screenfull.isEnabled&&K.unload();u.unload();u=null;null!==w&&(w.unload(),x.unload());s_oLevelMenu=null;s_oStage.removeAllChildren()};
this.refreshButtonPos=function(C,D){u.setPosition(k-C,d+D);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||v.setPosition(a-C,D+g);T&&screenfull.isEnabled&&K.setPosition(e+s_iOffsetX,n+s_iOffsetY)};this._checkBoundLimits=function(){for(var C=s_oSpriteLibrary.getSprite("but_level"),D=0,H=CANVAS_HEIGHT-2*EDGEBOARD_Y-2*h,P=0;D<H;)D+=C.height+20,P++;NUM_ROWS_PAGE_LEVEL>P&&(NUM_ROWS_PAGE_LEVEL=P);H=D=0;P=CANVAS_WIDTH-2*EDGEBOARD_X;for(C=s_oSpriteLibrary.getSprite("but_level");H<P;)H+=C.width/2+5,D++;NUM_COLS_PAGE_LEVEL>
D&&(NUM_COLS_PAGE_LEVEL=D)};this._createNewLevelPage=function(C,D){var H=new createjs.Container;G.addChild(H);r.push(H);m=[];for(var P=0,y=-230,V=1,E=!1,R=s_oSpriteLibrary.getSprite("but_level"),M=C;M<D;M++){var A=new CLevelBut(l[P]+R.width/2,y+R.height/2,M+1,R,M+1>s_iLastLevel?!1:!0,H);A.addEventListenerWithParams(ON_MOUSE_UP,this._onButLevelRelease,this,M);m.push(A);P++;if(P===l.length&&(P=0,y+=R.height+20,V++,V>NUM_ROWS_PAGE_LEVEL&&M<D-1)){E=!0;break}}H.x=CANVAS_WIDTH/2;H.y=520;H.regX=H.getBounds().width/
2;E&&this._createNewLevelPage(M+1,D)};this._onRight=function(){r[f].visible=!1;f++;f>=r.length&&(f=0);r[f].visible=!0};this._onLeft=function(){r[f].visible=!1;f--;0>f&&(f=r.length-1);r[f].visible=!0};this._onButLevelRelease=function(C){this.unload();s_oMain.gotoGame(C)};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._onExit=function(){this.unload();s_oMain.gotoMenu()};this.resetFullscreenBut=function(){T&&screenfull.isEnabled&&K.setActive(s_bFullscreen)};
this._onFullscreenRelease=function(){s_bFullscreen?L.call(window.document):T.call(window.document.documentElement);sizeHandler()};s_oLevelMenu=this;this._init()}var s_oLevelMenu=null;
function CLevelBut(p,e,n,q,b,c){var a,g,k,d=[],f=[],h,m,l,r,u;this._init=function(x,w,G,N,K){g=[];k=[];l=new createjs.Container;v.addChild(l);var T=new createjs.SpriteSheet({images:[N],frames:{width:N.width/2,height:N.height,regX:N.width/2/2,regY:N.height/2},animations:{state_true:[0],state_false:[1]}});a=K;m=createSprite(T,"state_"+a,N.width/2/2,N.height/2,N.width/2,N.height);m.mouseEnabled=K;m.x=x;m.y=w;m.stop();s_bMobile||(l.cursor="pointer");l.addChild(m);d.push(m);h=new createjs.Text(G,"60px "+
FONT_GAME,TEXT_COLOR);h.x=x;h.y=w+20;h.textAlign="center";h.textBaseline="alphabetic";h.lineWidth=200;l.addChild(h);K||(h.color="#b4b4b4");this._initListener()};this.unload=function(){l.off("mousedown",r);l.off("pressup",u);l.removeChild(m)};this._initListener=function(){r=l.on("mousedown",this.buttonDown);u=l.on("pressup",this.buttonRelease)};this.viewBut=function(x){l.addChild(x)};this.addEventListener=function(x,w,G){g[x]=w;k[x]=G};this.addEventListenerWithParams=function(x,w,G,N){g[x]=w;k[x]=
G;f=N};this.ifClickable=function(){return!0===l.mouseEnabled?1:0};this.setActive=function(x,w){a=w;d[x].gotoAndStop("state_"+a);d[x].mouseEnabled=!0;h.color=a?"#69b8d5":"#b4b4b4"};this.buttonRelease=function(){a&&g[ON_MOUSE_UP]&&g[ON_MOUSE_UP].call(k[ON_MOUSE_UP],f)};this.buttonDown=function(){g[ON_MOUSE_DOWN]&&g[ON_MOUSE_DOWN].call(k[ON_MOUSE_DOWN],f)};this.setPosition=function(x,w){l.x=x;l.y=w};this.setVisible=function(x){l.visible=x};var v=c;this._init(p,e,n,q,b,c)}
function CBall(p,e,n,q,b){var c,a,g,k=null,d=0,f=0,h=null,m;this._init=function(u,v,x){g=new createjs.Container;r.addChild(g);var w=new createjs.SpriteSheet({images:[x],frames:{width:x.width/7,height:x.height,regX:x.width/2/7,regY:x.height/2}});c=createSprite(w,0,x.width/2/7,x.height/2,x.width/7,x.height/2);c.stop();this.scale(.93);x=s_oSpriteLibrary.getSprite("ball_shadow");a=createBitmap(x);a.x=u;a.y=v;a.regX=.5*x.width;a.regY=.5*x.height;this.scaleShadow(.93);g.addChild(a,c)};this.rolls=function(){c.rotation=
Math.degrees(Math.sin(.15*l.velocity.x));var u=Math.abs(l.angularVelocity.x),v=this._goToPrevFrame;0>l.angularVelocity.x&&(v=this._goToNextFrame);7<u?v():3<u?(d++,d>2/ROLL_BALL_RATE&&(v(),d=0)):1<u?(d++,d>3/ROLL_BALL_RATE&&(v(),d=0)):u>MIN_BALL_VEL_ROTATION&&(d++,d>4/ROLL_BALL_RATE&&(v(),d=0))};this._goToPrevFrame=function(){0===f?f=6:f--;c.gotoAndStop(f)};this._goToNextFrame=function(){7===f?f=1:f++;c.gotoAndStop(f)};this.unload=function(){c.removeAllEventListeners();r.removeChild(c)};this.setVisible=
function(u){c.visible=u};this.getStartScale=function(){return.93};this.startPosShadowY=function(u){k=u};this.getStartShadowYPos=function(){return k};this.fadeAnimation=function(u,v,x){u!==m&&(null!==h&&createjs.Tween.removeTweens(g),this.tweenFade(u,v,x),m=u)};this.tweenFade=function(u,v,x){h=createjs.Tween.get(g).wait(x).to({alpha:u},v).call(function(){h=null})};this.setPositionShadow=function(u,v){a.x=u;a.y=v};this.setPosition=function(u,v){c.x=u;c.y=v};this.getPhysics=function(){return l};this.setAngle=
function(u){c.rotation=u};this.getX=function(){return c.x};this.getY=function(){return c.y};this.getStartScale=function(){return.93};this.scale=function(u){c.scaleX=u;c.scaleY=u};this.scaleShadow=function(u){.08<u?(a.scaleX=u,a.scaleY=u):(a.scaleX=.08,a.scaleY=.08)};this.setAlphaByHeight=function(u){a.alpha=u};this.getScale=function(){return c.scaleX};this.getObject=function(){return c};this.getDepthPos=function(){return l.position.y};var l=q;var r=b;this._init(p,e,n);return this}
function CScenario(){var p,e,n,q,b,c,a,g,k,d,f,h,m,l,r,u,v,x,w,G,N,K;if(SHOW_3D_RENDER)var T=new CANNON.Demo;this.getDemo=function(){return T};this._init=function(){p=SHOW_3D_RENDER?T.getWorld():new CANNON.World;p.gravity.set(0,0,-9.81);p.broadphase=new CANNON.NaiveBroadphase;p.solver.iterations=50;p.solver.tolerance=1E-5;e=new CANNON.Material;n=new CANNON.Material;q=new CANNON.Material;b=new CANNON.Material;var L=new CANNON.ContactMaterial(n,q,{friction:.1,restitution:.5}),C=new CANNON.ContactMaterial(n,
e,{friction:.2,restitution:.3}),D=new CANNON.ContactMaterial(n,b,{friction:.5,restitution:.1});p.addContactMaterial(L);p.addContactMaterial(C);p.addContactMaterial(D);s_oScenario._createBallBody();s_oScenario._createFieldBody();s_oScenario._createGoal();s_oScenario.createBackGoalWall();s_oScenario.createLineOfGoal();s_oScenario.createHandGoalKeeper()};this._createFieldBody=function(){k=new CANNON.Plane;d=new CANNON.Body({mass:0,material:e});d.addShape(k);d.position.z=-10;d.addEventListener("collide",
function(L){s_oScenario.fieldCollision()});p.addBody(d);SHOW_3D_RENDER&&T.addVisual(d)};this._createGoal=function(){f=new CANNON.Cylinder(POLE_RIGHT_LEFT_SIZE.radius_top,POLE_RIGHT_LEFT_SIZE.radius_bottom,POLE_RIGHT_LEFT_SIZE.height,POLE_RIGHT_LEFT_SIZE.segments);m=new CANNON.Body({mass:0});h=new CANNON.Cylinder(POLE_UP_SIZE.radius_top,POLE_UP_SIZE.radius_bottom,POLE_UP_SIZE.height,POLE_UP_SIZE.segments);var L=new CANNON.Quaternion;L.setFromAxisAngle(new CANNON.Vec3(0,1,0),Math.PI/2);h.transformAllPoints(new CANNON.Vec3,
L);m.addShape(f,new CANNON.Vec3(.5*POLE_UP_SIZE.height,0,0));m.addShape(f,new CANNON.Vec3(.5*-POLE_UP_SIZE.height,0,0));m.addShape(h,new CANNON.Vec3(0,0,.5*POLE_RIGHT_LEFT_SIZE.height));m.position.set(GOAL_POSITION.x,GOAL_POSITION.y,GOAL_POSITION.z);m.addEventListener("collide",function(C){s_oScenario.poleCollision()});p.addBody(m);SHOW_3D_RENDER&&T.addVisual(m)};this.createBackGoalWall=function(){l=new CANNON.Box(new CANNON.Vec3(BACK_WALL_GOAL_SIZE.width,BACK_WALL_GOAL_SIZE.depth,BACK_WALL_GOAL_SIZE.height));
r=new CANNON.Box(new CANNON.Vec3(LEFT_RIGHT_WALL_GOAL_SIZE.width,LEFT_RIGHT_WALL_GOAL_SIZE.depth,LEFT_RIGHT_WALL_GOAL_SIZE.height));u=new CANNON.Box(new CANNON.Vec3(UP_WALL_GOAL_SIZE.width,UP_WALL_GOAL_SIZE.depth,UP_WALL_GOAL_SIZE.height));v=new CANNON.Body({mass:0,material:q});v.addShape(l);v.addShape(r,new CANNON.Vec3(BACK_WALL_GOAL_SIZE.width,0,0));v.addShape(r,new CANNON.Vec3(-BACK_WALL_GOAL_SIZE.width,0,0));v.addShape(u,new CANNON.Vec3(0,0,BACK_WALL_GOAL_SIZE.height));v.addEventListener("collide",
function(L){s_oScenario.goalCollision(L)});v.position.set(BACK_WALL_GOAL_POSITION.x,BACK_WALL_GOAL_POSITION.y,BACK_WALL_GOAL_POSITION.z);p.addBody(v);SHOW_3D_RENDER&&T.addVisual(v)};this.createLineOfGoal=function(){x=new CANNON.Box(new CANNON.Vec3(BACK_WALL_GOAL_SIZE.width,BACK_WALL_GOAL_SIZE.depth,BACK_WALL_GOAL_SIZE.height));w=new CANNON.Body({mass:0});w.addShape(x);w.position.set(GOAL_LINE_POS.x,GOAL_LINE_POS.y,GOAL_LINE_POS.z);w.collisionResponse=0;w.addEventListener("collide",function(L){s_oScenario.lineGoalCollision()});
p.addBody(w)};this.createHandGoalKeeper=function(){G=new CANNON.Box(new CANNON.Vec3(HAND_KEEPER_SIZE.width,HAND_KEEPER_SIZE.depth,HAND_KEEPER_SIZE.height));N=new CANNON.Body({mass:0,material:b});N.addShape(G);N.position.set(HAND_KEEPER_POSITION.x,HAND_KEEPER_POSITION.y,HAND_KEEPER_POSITION.z);N.addEventListener("collide",function(L){s_oScenario.handCollision(L)});p.addBody(N);SHOW_3D_RENDER&&(K=T.addVisual(N))};this._createBallBody=function(){c=new CANNON.Sphere(BALL_RADIUS);a=new CANNON.Body({mass:BALL_MASS,
material:n,linearDamping:BALL_LINEAR_DAMPING,angularDamping:2*BALL_LINEAR_DAMPING});var L=new CANNON.Vec3(POSITION_BALL.x,POSITION_BALL.y,POSITION_BALL.z);a.position.copy(L);a.addShape(c);p.add(a);SHOW_3D_RENDER&&(g=T.addVisual(a))};this.addImpulse=function(L,C){var D=new CANNON.Vec3(0,0,BALL_RADIUS),H=new CANNON.Vec3(C.x,C.y,C.z);L.applyImpulse(H,D)};this.addForce=function(L,C){var D=new CANNON.Vec3(0,0,0),H=new CANNON.Vec3(C.x,C.y,C.z);L.applyForce(H,D)};this.getBodyVelocity=function(L){return L.velocity};
this.ballBody=function(){return a};this.ballMesh=function(){return g};this.getCamera=function(){return T.camera()};this.fieldCollision=function(){s_oGame.ballFadeForReset();playSound("drop_bounce_grass",1,!1)};this.collisionWithBall=function(){s_oGame.lineGoalCollision()};this.setElementAngularVelocity=function(L,C){L.angularVelocity.set(C.x,C.y,C.z)};this.setElementVelocity=function(L,C){var D=new CANNON.Vec3(C.x,C.y,C.z);L.velocity=D};this.setElementLinearDamping=function(L,C){L.linearDamping=C};
this.getFieldBody=function(){return d};this.lineGoalCollision=function(){s_oGame.goal()};this.handCollision=function(L){s_oGame.keeperSave(L.contact.rj)};this.update=function(){p.step(PHYSICS_STEP)};this.getHandKeeperBody=function(){return N};this.getHandKeeperMesh=function(){return K};this.getGoalBody=function(){return m};this.goalCollision=function(L){s_oGame.goalAnimation(L.body.velocity.x*L.body.velocity.x+L.body.velocity.y*L.body.velocity.y)};this.poleCollision=function(){playSound("kick",1,
!1)};this.destroyWorld=function(){for(var L=p.bodies,C=0;C<L.length;C++)p.remove(L[C]);p=null};s_oScenario=this;SHOW_3D_RENDER?(T.addScene("Test",this._init),T.start()):this._init()}var s_oScenario;
Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(p){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var p=document.createElement("div");p.id="webgl-error-message";p.style.fontFamily="monospace";p.style.fontSize="13px";p.style.fontWeight="normal";p.style.textAlign="center";p.style.background=
"#fff";p.style.color="#000";p.style.padding="1.5em";p.style.width="400px";p.style.margin="5em auto 0";this.webgl||(p.innerHTML=window.WebGLRenderingContext?'Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.':'Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.');
return p},addGetWebGLMessage:function(p){p=p||{};var e=void 0!==p.parent?p.parent:document.body;p=void 0!==p.id?p.id:"oldie";var n=Detector.getWebGLErrorMessage();n.id=p;e.appendChild(n)}};
function TimeSeries(p){p=p||{};p.resetBoundsInterval=p.resetBoundsInterval||3E3;p.resetBounds=void 0===p.resetBounds?!0:p.resetBounds;this.options=p;this.data=[];this.label=p.label||"";this.maxDataLength=p.maxDataLength||1E3;this.dataPool=[];this.minValue=this.maxValue=Number.NaN;p.resetBounds&&(this.boundsTimer=setInterval(function(e){return function(){e.resetBounds()}}(this),p.resetBoundsInterval))}
TimeSeries.prototype.resetBounds=function(){this.minValue=this.maxValue=Number.NaN;for(var p=0;p<this.data.length;p++)this.maxValue=isNaN(this.maxValue)?this.data[p][1]:Math.max(this.maxValue,this.data[p][1]),this.minValue=isNaN(this.minValue)?this.data[p][1]:Math.min(this.minValue,this.data[p][1])};
TimeSeries.prototype.append=function(p,e){this.lastTimeStamp=p;var n=this.dataPool.length?this.dataPool.pop():[p,e];n[0]=p;n[1]=e;this.data.push(n);this.maxValue=isNaN(this.maxValue)?e:Math.max(this.maxValue,e);for(this.minValue=isNaN(this.minValue)?e:Math.min(this.minValue,e);this.data.length>this.maxDataLength;)this.dataPool.push(this.data.shift())};
function SmoothieChart(p){p=p||{};p.grid=p.grid||{fillStyle:"#000000",strokeStyle:"#777777",lineWidth:1,millisPerLine:1E3,verticalSections:2};p.millisPerPixel=p.millisPerPixel||20;p.fps=p.fps||50;p.maxValueScale=p.maxValueScale||1;p.minValue=p.minValue;p.maxValue=p.maxValue;p.labels=p.labels||{fillStyle:"#ffffff"};p.interpolation=p.interpolation||"bezier";p.scaleSmoothing=p.scaleSmoothing||.125;p.maxDataSetLength=p.maxDataSetLength||2;p.timestampFormatter=p.timestampFormatter||null;this.options=p;
this.seriesSet=[];this.currentValueRange=1;this.currentVisMinValue=0}SmoothieChart.prototype.addTimeSeries=function(p,e){this.seriesSet.push({timeSeries:p,options:e||{}})};SmoothieChart.prototype.removeTimeSeries=function(p){this.seriesSet.splice(this.seriesSet.indexOf(p),1)};SmoothieChart.prototype.streamTo=function(p,e){var n=this;this.render_on_tick=function(){n.render(p,n.seriesSet[0].timeSeries.lastTimeStamp)};this.start()};
SmoothieChart.prototype.start=function(){this.timer||(this.timer=setInterval(this.render_on_tick,1E3/this.options.fps))};SmoothieChart.prototype.stop=function(){this.timer&&(clearInterval(this.timer),this.timer=void 0)};SmoothieChart.timeFormatter=function(p){function e(n){return(10>n?"0":"")+n}return e(p.getHours())+":"+e(p.getMinutes())+":"+e(p.getSeconds())};
SmoothieChart.prototype.render=function(p,e){var n=p.getContext("2d"),q=this.options,b=p.clientWidth,c=p.clientHeight;n.save();e-=e%q.millisPerPixel;n.translate(0,0);n.beginPath();n.rect(0,0,b,c);n.clip();n.save();n.fillStyle=q.grid.fillStyle;n.clearRect(0,0,b,c);n.fillRect(0,0,b,c);n.restore();n.save();n.lineWidth=q.grid.lineWidth||1;n.strokeStyle=q.grid.strokeStyle||"#ffffff";if(0<q.grid.millisPerLine)for(var a=e-e%q.grid.millisPerLine;a>=e-b*q.millisPerPixel;a-=q.grid.millisPerLine){n.beginPath();
var g=Math.round(b-(e-a)/q.millisPerPixel);n.moveTo(g,0);n.lineTo(g,c);n.stroke();if(q.timestampFormatter){var k=q.timestampFormatter(new Date(a)),d=n.measureText(k).width/2+n.measureText(w).width+4;g<b-d&&(n.fillStyle=q.labels.fillStyle,n.fillText(k,g-n.measureText(k).width/2,c-2))}n.closePath()}for(w=1;w<q.grid.verticalSections;w++)a=Math.round(w*c/q.grid.verticalSections),n.beginPath(),n.moveTo(0,a),n.lineTo(b,a),n.stroke(),n.closePath();n.beginPath();n.strokeRect(0,0,b,c);n.closePath();n.restore();
w=g=Number.NaN;for(k=0;k<this.seriesSet.length;k++){var f=this.seriesSet[k].timeSeries;isNaN(f.maxValue)||(g=isNaN(g)?f.maxValue:Math.max(g,f.maxValue));isNaN(f.minValue)||(w=isNaN(w)?f.minValue:Math.min(w,f.minValue))}if(!isNaN(g)||!isNaN(w)){g=null!=q.maxValue?q.maxValue:g*q.maxValueScale;null!=q.minValue&&(w=q.minValue);this.currentValueRange+=q.scaleSmoothing*(g-w-this.currentValueRange);this.currentVisMinValue+=q.scaleSmoothing*(w-this.currentVisMinValue);d=this.currentValueRange;var h=this.currentVisMinValue;
for(k=0;k<this.seriesSet.length;k++){n.save();f=this.seriesSet[k].timeSeries;f=f.data;for(var m=this.seriesSet[k].options;f.length>=q.maxDataSetLength&&f[1][0]<e-b*q.millisPerPixel;)f.splice(0,1);n.lineWidth=m.lineWidth||1;n.fillStyle=m.fillStyle;n.strokeStyle=m.strokeStyle||"#ffffff";n.beginPath();var l=0,r=0,u=0;for(a=0;a<f.length;a++){var v=Math.round(b-(e-f[a][0])/q.millisPerPixel),x=f[a][1]-h;x=Math.max(Math.min(c-(d?Math.round(x/d*c):0),c-1),1);if(0==a)l=v,n.moveTo(v,x);else switch(q.interpolation){case "line":n.lineTo(v,
x);break;default:n.bezierCurveTo(Math.round((r+v)/2),u,Math.round(r+v)/2,x,v,x)}r=v;u=x}0<f.length&&m.fillStyle&&(n.lineTo(b+m.lineWidth+1,u),n.lineTo(b+m.lineWidth+1,c+m.lineWidth+1),n.lineTo(l,c+m.lineWidth),n.fill());n.stroke();n.closePath();n.restore()}if(!q.labels.disabled){q.labelOffsetY||(q.labelOffsetY=0);n.fillStyle=q.labels.fillStyle;a=parseFloat(g).toFixed(2);var w=parseFloat(w).toFixed(2);n.fillText(a,b-n.measureText(a).width-2,10);n.fillText(w,b-n.measureText(w).width-2,c-2);for(a=0;a<
this.seriesSet.length;a++)f=this.seriesSet[a].timeSeries,b=f.label,n.fillStyle=f.options.fillStyle||"rgb(255,255,255)",b&&n.fillText(b,2,10*(a+1)+q.labelOffsetY)}}n.restore()};
var Stats=function(){var p=0,e=0,n=Date.now(),q=n,b=n,c=0,a=1E3,g=0,k=[[16,16,48],[0,255,255]],d=0,f=1E3,h=0,m=[[16,48,16],[0,255,0]];var l=document.createElement("div");l.style.cursor="pointer";l.style.width="80px";l.style.opacity="0.9";l.style.zIndex="10001";l.addEventListener("mousedown",function(K){K.preventDefault();p=(p+1)%2;0==p?(r.style.display="block",w.style.display="none"):(r.style.display="none",w.style.display="block")},!1);var r=document.createElement("div");r.style.textAlign="left";
r.style.lineHeight="1.2em";r.style.backgroundColor="rgb("+Math.floor(k[0][0]/2)+","+Math.floor(k[0][1]/2)+","+Math.floor(k[0][2]/2)+")";r.style.padding="0 0 3px 3px";l.appendChild(r);var u=document.createElement("div");u.style.fontFamily="Helvetica, Arial, sans-serif";u.style.fontSize="9px";u.style.color="rgb("+k[1][0]+","+k[1][1]+","+k[1][2]+")";u.style.fontWeight="bold";u.innerHTML="FPS";r.appendChild(u);var v=document.createElement("div");v.style.position="relative";v.style.width="74px";v.style.height=
"30px";v.style.backgroundColor="rgb("+k[1][0]+","+k[1][1]+","+k[1][2]+")";for(r.appendChild(v);74>v.children.length;){var x=document.createElement("span");x.style.width="1px";x.style.height="30px";x.style.cssFloat="left";x.style.backgroundColor="rgb("+k[0][0]+","+k[0][1]+","+k[0][2]+")";v.appendChild(x)}var w=document.createElement("div");w.style.textAlign="left";w.style.lineHeight="1.2em";w.style.backgroundColor="rgb("+Math.floor(m[0][0]/2)+","+Math.floor(m[0][1]/2)+","+Math.floor(m[0][2]/2)+")";
w.style.padding="0 0 3px 3px";w.style.display="none";l.appendChild(w);var G=document.createElement("div");G.style.fontFamily="Helvetica, Arial, sans-serif";G.style.fontSize="9px";G.style.color="rgb("+m[1][0]+","+m[1][1]+","+m[1][2]+")";G.style.fontWeight="bold";G.innerHTML="MS";w.appendChild(G);var N=document.createElement("div");N.style.position="relative";N.style.width="74px";N.style.height="30px";N.style.backgroundColor="rgb("+m[1][0]+","+m[1][1]+","+m[1][2]+")";for(w.appendChild(N);74>N.children.length;)x=
document.createElement("span"),x.style.width="1px",x.style.height=30*Math.random()+"px",x.style.cssFloat="left",x.style.backgroundColor="rgb("+m[0][0]+","+m[0][1]+","+m[0][2]+")",N.appendChild(x);return{domElement:l,update:function(){n=Date.now();d=n-q;f=Math.min(f,d);h=Math.max(h,d);G.textContent=d+" MS ("+f+"-"+h+")";var K=Math.min(30,30-d/200*30);N.appendChild(N.firstChild).style.height=K+"px";q=n;e++;n>b+1E3&&(c=Math.round(1E3*e/(n-b)),a=Math.min(a,c),g=Math.max(g,c),u.textContent=c+" FPS ("+
a+"-"+g+")",K=Math.min(30,30-c/100*30),v.appendChild(v.firstChild).style.height=K+"px",b=n,e=0)}}};
THREE.TrackballControls=function(p,e){function n(D){!1!==a.enabled&&(window.removeEventListener("keydown",n),f=d,d===g.NONE)&&(D.keyCode!==a.keys[g.ROTATE]||a.noRotate?D.keyCode!==a.keys[g.ZOOM]||a.noZoom?D.keyCode!==a.keys[g.PAN]||a.noPan||(d=g.PAN):d=g.ZOOM:d=g.ROTATE)}function q(D){!1!==a.enabled&&(D.preventDefault(),D.stopPropagation(),d!==g.ROTATE||a.noRotate?d!==g.ZOOM||a.noZoom?d!==g.PAN||a.noPan||G.copy(L(D.pageX,D.pageY)):u.copy(L(D.pageX,D.pageY)):l.copy(C(D.pageX,D.pageY)))}function b(D){!1!==
a.enabled&&(D.preventDefault(),D.stopPropagation(),d=g.NONE,document.removeEventListener("mousemove",q),document.removeEventListener("mouseup",b),a.dispatchEvent(T))}function c(D){if(!1!==a.enabled){D.preventDefault();D.stopPropagation();var H=0;D.wheelDelta?H=D.wheelDelta/40:D.detail&&(H=-D.detail/3);r.y+=.01*H;a.dispatchEvent(K);a.dispatchEvent(T)}}var a=this,g={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=p;this.domElement=void 0!==e?e:document;this.enabled=!0;this.screen=
{left:0,top:0,width:0,height:0};this.rotateSpeed=1;this.zoomSpeed=1.2;this.panSpeed=.3;this.staticMoving=this.noRoll=this.noPan=this.noZoom=this.noRotate=!1;this.dynamicDampingFactor=.2;this.minDistance=0;this.maxDistance=Infinity;this.keys=[65,83,68];this.target=new THREE.Vector3;var k=new THREE.Vector3,d=g.NONE,f=g.NONE,h=new THREE.Vector3,m=new THREE.Vector3,l=new THREE.Vector3,r=new THREE.Vector2,u=new THREE.Vector2,v=0,x=0,w=new THREE.Vector2,G=new THREE.Vector2;this.target0=this.target.clone();
this.position0=this.object.position.clone();this.up0=this.object.up.clone();var N={type:"change"},K={type:"start"},T={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var D=this.domElement.getBoundingClientRect(),H=this.domElement.ownerDocument.documentElement;this.screen.left=D.left+window.pageXOffset-H.clientLeft;this.screen.top=D.top+window.pageYOffset-H.clientTop;
this.screen.width=D.width;this.screen.height=D.height}};this.handleEvent=function(D){if("function"==typeof this[D.type])this[D.type](D)};var L=function(){var D=new THREE.Vector2;return function(H,P){D.set((H-a.screen.left)/a.screen.width,(P-a.screen.top)/a.screen.height);return D}}(),C=function(){var D=new THREE.Vector3,H=new THREE.Vector3,P=new THREE.Vector3;return function(y,V){P.set((y-.5*a.screen.width-a.screen.left)/(.5*a.screen.width),(.5*a.screen.height+a.screen.top-V)/(.5*a.screen.height),
0);var E=P.length();a.noRoll?P.z=E<Math.SQRT1_2?Math.sqrt(1-E*E):.5/E:1<E?P.normalize():P.z=Math.sqrt(1-E*E);h.copy(a.object.position).sub(a.target);D.copy(a.object.up).setLength(P.y);D.add(H.copy(a.object.up).cross(h).setLength(P.x));D.add(h.setLength(P.z));return D}}();this.rotateCamera=function(){var D=new THREE.Vector3,H=new THREE.Quaternion;return function(){var P=Math.acos(m.dot(l)/m.length()/l.length());P&&(D.crossVectors(m,l).normalize(),P*=a.rotateSpeed,H.setFromAxisAngle(D,-P),h.applyQuaternion(H),
a.object.up.applyQuaternion(H),l.applyQuaternion(H),a.staticMoving?m.copy(l):(H.setFromAxisAngle(D,P*(a.dynamicDampingFactor-1)),m.applyQuaternion(H)))}}();this.zoomCamera=function(){if(d===g.TOUCH_ZOOM_PAN){var D=v/x;v=x;h.multiplyScalar(D)}else D=1+(u.y-r.y)*a.zoomSpeed,1!==D&&0<D&&(h.multiplyScalar(D),a.staticMoving?r.copy(u):r.y+=(u.y-r.y)*this.dynamicDampingFactor)};this.panCamera=function(){var D=new THREE.Vector2,H=new THREE.Vector3,P=new THREE.Vector3;return function(){D.copy(G).sub(w);D.lengthSq()&&
(D.multiplyScalar(h.length()*a.panSpeed),P.copy(h).cross(a.object.up).setLength(D.x),P.add(H.copy(a.object.up).setLength(D.y)),a.object.position.add(P),a.target.add(P),a.staticMoving?w.copy(G):w.add(D.subVectors(G,w).multiplyScalar(a.dynamicDampingFactor)))}}();this.checkDistances=function(){a.noZoom&&a.noPan||(h.lengthSq()>a.maxDistance*a.maxDistance&&a.object.position.addVectors(a.target,h.setLength(a.maxDistance)),h.lengthSq()<a.minDistance*a.minDistance&&a.object.position.addVectors(a.target,
h.setLength(a.minDistance)))};this.update=function(){h.subVectors(a.object.position,a.target);a.noRotate||a.rotateCamera();a.noZoom||a.zoomCamera();a.noPan||a.panCamera();a.object.position.addVectors(a.target,h);a.checkDistances();a.object.lookAt(a.target);1E-6<k.distanceToSquared(a.object.position)&&(a.dispatchEvent(N),k.copy(a.object.position))};this.reset=function(){f=d=g.NONE;a.target.copy(a.target0);a.object.position.copy(a.position0);a.object.up.copy(a.up0);h.subVectors(a.object.position,a.target);
a.object.lookAt(a.target);a.dispatchEvent(N);k.copy(a.object.position)};this.domElement.addEventListener("contextmenu",function(D){D.preventDefault()},!1);this.domElement.addEventListener("mousedown",function(D){!1!==a.enabled&&(D.preventDefault(),D.stopPropagation(),d===g.NONE&&(d=D.button),d!==g.ROTATE||a.noRotate?d!==g.ZOOM||a.noZoom?d!==g.PAN||a.noPan||(w.copy(L(D.pageX,D.pageY)),G.copy(w)):(r.copy(L(D.pageX,D.pageY)),u.copy(r)):(m.copy(C(D.pageX,D.pageY)),l.copy(m)),document.addEventListener("mousemove",
q,!1),document.addEventListener("mouseup",b,!1),a.dispatchEvent(K))},!1);this.domElement.addEventListener("mousewheel",c,!1);this.domElement.addEventListener("DOMMouseScroll",c,!1);this.domElement.addEventListener("touchstart",function(D){if(!1!==a.enabled){switch(D.touches.length){case 1:d=g.TOUCH_ROTATE;m.copy(C(D.touches[0].pageX,D.touches[0].pageY));l.copy(m);break;case 2:d=g.TOUCH_ZOOM_PAN;var H=D.touches[0].pageX-D.touches[1].pageX,P=D.touches[0].pageY-D.touches[1].pageY;x=v=Math.sqrt(H*H+P*
P);w.copy(L((D.touches[0].pageX+D.touches[1].pageX)/2,(D.touches[0].pageY+D.touches[1].pageY)/2));G.copy(w);break;default:d=g.NONE}a.dispatchEvent(K)}},!1);this.domElement.addEventListener("touchend",function(D){if(!1!==a.enabled){switch(D.touches.length){case 1:l.copy(C(D.touches[0].pageX,D.touches[0].pageY));m.copy(l);break;case 2:v=x=0,G.copy(L((D.touches[0].pageX+D.touches[1].pageX)/2,(D.touches[0].pageY+D.touches[1].pageY)/2)),w.copy(G)}d=g.NONE;a.dispatchEvent(T)}},!1);this.domElement.addEventListener("touchmove",
function(D){if(!1!==a.enabled)switch(D.preventDefault(),D.stopPropagation(),D.touches.length){case 1:l.copy(C(D.touches[0].pageX,D.touches[0].pageY));break;case 2:var H=D.touches[0].pageX-D.touches[1].pageX,P=D.touches[0].pageY-D.touches[1].pageY;x=Math.sqrt(H*H+P*P);G.copy(L((D.touches[0].pageX+D.touches[1].pageX)/2,(D.touches[0].pageY+D.touches[1].pageY)/2));break;default:d=g.NONE}},!1);window.addEventListener("keydown",n,!1);window.addEventListener("keyup",function(D){!1!==a.enabled&&(d=f,window.addEventListener("keydown",
n,!1))},!1);this.handleResize();this.update()};THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype);var dat=dat||{};dat.gui=dat.gui||{};dat.utils=dat.utils||{};dat.controllers=dat.controllers||{};dat.dom=dat.dom||{};dat.color=dat.color||{};
dat.utils.css=function(){return{load:function(p,e){e=e||document;var n=e.createElement("link");n.type="text/css";n.rel="stylesheet";n.href=p;e.getElementsByTagName("head")[0].appendChild(n)},inject:function(p,e){e=e||document;var n=document.createElement("style");n.type="text/css";n.innerHTML=p;e.getElementsByTagName("head")[0].appendChild(n)}}}();
dat.utils.common=function(){var p=Array.prototype.forEach,e=Array.prototype.slice;return{BREAK:{},extend:function(n){this.each(e.call(arguments,1),function(q){for(var b in q)this.isUndefined(q[b])||(n[b]=q[b])},this);return n},defaults:function(n){this.each(e.call(arguments,1),function(q){for(var b in q)this.isUndefined(n[b])&&(n[b]=q[b])},this);return n},compose:function(){var n=e.call(arguments);return function(){for(var q=e.call(arguments),b=n.length-1;0<=b;b--)q=[n[b].apply(this,q)];return q[0]}},
each:function(n,q,b){if(p&&n.forEach===p)n.forEach(q,b);else if(n.length===n.length+0)for(var c=0,a=n.length;c<a&&!(c in n&&q.call(b,n[c],c)===this.BREAK);c++);else for(c in n)if(q.call(b,n[c],c)===this.BREAK)break},defer:function(n){setTimeout(n,0)},toArray:function(n){return n.toArray?n.toArray():e.call(n)},isUndefined:function(n){return void 0===n},isNull:function(n){return null===n},isNaN:function(n){return n!==n},isArray:Array.isArray||function(n){return n.constructor===Array},isObject:function(n){return n===
Object(n)},isNumber:function(n){return n===n+0},isString:function(n){return n===n+""},isBoolean:function(n){return!1===n||!0===n},isFunction:function(n){return"[object Function]"===Object.prototype.toString.call(n)}}}();
dat.controllers.Controller=function(p){var e=function(n,q){this.initialValue=n[q];this.domElement=document.createElement("div");this.object=n;this.property=q;this.__onFinishChange=this.__onChange=void 0};p.extend(e.prototype,{onChange:function(n){this.__onChange=n;return this},onFinishChange:function(n){this.__onFinishChange=n;return this},setValue:function(n){this.object[this.property]=n;this.__onChange&&this.__onChange.call(this,n);this.updateDisplay();return this},getValue:function(){return this.object[this.property]},
updateDisplay:function(){return this},isModified:function(){return this.initialValue!==this.getValue()}});return e}(dat.utils.common);
dat.dom.dom=function(p){function e(c){if("0"===c||p.isUndefined(c))return 0;c=c.match(q);return p.isNull(c)?0:parseFloat(c[1])}var n={};p.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(c,a){p.each(c,function(g){n[g]=a})});var q=/(\d+(\.\d+)?)px/,b={makeSelectable:function(c,a){void 0!==c&&void 0!==c.style&&(c.onselectstart=a?function(){return!1}:function(){},c.style.MozUserSelect=a?"auto":"none",c.style.KhtmlUserSelect=
a?"auto":"none",c.unselectable=a?"on":"off")},makeFullscreen:function(c,a,g){p.isUndefined(a)&&(a=!0);p.isUndefined(g)&&(g=!0);c.style.position="absolute";a&&(c.style.left=0,c.style.right=0);g&&(c.style.top=0,c.style.bottom=0)},fakeEvent:function(c,a,g,k){g=g||{};var d=n[a];if(!d)throw Error("Event type "+a+" not supported.");var f=document.createEvent(d);switch(d){case "MouseEvents":f.initMouseEvent(a,g.bubbles||!1,g.cancelable||!0,window,g.clickCount||1,0,0,g.x||g.clientX||0,g.y||g.clientY||0,!1,
!1,!1,!1,0,null);break;case "KeyboardEvents":d=f.initKeyboardEvent||f.initKeyEvent;p.defaults(g,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0});d(a,g.bubbles||!1,g.cancelable,window,g.ctrlKey,g.altKey,g.shiftKey,g.metaKey,g.keyCode,g.charCode);break;default:f.initEvent(a,g.bubbles||!1,g.cancelable||!0)}p.defaults(f,k);c.dispatchEvent(f)},bind:function(c,a,g,k){c.addEventListener?c.addEventListener(a,g,k||!1):c.attachEvent&&c.attachEvent("on"+a,g);return b},
unbind:function(c,a,g,k){c.removeEventListener?c.removeEventListener(a,g,k||!1):c.detachEvent&&c.detachEvent("on"+a,g);return b},addClass:function(c,a){if(void 0===c.className)c.className=a;else if(c.className!==a){var g=c.className.split(/ +/);-1==g.indexOf(a)&&(g.push(a),c.className=g.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return b},removeClass:function(c,a){if(a){if(void 0!==c.className)if(c.className===a)c.removeAttribute("class");else{var g=c.className.split(/ +/),k=g.indexOf(a);-1!=
k&&(g.splice(k,1),c.className=g.join(" "))}}else c.className=void 0;return b},hasClass:function(c,a){return(new RegExp("(?:^|\\s+)"+a+"(?:\\s+|$)")).test(c.className)||!1},getWidth:function(c){c=getComputedStyle(c);return e(c["border-left-width"])+e(c["border-right-width"])+e(c["padding-left"])+e(c["padding-right"])+e(c.width)},getHeight:function(c){c=getComputedStyle(c);return e(c["border-top-width"])+e(c["border-bottom-width"])+e(c["padding-top"])+e(c["padding-bottom"])+e(c.height)},getOffset:function(c){var a=
{left:0,top:0};if(c.offsetParent){do a.left+=c.offsetLeft,a.top+=c.offsetTop;while(c=c.offsetParent)}return a},isActive:function(c){return c===document.activeElement&&(c.type||c.href)}};return b}(dat.utils.common);
dat.controllers.OptionController=function(p,e,n){var q=function(b,c,a){q.superclass.call(this,b,c);var g=this;this.__select=document.createElement("select");if(n.isArray(a)){var k={};n.each(a,function(d){k[d]=d});a=k}n.each(a,function(d,f){var h=document.createElement("option");h.innerHTML=f;h.setAttribute("value",d);g.__select.appendChild(h)});this.updateDisplay();e.bind(this.__select,"change",function(){g.setValue(this.options[this.selectedIndex].value)});this.domElement.appendChild(this.__select)};
q.superclass=p;n.extend(q.prototype,p.prototype,{setValue:function(b){b=q.superclass.prototype.setValue.call(this,b);this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue());return b},updateDisplay:function(){this.__select.value=this.getValue();return q.superclass.prototype.updateDisplay.call(this)}});return q}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);
dat.controllers.NumberController=function(p,e){var n=function(q,b,c){n.superclass.call(this,q,b);c=c||{};this.__min=c.min;this.__max=c.max;this.__step=c.step;e.isUndefined(this.__step)?this.__impliedStep=0==this.initialValue?1:Math.pow(10,Math.floor(Math.log(this.initialValue)/Math.LN10))/10:this.__impliedStep=this.__step;q=this.__impliedStep;q=q.toString();q=-1<q.indexOf(".")?q.length-q.indexOf(".")-1:0;this.__precision=q};n.superclass=p;e.extend(n.prototype,p.prototype,{setValue:function(q){void 0!==
this.__min&&q<this.__min?q=this.__min:void 0!==this.__max&&q>this.__max&&(q=this.__max);void 0!==this.__step&&0!=q%this.__step&&(q=Math.round(q/this.__step)*this.__step);return n.superclass.prototype.setValue.call(this,q)},min:function(q){this.__min=q;return this},max:function(q){this.__max=q;return this},step:function(q){this.__step=q;return this}});return n}(dat.controllers.Controller,dat.utils.common);
dat.controllers.NumberControllerBox=function(p,e,n){var q=function(b,c,a){function g(){var m=parseFloat(f.__input.value);n.isNaN(m)||f.setValue(m)}function k(m){var l=h-m.clientY;f.setValue(f.getValue()+l*f.__impliedStep);h=m.clientY}function d(){e.unbind(window,"mousemove",k);e.unbind(window,"mouseup",d)}this.__truncationSuspended=!1;q.superclass.call(this,b,c,a);var f=this,h;this.__input=document.createElement("input");this.__input.setAttribute("type","text");e.bind(this.__input,"change",g);e.bind(this.__input,
"blur",function(){g();f.__onFinishChange&&f.__onFinishChange.call(f,f.getValue())});e.bind(this.__input,"mousedown",function(m){e.bind(window,"mousemove",k);e.bind(window,"mouseup",d);h=m.clientY});e.bind(this.__input,"keydown",function(m){13===m.keyCode&&(f.__truncationSuspended=!0,this.blur(),f.__truncationSuspended=!1)});this.updateDisplay();this.domElement.appendChild(this.__input)};q.superclass=p;n.extend(q.prototype,p.prototype,{updateDisplay:function(){var b=this.__input;if(this.__truncationSuspended)var c=
this.getValue();else{c=this.getValue();var a=Math.pow(10,this.__precision);c=Math.round(c*a)/a}b.value=c;return q.superclass.prototype.updateDisplay.call(this)}});return q}(dat.controllers.NumberController,dat.dom.dom,dat.utils.common);
dat.controllers.NumberControllerSlider=function(p,e,n,q,b){var c=function(a,g,k,d,f){function h(r){r.preventDefault();var u=e.getOffset(l.__background),v=e.getWidth(l.__background),x=l,w=u.left,G=l.__min;x.setValue.call(x,G+(r.clientX-w)/(u.left+v-w)*(l.__max-G));return!1}function m(){e.unbind(window,"mousemove",h);e.unbind(window,"mouseup",m);l.__onFinishChange&&l.__onFinishChange.call(l,l.getValue())}c.superclass.call(this,a,g,{min:k,max:d,step:f});var l=this;this.__background=document.createElement("div");
this.__foreground=document.createElement("div");e.bind(this.__background,"mousedown",function(r){e.bind(window,"mousemove",h);e.bind(window,"mouseup",m);h(r)});e.addClass(this.__background,"slider");e.addClass(this.__foreground,"slider-fg");this.updateDisplay();this.__background.appendChild(this.__foreground);this.domElement.appendChild(this.__background)};c.superclass=p;c.useDefaultStyles=function(){n.inject(b)};q.extend(c.prototype,p.prototype,{updateDisplay:function(){var a=(this.getValue()-this.__min)/
(this.__max-this.__min);this.__foreground.style.width=100*a+"%";return c.superclass.prototype.updateDisplay.call(this)}});return c}(dat.controllers.NumberController,dat.dom.dom,dat.utils.css,dat.utils.common,".slider {\n  box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);\n  height: 1em;\n  border-radius: 1em;\n  background-color: #eee;\n  padding: 0 0.5em;\n  overflow: hidden;\n}\n\n.slider-fg {\n  padding: 1px 0 2px 0;\n  background-color: #aaa;\n  height: 1em;\n  margin-left: -0.5em;\n  padding-right: 0.5em;\n  border-radius: 1em 0 0 1em;\n}\n\n.slider-fg:after {\n  display: inline-block;\n  border-radius: 1em;\n  background-color: #fff;\n  border:  1px solid #aaa;\n  content: '';\n  float: right;\n  margin-right: -1em;\n  margin-top: -1px;\n  height: 0.9em;\n  width: 0.9em;\n}");
dat.controllers.FunctionController=function(p,e,n){var q=function(b,c,a){q.superclass.call(this,b,c);var g=this;this.__button=document.createElement("div");this.__button.innerHTML=void 0===a?"Fire":a;e.bind(this.__button,"click",function(k){k.preventDefault();g.fire();return!1});e.addClass(this.__button,"button");this.domElement.appendChild(this.__button)};q.superclass=p;n.extend(q.prototype,p.prototype,{fire:function(){this.__onChange&&this.__onChange.call(this);this.__onFinishChange&&this.__onFinishChange.call(this,
this.getValue());this.getValue().call(this.object)}});return q}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);
dat.controllers.BooleanController=function(p,e,n){var q=function(b,c){q.superclass.call(this,b,c);var a=this;this.__prev=this.getValue();this.__checkbox=document.createElement("input");this.__checkbox.setAttribute("type","checkbox");e.bind(this.__checkbox,"change",function(){a.setValue(!a.__prev)},!1);this.domElement.appendChild(this.__checkbox);this.updateDisplay()};q.superclass=p;n.extend(q.prototype,p.prototype,{setValue:function(b){b=q.superclass.prototype.setValue.call(this,b);this.__onFinishChange&&
this.__onFinishChange.call(this,this.getValue());this.__prev=this.getValue();return b},updateDisplay:function(){!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0):this.__checkbox.checked=!1;return q.superclass.prototype.updateDisplay.call(this)}});return q}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);
dat.color.toString=function(p){return function(e){if(1==e.a||p.isUndefined(e.a)){for(e=e.hex.toString(16);6>e.length;)e="0"+e;return"#"+e}return"rgba("+Math.round(e.r)+","+Math.round(e.g)+","+Math.round(e.b)+","+e.a+")"}}(dat.utils.common);
dat.color.interpret=function(p,e){var n,q,b=[{litmus:e.isString,conversions:{THREE_CHAR_HEX:{read:function(c){c=c.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null===c?!1:{space:"HEX",hex:parseInt("0x"+c[1].toString()+c[1].toString()+c[2].toString()+c[2].toString()+c[3].toString()+c[3].toString())}},write:p},SIX_CHAR_HEX:{read:function(c){c=c.match(/^#([A-F0-9]{6})$/i);return null===c?!1:{space:"HEX",hex:parseInt("0x"+c[1].toString())}},write:p},CSS_RGB:{read:function(c){c=c.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);
return null===c?!1:{space:"RGB",r:parseFloat(c[1]),g:parseFloat(c[2]),b:parseFloat(c[3])}},write:p},CSS_RGBA:{read:function(c){c=c.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null===c?!1:{space:"RGB",r:parseFloat(c[1]),g:parseFloat(c[2]),b:parseFloat(c[3]),a:parseFloat(c[4])}},write:p}}},{litmus:e.isNumber,conversions:{HEX:{read:function(c){return{space:"HEX",hex:c,conversionName:"HEX"}},write:function(c){return c.hex}}}},{litmus:e.isArray,conversions:{RGB_ARRAY:{read:function(c){return 3!=
c.length?!1:{space:"RGB",r:c[0],g:c[1],b:c[2]}},write:function(c){return[c.r,c.g,c.b]}},RGBA_ARRAY:{read:function(c){return 4!=c.length?!1:{space:"RGB",r:c[0],g:c[1],b:c[2],a:c[3]}},write:function(c){return[c.r,c.g,c.b,c.a]}}}},{litmus:e.isObject,conversions:{RGBA_OBJ:{read:function(c){return e.isNumber(c.r)&&e.isNumber(c.g)&&e.isNumber(c.b)&&e.isNumber(c.a)?{space:"RGB",r:c.r,g:c.g,b:c.b,a:c.a}:!1},write:function(c){return{r:c.r,g:c.g,b:c.b,a:c.a}}},RGB_OBJ:{read:function(c){return e.isNumber(c.r)&&
e.isNumber(c.g)&&e.isNumber(c.b)?{space:"RGB",r:c.r,g:c.g,b:c.b}:!1},write:function(c){return{r:c.r,g:c.g,b:c.b}}},HSVA_OBJ:{read:function(c){return e.isNumber(c.h)&&e.isNumber(c.s)&&e.isNumber(c.v)&&e.isNumber(c.a)?{space:"HSV",h:c.h,s:c.s,v:c.v,a:c.a}:!1},write:function(c){return{h:c.h,s:c.s,v:c.v,a:c.a}}},HSV_OBJ:{read:function(c){return e.isNumber(c.h)&&e.isNumber(c.s)&&e.isNumber(c.v)?{space:"HSV",h:c.h,s:c.s,v:c.v}:!1},write:function(c){return{h:c.h,s:c.s,v:c.v}}}}}];return function(){q=!1;
var c=1<arguments.length?e.toArray(arguments):arguments[0];e.each(b,function(a){if(a.litmus(c))return e.each(a.conversions,function(g,k){n=g.read(c);if(!1===q&&!1!==n)return q=n,n.conversionName=k,n.conversion=g,e.BREAK}),e.BREAK});return q}}(dat.color.toString,dat.utils.common);
dat.GUI=dat.gui.GUI=function(p,e,n,q,b,c,a,g,k,d,f,h,m,l,r){function u(A,B,t,z){if(void 0===B[t])throw Error("Object "+B+' has no property "'+t+'"');z.color?B=new f(B,t):(B=[B,t].concat(z.factoryArgs),B=q.apply(A,B));z.before instanceof b&&(z.before=z.before.__li);w(A,B);l.addClass(B.domElement,"c");t=document.createElement("span");l.addClass(t,"property-name");t.innerHTML=B.property;var J=document.createElement("div");J.appendChild(t);J.appendChild(B.domElement);z=v(A,J,z.before);l.addClass(z,M.CLASS_CONTROLLER_ROW);
l.addClass(z,typeof B.getValue());x(A,z,B);A.__controllers.push(B);return B}function v(A,B,t){var z=document.createElement("li");B&&z.appendChild(B);t?A.__ul.insertBefore(z,params.before):A.__ul.appendChild(z);A.onResize();return z}function x(A,B,t){t.__li=B;t.__gui=A;r.extend(t,{options:function(I){if(1<arguments.length)return t.remove(),u(A,t.object,t.property,{before:t.__li.nextElementSibling,factoryArgs:[r.toArray(arguments)]});if(r.isArray(I)||r.isObject(I))return t.remove(),u(A,t.object,t.property,
{before:t.__li.nextElementSibling,factoryArgs:[I]})},name:function(I){t.__li.firstElementChild.firstElementChild.innerHTML=I;return t},listen:function(){t.__gui.listen(t);return t},remove:function(){t.__gui.remove(t);return t}});if(t instanceof k){var z=new g(t.object,t.property,{min:t.__min,max:t.__max,step:t.__step});r.each(["updateDisplay","onChange","onFinishChange"],function(I){var Q=t[I],F=z[I];t[I]=z[I]=function(){var U=Array.prototype.slice.call(arguments);Q.apply(t,U);return F.apply(z,U)}});
l.addClass(B,"has-slider");t.domElement.insertBefore(z.domElement,t.domElement.firstElementChild)}else if(t instanceof g){var J=function(I){return r.isNumber(t.__min)&&r.isNumber(t.__max)?(t.remove(),u(A,t.object,t.property,{before:t.__li.nextElementSibling,factoryArgs:[t.__min,t.__max,t.__step]})):I};t.min=r.compose(J,t.min);t.max=r.compose(J,t.max)}else t instanceof c?(l.bind(B,"click",function(){l.fakeEvent(t.__checkbox,"click")}),l.bind(t.__checkbox,"click",function(I){I.stopPropagation()})):
t instanceof a?(l.bind(B,"click",function(){l.fakeEvent(t.__button,"click")}),l.bind(B,"mouseover",function(){l.addClass(t.__button,"hover")}),l.bind(B,"mouseout",function(){l.removeClass(t.__button,"hover")})):t instanceof f&&(l.addClass(B,"color"),t.updateDisplay=r.compose(function(I){B.style.borderLeftColor=t.__color.toString();return I},t.updateDisplay),t.updateDisplay());t.setValue=r.compose(function(I){A.getRoot().__preset_select&&t.isModified()&&C(A.getRoot(),!0);return I},t.setValue)}function w(A,
B){var t=A.getRoot(),z=t.__rememberedObjects.indexOf(B.object);if(-1!=z){var J=t.__rememberedObjectIndecesToControllers[z];void 0===J&&(J={},t.__rememberedObjectIndecesToControllers[z]=J);J[B.property]=B;if(t.load&&t.load.remembered){t=t.load.remembered;if(t[A.preset])t=t[A.preset];else if(t.Default)t=t.Default;else return;t[z]&&void 0!==t[z][B.property]&&(z=t[z][B.property],B.initialValue=z,B.setValue(z))}}}function G(A){var B=A.__save_row=document.createElement("li");l.addClass(A.domElement,"has-save");
A.__ul.insertBefore(B,A.__ul.firstChild);l.addClass(B,"save-row");var t=document.createElement("span");t.innerHTML="&nbsp;";l.addClass(t,"button gears");var z=document.createElement("span");z.innerHTML="Save";l.addClass(z,"button");l.addClass(z,"save");var J=document.createElement("span");J.innerHTML="New";l.addClass(J,"button");l.addClass(J,"save-as");var I=document.createElement("span");I.innerHTML="Revert";l.addClass(I,"button");l.addClass(I,"revert");var Q=A.__preset_select=document.createElement("select");
A.load&&A.load.remembered?r.each(A.load.remembered,function(S,W){L(A,W,W==A.preset)}):L(A,"Default",!1);l.bind(Q,"change",function(){for(var S=0;S<A.__preset_select.length;S++)A.__preset_select[S].innerHTML=A.__preset_select[S].value;A.preset=this.value});B.appendChild(Q);B.appendChild(t);B.appendChild(z);B.appendChild(J);B.appendChild(I);if(H){var F=function(){U.style.display=A.useLocalStorage?"block":"none"};B=document.getElementById("dg-save-locally");var U=document.getElementById("dg-local-explain");
B.style.display="block";B=document.getElementById("dg-local-storage");"true"===localStorage.getItem(document.location.href+".isLocal")&&B.setAttribute("checked","checked");F();l.bind(B,"change",function(){A.useLocalStorage=!A.useLocalStorage;F()})}var Z=document.getElementById("dg-new-constructor");l.bind(Z,"keydown",function(S){!S.metaKey||67!==S.which&&67!=S.keyCode||P.hide()});l.bind(t,"click",function(){Z.innerHTML=JSON.stringify(A.getSaveObject(),void 0,2);P.show();Z.focus();Z.select()});l.bind(z,
"click",function(){A.save()});l.bind(J,"click",function(){var S=prompt("Enter a new preset name.");S&&A.saveAs(S)});l.bind(I,"click",function(){A.revert()})}function N(A){function B(I){I.preventDefault();J=I.clientX;l.addClass(A.__closeButton,M.CLASS_DRAG);l.bind(window,"mousemove",t);l.bind(window,"mouseup",z);return!1}function t(I){I.preventDefault();A.width+=J-I.clientX;A.onResize();J=I.clientX;return!1}function z(){l.removeClass(A.__closeButton,M.CLASS_DRAG);l.unbind(window,"mousemove",t);l.unbind(window,
"mouseup",z)}A.__resize_handle=document.createElement("div");r.extend(A.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});var J;l.bind(A.__resize_handle,"mousedown",B);l.bind(A.__closeButton,"mousedown",B);A.domElement.insertBefore(A.__resize_handle,A.domElement.firstElementChild)}function K(A,B){A.domElement.style.width=B+"px";A.__save_row&&A.autoPlace&&(A.__save_row.style.width=B+"px");A.__closeButton&&(A.__closeButton.style.width=B+"px")}
function T(A,B){var t={};r.each(A.__rememberedObjects,function(z,J){var I={};r.each(A.__rememberedObjectIndecesToControllers[J],function(Q,F){I[F]=B?Q.initialValue:Q.getValue()});t[J]=I});return t}function L(A,B,t){var z=document.createElement("option");z.innerHTML=B;z.value=B;A.__preset_select.appendChild(z);t&&(A.__preset_select.selectedIndex=A.__preset_select.length-1)}function C(A,B){var t=A.__preset_select[A.__preset_select.selectedIndex];t.innerHTML=B?t.value+"*":t.value}function D(A){0!=A.length&&
h(function(){D(A)});r.each(A,function(B){B.updateDisplay()})}p.inject(n);try{var H="localStorage"in window&&null!==window.localStorage}catch(A){H=!1}var P,y=!0,V,E=!1,R=[],M=function(A){function B(){localStorage.setItem(document.location.href+".gui",JSON.stringify(z.getSaveObject()))}function t(){var F=z.getRoot();F.width+=1;r.defer(function(){--F.width})}var z=this;this.domElement=document.createElement("div");this.__ul=document.createElement("ul");this.domElement.appendChild(this.__ul);l.addClass(this.domElement,
"dg");this.__folders={};this.__controllers=[];this.__rememberedObjects=[];this.__rememberedObjectIndecesToControllers=[];this.__listening=[];A=A||{};A=r.defaults(A,{autoPlace:!0,width:M.DEFAULT_WIDTH});A=r.defaults(A,{resizable:A.autoPlace,hideable:A.autoPlace});r.isUndefined(A.load)?A.load={preset:"Default"}:A.preset&&(A.load.preset=A.preset);r.isUndefined(A.parent)&&A.hideable&&R.push(this);A.resizable=r.isUndefined(A.parent)&&A.resizable;A.autoPlace&&r.isUndefined(A.scrollable)&&(A.scrollable=
!0);var J=H&&"true"===localStorage.getItem(document.location.href+".isLocal");Object.defineProperties(this,{parent:{get:function(){return A.parent}},scrollable:{get:function(){return A.scrollable}},autoPlace:{get:function(){return A.autoPlace}},preset:{get:function(){return z.parent?z.getRoot().preset:A.load.preset},set:function(F){z.parent?z.getRoot().preset=F:A.load.preset=F;for(F=0;F<this.__preset_select.length;F++)this.__preset_select[F].value==this.preset&&(this.__preset_select.selectedIndex=
F);z.revert()}},width:{get:function(){return A.width},set:function(F){A.width=F;K(z,F)}},name:{get:function(){return A.name},set:function(F){A.name=F;Q&&(Q.innerHTML=A.name)}},closed:{get:function(){return A.closed},set:function(F){A.closed=F;A.closed?l.addClass(z.__ul,M.CLASS_CLOSED):l.removeClass(z.__ul,M.CLASS_CLOSED);this.onResize();z.__closeButton&&(z.__closeButton.innerHTML=F?M.TEXT_OPEN:M.TEXT_CLOSED)}},load:{get:function(){return A.load}},useLocalStorage:{get:function(){return J},set:function(F){H&&
((J=F)?l.bind(window,"unload",B):l.unbind(window,"unload",B),localStorage.setItem(document.location.href+".isLocal",F))}}});if(r.isUndefined(A.parent)){A.closed=!1;l.addClass(this.domElement,M.CLASS_MAIN);l.makeSelectable(this.domElement,!1);if(H&&J){z.useLocalStorage=!0;var I=localStorage.getItem(document.location.href+".gui");I&&(A.load=JSON.parse(I))}this.__closeButton=document.createElement("div");this.__closeButton.innerHTML=M.TEXT_CLOSED;l.addClass(this.__closeButton,M.CLASS_CLOSE_BUTTON);this.domElement.appendChild(this.__closeButton);
l.bind(this.__closeButton,"click",function(){z.closed=!z.closed})}else{void 0===A.closed&&(A.closed=!0);var Q=document.createTextNode(A.name);l.addClass(Q,"controller-name");I=v(z,Q);l.addClass(this.__ul,M.CLASS_CLOSED);l.addClass(I,"title");l.bind(I,"click",function(F){F.preventDefault();z.closed=!z.closed;return!1});A.closed||(this.closed=!1)}A.autoPlace&&(r.isUndefined(A.parent)&&(y&&(V=document.createElement("div"),l.addClass(V,"dg"),l.addClass(V,M.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(V),
y=!1),V.appendChild(this.domElement),l.addClass(this.domElement,M.CLASS_AUTO_PLACE)),this.parent||K(z,A.width));l.bind(window,"resize",function(){z.onResize()});l.bind(this.__ul,"webkitTransitionEnd",function(){z.onResize()});l.bind(this.__ul,"transitionend",function(){z.onResize()});l.bind(this.__ul,"oTransitionEnd",function(){z.onResize()});this.onResize();A.resizable&&N(this);z.getRoot();A.parent||t()};M.toggleHide=function(){E=!E;r.each(R,function(A){A.domElement.style.zIndex=E?-999:999;A.domElement.style.opacity=
E?0:1})};M.CLASS_AUTO_PLACE="a";M.CLASS_AUTO_PLACE_CONTAINER="ac";M.CLASS_MAIN="main";M.CLASS_CONTROLLER_ROW="cr";M.CLASS_TOO_TALL="taller-than-window";M.CLASS_CLOSED="closed";M.CLASS_CLOSE_BUTTON="close-button";M.CLASS_DRAG="drag";M.DEFAULT_WIDTH=245;M.TEXT_CLOSED="Close Controls";M.TEXT_OPEN="Open Controls";l.bind(window,"keydown",function(A){"text"===document.activeElement.type||72!==A.which&&72!=A.keyCode||M.toggleHide()},!1);r.extend(M.prototype,{add:function(A,B){return u(this,A,B,{factoryArgs:Array.prototype.slice.call(arguments,
2)})},addColor:function(A,B){return u(this,A,B,{color:!0})},remove:function(A){this.__ul.removeChild(A.__li);this.__controllers.slice(this.__controllers.indexOf(A),1);var B=this;r.defer(function(){B.onResize()})},destroy:function(){this.autoPlace&&V.removeChild(this.domElement)},addFolder:function(A){if(void 0!==this.__folders[A])throw Error('You already have a folder in this GUI by the name "'+A+'"');var B={name:A,parent:this};B.autoPlace=this.autoPlace;this.load&&this.load.folders&&this.load.folders[A]&&
(B.closed=this.load.folders[A].closed,B.load=this.load.folders[A]);B=new M(B);this.__folders[A]=B;A=v(this,B.domElement);l.addClass(A,"folder");return B},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var A=this.getRoot();if(A.scrollable){var B=l.getOffset(A.__ul).top,t=0;r.each(A.__ul.childNodes,function(z){A.autoPlace&&z===A.__save_row||(t+=l.getHeight(z))});window.innerHeight-B-20<t?(l.addClass(A.domElement,M.CLASS_TOO_TALL),A.__ul.style.height=window.innerHeight-
B-20+"px"):(l.removeClass(A.domElement,M.CLASS_TOO_TALL),A.__ul.style.height="auto")}A.__resize_handle&&r.defer(function(){A.__resize_handle.style.height=A.__ul.offsetHeight+"px"});A.__closeButton&&(A.__closeButton.style.width=A.width+"px")},remember:function(){r.isUndefined(P)&&(P=new m,P.domElement.innerHTML=e);if(this.parent)throw Error("You can only call remember on a top level GUI.");var A=this;r.each(Array.prototype.slice.call(arguments),function(B){0==A.__rememberedObjects.length&&G(A);-1==
A.__rememberedObjects.indexOf(B)&&A.__rememberedObjects.push(B)});this.autoPlace&&K(this,this.width)},getRoot:function(){for(var A=this;A.parent;)A=A.parent;return A},getSaveObject:function(){var A=this.load;A.closed=this.closed;0<this.__rememberedObjects.length&&(A.preset=this.preset,A.remembered||(A.remembered={}),A.remembered[this.preset]=T(this));A.folders={};r.each(this.__folders,function(B,t){A.folders[t]=B.getSaveObject()});return A},save:function(){this.load.remembered||(this.load.remembered=
{});this.load.remembered[this.preset]=T(this);C(this,!1)},saveAs:function(A){this.load.remembered||(this.load.remembered={},this.load.remembered.Default=T(this,!0));this.load.remembered[A]=T(this);this.preset=A;L(this,A,!0)},revert:function(A){r.each(this.__controllers,function(B){this.getRoot().load.remembered?w(A||this.getRoot(),B):B.setValue(B.initialValue)},this);r.each(this.__folders,function(B){B.revert(B)});A||C(this.getRoot(),!1)},listen:function(A){var B=0==this.__listening.length;this.__listening.push(A);
B&&D(this.__listening)}});return M}(dat.utils.css,'<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n      \n    </div>\n    \n  </div>\n\n</div>',
".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear;border:0;position:absolute;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-x:hidden}.dg.a.has-save ul{margin-top:27px}.dg.a.has-save ul.closed{margin-top:0}.dg.a .save-row{position:fixed;top:0;z-index:1002}.dg li{-webkit-transition:height 0.1s ease-out;-o-transition:height 0.1s ease-out;-moz-transition:height 0.1s ease-out;transition:height 0.1s ease-out}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;overflow:hidden;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li > *{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:9px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2fa1d6}.dg .cr.number input[type=text]{color:#2fa1d6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2fa1d6}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n",
dat.controllers.factory=function(p,e,n,q,b,c,a){return function(g,k,d,f){var h=g[k];if(a.isArray(d)||a.isObject(d))return new p(g,k,d);if(a.isNumber(h))return a.isNumber(d)&&a.isNumber(f)?new n(g,k,d,f):new e(g,k,{min:d,max:f});if(a.isString(h))return new q(g,k);if(a.isFunction(h))return new b(g,k,"");if(a.isBoolean(h))return new c(g,k)}}(dat.controllers.OptionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.StringController=function(p,e,n){var q=
function(b,c){function a(){g.setValue(g.__input.value)}q.superclass.call(this,b,c);var g=this;this.__input=document.createElement("input");this.__input.setAttribute("type","text");e.bind(this.__input,"keyup",a);e.bind(this.__input,"change",a);e.bind(this.__input,"blur",function(){g.__onFinishChange&&g.__onFinishChange.call(g,g.getValue())});e.bind(this.__input,"keydown",function(k){13===k.keyCode&&this.blur()});this.updateDisplay();this.domElement.appendChild(this.__input)};q.superclass=p;n.extend(q.prototype,
p.prototype,{updateDisplay:function(){e.isActive(this.__input)||(this.__input.value=this.getValue());return q.superclass.prototype.updateDisplay.call(this)}});return q}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.controllers.FunctionController,dat.controllers.BooleanController,dat.utils.common),dat.controllers.Controller,dat.controllers.BooleanController,dat.controllers.FunctionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.OptionController,
dat.controllers.ColorController=function(p,e,n,q,b){function c(d,f,h,m){d.style.background="";b.each(k,function(l){d.style.cssText+="background: "+l+"linear-gradient("+f+", "+h+" 0%, "+m+" 100%); "})}function a(d){d.style.background="";d.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);";d.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";
d.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";d.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";d.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var g=function(d,f){function h(G){u(G);e.bind(window,"mousemove",u);e.bind(window,
"mouseup",m)}function m(){e.unbind(window,"mousemove",u);e.unbind(window,"mouseup",m)}function l(){var G=q(this.value);!1!==G?(x.__color.__state=G,x.setValue(x.__color.toOriginal())):this.value=x.__color.toString()}function r(){e.unbind(window,"mousemove",v);e.unbind(window,"mouseup",r)}function u(G){G.preventDefault();var N=e.getWidth(x.__saturation_field),K=e.getOffset(x.__saturation_field),T=(G.clientX-K.left+document.body.scrollLeft)/N;G=1-(G.clientY-K.top+document.body.scrollTop)/N;1<G?G=1:0>
G&&(G=0);1<T?T=1:0>T&&(T=0);x.__color.v=G;x.__color.s=T;x.setValue(x.__color.toOriginal());return!1}function v(G){G.preventDefault();var N=e.getHeight(x.__hue_field),K=e.getOffset(x.__hue_field);G=1-(G.clientY-K.top+document.body.scrollTop)/N;1<G?G=1:0>G&&(G=0);x.__color.h=360*G;x.setValue(x.__color.toOriginal());return!1}g.superclass.call(this,d,f);this.__color=new n(this.getValue());this.__temp=new n(0);var x=this;this.domElement=document.createElement("div");e.makeSelectable(this.domElement,!1);
this.__selector=document.createElement("div");this.__selector.className="selector";this.__saturation_field=document.createElement("div");this.__saturation_field.className="saturation-field";this.__field_knob=document.createElement("div");this.__field_knob.className="field-knob";this.__field_knob_border="2px solid ";this.__hue_knob=document.createElement("div");this.__hue_knob.className="hue-knob";this.__hue_field=document.createElement("div");this.__hue_field.className="hue-field";this.__input=document.createElement("input");
this.__input.type="text";this.__input_textShadow="0 1px 1px ";e.bind(this.__input,"keydown",function(G){13===G.keyCode&&l.call(this)});e.bind(this.__input,"blur",l);e.bind(this.__selector,"mousedown",function(G){e.addClass(this,"drag").bind(window,"mouseup",function(N){e.removeClass(x.__selector,"drag")})});var w=document.createElement("div");b.extend(this.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"});b.extend(this.__field_knob.style,
{position:"absolute",width:"12px",height:"12px",border:this.__field_knob_border+(.5>this.__color.v?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1});b.extend(this.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1});b.extend(this.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"});b.extend(w.style,{width:"100%",height:"100%",
background:"none"});c(w,"top","rgba(0,0,0,0)","#000");b.extend(this.__hue_field.style,{width:"15px",height:"100px",display:"inline-block",border:"1px solid #555",cursor:"ns-resize"});a(this.__hue_field);b.extend(this.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:this.__input_textShadow+"rgba(0,0,0,0.7)"});e.bind(this.__saturation_field,"mousedown",h);e.bind(this.__field_knob,"mousedown",h);e.bind(this.__hue_field,"mousedown",function(G){v(G);e.bind(window,
"mousemove",v);e.bind(window,"mouseup",r)});this.__saturation_field.appendChild(w);this.__selector.appendChild(this.__field_knob);this.__selector.appendChild(this.__saturation_field);this.__selector.appendChild(this.__hue_field);this.__hue_field.appendChild(this.__hue_knob);this.domElement.appendChild(this.__input);this.domElement.appendChild(this.__selector);this.updateDisplay()};g.superclass=p;b.extend(g.prototype,p.prototype,{updateDisplay:function(){var d=q(this.getValue());if(!1!==d){var f=!1;
b.each(n.COMPONENTS,function(l){if(!b.isUndefined(d[l])&&!b.isUndefined(this.__color.__state[l])&&d[l]!==this.__color.__state[l])return f=!0,{}},this);f&&b.extend(this.__color.__state,d)}b.extend(this.__temp.__state,this.__color.__state);this.__temp.a=1;var h=.5>this.__color.v||.5<this.__color.s?255:0,m=255-h;b.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toString(),border:this.__field_knob_border+"rgb("+h+
","+h+","+h+")"});this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px";this.__temp.s=1;this.__temp.v=1;c(this.__saturation_field,"left","#fff",this.__temp.toString());b.extend(this.__input.style,{backgroundColor:this.__input.value=this.__color.toString(),color:"rgb("+h+","+h+","+h+")",textShadow:this.__input_textShadow+"rgba("+m+","+m+","+m+",.7)"})}});var k=["-moz-","-o-","-webkit-","-ms-",""];return g}(dat.controllers.Controller,dat.dom.dom,dat.color.Color=function(p,e,n,q){function b(d,
f,h){Object.defineProperty(d,f,{get:function(){if("RGB"===this.__state.space)return this.__state[f];a(this,f,h);return this.__state[f]},set:function(m){"RGB"!==this.__state.space&&(a(this,f,h),this.__state.space="RGB");this.__state[f]=m}})}function c(d,f){Object.defineProperty(d,f,{get:function(){if("HSV"===this.__state.space)return this.__state[f];g(this);return this.__state[f]},set:function(h){"HSV"!==this.__state.space&&(g(this),this.__state.space="HSV");this.__state[f]=h}})}function a(d,f,h){if("HEX"===
d.__state.space)d.__state[f]=e.component_from_hex(d.__state.hex,h);else if("HSV"===d.__state.space)q.extend(d.__state,e.hsv_to_rgb(d.__state.h,d.__state.s,d.__state.v));else throw"Corrupted color state";}function g(d){var f=e.rgb_to_hsv(d.r,d.g,d.b);q.extend(d.__state,{s:f.s,v:f.v});q.isNaN(f.h)?q.isUndefined(d.__state.h)&&(d.__state.h=0):d.__state.h=f.h}var k=function(){this.__state=p.apply(this,arguments);if(!1===this.__state)throw"Failed to interpret color arguments";this.__state.a=this.__state.a||
1};k.COMPONENTS="r g b h s v hex a".split(" ");q.extend(k.prototype,{toString:function(){return n(this)},toOriginal:function(){return this.__state.conversion.write(this)}});b(k.prototype,"r",2);b(k.prototype,"g",1);b(k.prototype,"b",0);c(k.prototype,"h");c(k.prototype,"s");c(k.prototype,"v");Object.defineProperty(k.prototype,"a",{get:function(){return this.__state.a},set:function(d){this.__state.a=d}});Object.defineProperty(k.prototype,"hex",{get:function(){this.__state.hex=e.rgb_to_hex(this.r,this.g,
this.b);return this.__state.hex},set:function(d){this.__state.space="HEX";this.__state.hex=d}});return k}(dat.color.interpret,dat.color.math=function(){var p;return{hsv_to_rgb:function(e,n,q){var b=e/60-Math.floor(e/60),c=q*(1-n),a=q*(1-b*n);n=q*(1-(1-b)*n);e=[[q,n,c],[a,q,c],[c,q,n],[c,a,q],[n,c,q],[q,c,a]][Math.floor(e/60)%6];return{r:255*e[0],g:255*e[1],b:255*e[2]}},rgb_to_hsv:function(e,n,q){var b=Math.max(e,n,q),c=b-Math.min(e,n,q);if(0==b)return{h:NaN,s:0,v:0};e=(e==b?(n-q)/c:n==b?2+(q-e)/c:
4+(e-n)/c)/6;0>e&&(e+=1);return{h:360*e,s:c/b,v:b/255}},rgb_to_hex:function(e,n,q){e=this.hex_with_component(0,2,e);e=this.hex_with_component(e,1,n);return e=this.hex_with_component(e,0,q)},component_from_hex:function(e,n){return e>>8*n&255},hex_with_component:function(e,n,q){return q<<(p=8*n)|e&~(255<<p)}}}(),dat.color.toString,dat.utils.common),dat.color.interpret,dat.utils.common),dat.utils.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||
window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(p,e){window.setTimeout(p,1E3/60)}}(),dat.dom.CenteredDiv=function(p,e){var n=function(){this.backgroundElement=document.createElement("div");e.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear"});p.makeFullscreen(this.backgroundElement);this.backgroundElement.style.position="fixed";this.domElement=document.createElement("div");
e.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear"});document.body.appendChild(this.backgroundElement);document.body.appendChild(this.domElement);var q=this;p.bind(this.backgroundElement,"click",function(){q.hide()})};n.prototype.show=function(){var q=this;this.backgroundElement.style.display="block";this.domElement.style.display="block";this.domElement.style.opacity=0;this.domElement.style.webkitTransform=
"scale(1.1)";this.layout();e.defer(function(){q.backgroundElement.style.opacity=1;q.domElement.style.opacity=1;q.domElement.style.webkitTransform="scale(1)"})};n.prototype.hide=function(){var q=this,b=function(){q.domElement.style.display="none";q.backgroundElement.style.display="none";p.unbind(q.domElement,"webkitTransitionEnd",b);p.unbind(q.domElement,"transitionend",b);p.unbind(q.domElement,"oTransitionEnd",b)};p.bind(this.domElement,"webkitTransitionEnd",b);p.bind(this.domElement,"transitionend",
b);p.bind(this.domElement,"oTransitionEnd",b);this.backgroundElement.style.opacity=0;this.domElement.style.opacity=0;this.domElement.style.webkitTransform="scale(1.1)"};n.prototype.layout=function(){this.domElement.style.left=window.innerWidth/2-p.getWidth(this.domElement)/2+"px";this.domElement.style.top=window.innerHeight/2-p.getHeight(this.domElement)/2+"px"};return n}(dat.dom.dom,dat.utils.common),dat.dom.dom,dat.utils.common);
function CGoal(p,e,n,q,b){var c;this._init=function(k,d,f){c=createBitmap(f);this.setPosition(k,d);g.addChild(c)};this.unload=function(){g.removeChild(c)};this.setPosition=function(k,d){c.x=k;c.y=d};this.getObject=function(){return c};this.getDepthPos=function(){return a.position.y};this.getPhysics=function(){return a};this.getX=function(){return c.x};this.getY=function(){return c.y};var a=q;var g=b;this._init(p,e,n);return this}
function CWinPanel(p,e){var n,q,b,c,a,g,k,d,f,h,m;this._init=function(l,r){m=new createjs.Shape;m.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);m.alpha=0;s_oStage.addChild(m);d=new createjs.Container;d.alpha=1;d.visible=!1;d.y=CANVAS_HEIGHT;n=createBitmap(l);n.x=CANVAS_WIDTH_HALF;n.y=CANVAS_HEIGHT_HALF;n.regX=.5*l.width;n.regY=.5*l.height;d.addChild(n);b=new CTLText(d,CANVAS_WIDTH/2-l.width/2+20,CANVAS_HEIGHT_HALF-250,l.width-40,60,60,"center","#fff",FONT_GAME,1,0,0," ",!0,
!0,!0,!1);q=new CTLText(d,CANVAS_WIDTH/2-l.width/2+20,CANVAS_HEIGHT_HALF-120,l.width-40,34,34,"center","#fff",FONT_GAME,1,0,0," ",!0,!0,!0,!1);c=new CTLText(d,CANVAS_WIDTH/2-l.width/2+20,CANVAS_HEIGHT_HALF-70,l.width-40,34,34,"center","#fff",FONT_GAME,1,0,0," ",!0,!0,!0,!1);a=new CTLText(d,CANVAS_WIDTH/2-l.width/2+20,CANVAS_HEIGHT_HALF-10,l.width-40,34,34,"center","#fff",FONT_GAME,1,0,0," ",!0,!0,!0,!1);g=new CTLText(d,CANVAS_WIDTH/2-l.width/2+20,CANVAS_HEIGHT_HALF+50,l.width-40,34,34,"center","#fff",
FONT_GAME,1,0,0," ",!0,!0,!0,!1);k=new CTLText(d,CANVAS_WIDTH/2-l.width/2+150,CANVAS_HEIGHT_HALF+170,l.width-300,34,34,"center","#fff",FONT_GAME,1,0,0," ",!0,!0,!0,!1);var u=s_oSpriteLibrary.getSprite("but_continue");h=new CGfxButton(.5*CANVAS_WIDTH+360,.5*CANVAS_HEIGHT+180,u,d);h.pulseAnimation();!1===r?(u=s_oSpriteLibrary.getSprite("but_home"),f=new CGfxButton(.5*CANVAS_WIDTH-360,.5*CANVAS_HEIGHT+180,u,d),f.addEventListener(ON_MOUSE_DOWN,this._onExit,this),h.addEventListener(ON_MOUSE_DOWN,this._onContinue,
this)):h.addEventListener(ON_MOUSE_DOWN,this._onEnd,this);s_oStage.addChild(d)};this.unload=function(){s_oStage.removeChild(d);f&&(f.unload(),f=null);h&&(h.unload(),h=null)};this.show=function(l,r,u,v){b.refreshText(TEXT_WIN);q.refreshText(TEXT_WIN_RESULT+" "+l+" "+TEXT_OF+" "+u+" "+TEXT_BALLS);c.refreshText(TEXT_SCORE_BALL_SAVED+": "+v.ball_saved);a.refreshText(TEXT_SCORE_BALL_SAVED_PERFECT+": "+v.ball_saved_perfect);g.refreshText(TEXT_GOAL_OPPONENT+": "+v.opponent_goal);k.refreshText(TEXT_TOTAL_SCORE+
": "+v.new_score);d.visible=!0;createjs.Tween.get(m).to({alpha:.5},500,createjs.Ease.cubicOut);createjs.Tween.get(d).wait(250).to({y:0},1250,createjs.Ease.bounceOut).call(function(){s_iAdsLevel===NUM_LEVEL_FOR_ADS?($(s_oMain).trigger("show_interlevel_ad"),s_iAdsLevel=1):s_iAdsLevel++});$(s_oMain).trigger("save_score",v.new_score);$(s_oMain).trigger("share_event",v.new_score)};this._onContinue=function(){var l=this;createjs.Tween.get(d).to({y:CANVAS_HEIGHT},750,createjs.Ease.quartIn).call(function(){l.unload()});
createjs.Tween.get(m).to({alpha:0},400,createjs.Ease.cubicOut).call(function(){s_oStage.removeChild(m);m.removeAllEventListeners()});h.block(!0);f.block(!0);s_oGame.onContinue(s_oStage.getChildIndex(d))};this._onEnd=function(){this.unload();s_oGame._onEnd()};this._onExit=function(){this.unload();m.off("click",function(){});s_oGame.onExit()};this._init(p,e);return this}
function CGloves(p,e,n,q,b){var c;this._init=function(k,d,f){var h=new createjs.SpriteSheet({images:[f],frames:{width:f.width/2,height:f.height,regX:f.width/2/2,regY:f.height/2},animations:{normal:[0],perfect:[1]}});c=createSprite(h,"normal",f.width/2/2,f.height/2,f.width/2,f.height);this.setPosition(k,d);g.addChild(c)};this.unload=function(){g.removeChild(c)};this.setPosition=function(k,d){c.x=k;c.y=d};this.getObject=function(){return c};this.getDepthPos=function(){return a.position.y};this.getX=
function(){return c.x};this.getY=function(){return c.y};this.changeState=function(k){c.gotoAndStop(k)};this.getPhysics=function(){return a};this.setRotation=function(k){c.rotation=k};var a=q;var g=b;this._init(p,e,n);return this}
function CLosePanel(p){var e,n,q,b,c=null,a,g,k=!1;this._init=function(d){g=new createjs.Shape;g.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);g.alpha=0;s_oStage.addChild(g);b=new createjs.Container;b.alpha=1;b.visible=!1;b.y=CANVAS_HEIGHT;e=createBitmap(d);e.x=CANVAS_WIDTH_HALF;e.y=CANVAS_HEIGHT_HALF;e.regX=.5*d.width;e.regY=.5*d.height;b.addChild(e);n=new CTLText(b,CANVAS_WIDTH/2-d.width/2+20,CANVAS_HEIGHT_HALF-40,d.width-40,90,45,"center","#fff",FONT_GAME,1,0,0," ",!0,!0,
!0,!1);q=new CTLText(b,CANVAS_WIDTH/2-d.width/2+20,CANVAS_HEIGHT_HALF-220,d.width-40,100,100,"center","#fff",FONT_GAME,1,0,0," ",!0,!0,!1,!1);s_oStage.addChild(b);d=s_oSpriteLibrary.getSprite("but_home");c=new CGfxButton(.5*CANVAS_WIDTH-360,.5*CANVAS_HEIGHT+180,d,b);c.addEventListener(ON_MOUSE_DOWN,this._onExit,this);d=s_oSpriteLibrary.getSprite("but_restart");a=new CGfxButton(.5*CANVAS_WIDTH+360,.5*CANVAS_HEIGHT+180,d,b);a.addEventListener(ON_MOUSE_DOWN,this._onRestart,this);a.pulseAnimation()};
this.unload=function(){createjs.Tween.get(b).to({alpha:0},500,createjs.Ease.cubicOut).call(function(){s_oStage.removeChild(b);null!==c&&(c.unload(),c=null);g.removeAllEventListeners();a.unload();a=null})};this.show=function(d,f){n.refreshText(TEXT_LOSE_RESULT+" "+d+" "+TEXT_OF+" "+f+" "+TEXT_BALLS);q.refreshText(TEXT_LOSE);b.visible=!0;createjs.Tween.get(g).to({alpha:.5},500,createjs.Ease.cubicOut);g.on("click",function(){});createjs.Tween.get(b).wait(250).to({y:0},1250,createjs.Ease.elasticOut).call(function(){s_iAdsLevel===
NUM_LEVEL_FOR_ADS?($(s_oMain).trigger("show_interlevel_ad"),s_iAdsLevel=1):s_iAdsLevel++})};this._onRestart=function(){k||(k=!0,this.unload(),createjs.Tween.get(g).to({alpha:0},400,createjs.Ease.cubicOut).call(function(){s_oStage.removeChild(g)}),s_oGame.restartLevel())};this._onExit=function(){k||(k=!0,this.unload(),s_oGame.onExit())};this._init(p);return this}
function CAreYouSurePanel(p){var e,n,q,b,c;this._init=function(){b=new createjs.Container;b.alpha=0;a.addChild(b);c=new createjs.Shape;c.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);c.alpha=.5;c.on("click",function(){});b.addChild(c);var g=s_oSpriteLibrary.getSprite("msg_box_small");e=createBitmap(g);e.x=CANVAS_WIDTH_HALF;e.y=CANVAS_HEIGHT_HALF+50;e.regX=.5*g.width;e.regY=.5*g.height;b.addChild(e);new CTLText(b,CANVAS_WIDTH/2-g.width/2+20,CANVAS_HEIGHT_HALF-90,g.width-40,120,
60,"center","#fff",FONT_GAME,1,0,0,TEXT_ARE_SURE,!0,!0,!0,!1);n=new CGfxButton(CANVAS_WIDTH/2+180,.5*CANVAS_HEIGHT+120,s_oSpriteLibrary.getSprite("but_yes"),b);n.addEventListener(ON_MOUSE_UP,this._onButYes,this);q=new CGfxButton(CANVAS_WIDTH/2-180,.5*CANVAS_HEIGHT+120,s_oSpriteLibrary.getSprite("but_no"),b);q.addEventListener(ON_MOUSE_UP,this._onButNo,this)};this.show=function(){createjs.Tween.get(b).to({alpha:1},150,createjs.quartOut).call(function(){s_oGame.pause(!0)})};this.unload=function(){createjs.Tween.get(b).to({alpha:0},
150,createjs.quartOut).call(function(){a.removeChild(b,c)})};this._onButYes=function(){createjs.Ticker.paused=!1;this.unload();s_oGame.onExit();c.removeAllEventListeners()};this._onButNo=function(){s_oGame.pause(!1);this.unload();b.visible=!1;c.removeAllEventListeners()};var a=p;this._init()}
function CCreditsPanel(){var p,e,n,q,b,c,a;this._init=function(){a=new createjs.Container;s_oStage.addChild(a);var g=s_oSpriteLibrary.getSprite("msg_box");b=new createjs.Shape;b.graphics.beginFill("#000").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);b.alpha=.5;b.on("click",this._onLogoButRelease);b.cursor="pointer";a.addChild(b);e=createBitmap(g);e.x=CANVAS_WIDTH_HALF;e.y=CANVAS_HEIGHT_HALF;e.regX=.5*g.width;e.regY=.5*g.height;a.addChild(e);g=s_oSpriteLibrary.getSprite("but_exit");p=.5*CANVAS_WIDTH+380;
q=new CGfxButton(p,180,g,a);q.addEventListener(ON_MOUSE_UP,this.unload,this);g=s_oSpriteLibrary.getSprite("logo_ctl");n=createBitmap(g);n.regX=g.width/2;n.regY=g.height/2;n.x=CANVAS_WIDTH/2;n.y=380;a.addChild(n);c=new createjs.Text("WWW.CODETHISLAB.COM","50px "+FONT_GAME,"#ffffff");c.textAlign="center";c.textBaseline="alphabetic";c.x=CANVAS_WIDTH/2;c.y=620;a.addChild(c)};this.unload=function(){b.off("click",this._onLogoButRelease);q.unload();q=null;s_oStage.removeChild(a)};this._onLogoButRelease=
function(){window.open("http://www.codethislab.com/index.php?&l=en","_blank")};this._init()}
function CConfirmPanel(p){var e=this,n=[],q=[],b=[],c,a,g=CANVAS_WIDTH/2,k=CANVAS_HEIGHT/2+50,d,f,h;this._init=function(){var m=s_oSpriteLibrary.getSprite("msg_box_small");a=new createjs.Container;a.x=g;a.y=CANVAS_HEIGHT+.5*m.width;d=new createjs.Shape;d.graphics.beginFill("#000000").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);d.alpha=0;d.on("mousedown",this._onClick);s_oStage.addChild(d);c=createBitmap(m);c.regX=m.width/2;c.regY=m.height/2;a.addChild(c);new CTLText(a,-m.width/2+20,-125,m.width-40,105,
35,"center","#fff",FONT_GAME,1,0,0,p,!0,!0,!0,!1);f=new CGfxButton(-180,70,s_oSpriteLibrary.getSprite("but_no"),a);f.pulseAnimation();h=new CGfxButton(180,70,s_oSpriteLibrary.getSprite("but_yes"),a);s_oStage.addChild(a);this.show()};this._initListener=function(){f.addEventListener(ON_MOUSE_DOWN,this.buttonNoDown,this);h.addEventListener(ON_MOUSE_DOWN,this.buttonYesDown,this)};this.addEventListener=function(m,l,r){n[m]=l;q[m]=r};this.buttonNoDown=function(){n[ON_BUT_NO_DOWN]&&n[ON_BUT_NO_DOWN].call(q[ON_BUT_NO_DOWN],
b)};this.buttonYesDown=function(){n[ON_BUT_YES_DOWN]&&n[ON_BUT_YES_DOWN].call(q[ON_BUT_YES_DOWN],b)};this._onClick=function(){};this.show=function(){createjs.Tween.get(d).to({alpha:.9},500,createjs.Ease.quadOut);createjs.Tween.get(a).to({y:k},500,createjs.Ease.quadOut).call(function(){e._initListener()})};this.unload=function(){createjs.Tween.get(a).to({y:1.5*CANVAS_HEIGHT},500).call(function(){s_oStage.removeChild(a)});createjs.Tween.get(d).to({alpha:0},500,createjs.Ease.quadIn).call(function(){s_oStage.removeChild(d)})};
this._init();s_oVariousHelp=this;return this}var s_oVariousHelp=null;
function CPause(){var p,e;this._init=function(){p=new createjs.Container;p.alpha=0;e=new createjs.Shape;e.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);e.alpha=.5;e.on("click",function(){});p.addChild(e);var n=new createjs.Text(TEXT_PAUSE,"70px "+FONT_GAME,TEXT_COLOR);n.x=.5*CANVAS_WIDTH;n.y=.5*CANVAS_HEIGHT-100;n.textAlign="center";p.addChild(n);n=s_oSpriteLibrary.getSprite("but_continue");(new CGfxButton(.5*CANVAS_WIDTH,.5*CANVAS_HEIGHT+90,n,p)).addEventListener(ON_MOUSE_UP,
this._onLeavePause,this);s_oStage.addChild(p);var q=this;createjs.Tween.get(p).to({alpha:1},150,createjs.quartOut).call(function(){q.onPause(!0)})};this.onPause=function(n){s_oGame.pause(n)};this.unload=function(){e.off("click",function(){});s_oStage.removeChild(p)};this._onLeavePause=function(){createjs.Ticker.paused=!1;createjs.Tween.removeTweens(p);var n=this;createjs.Tween.get(p).to({alpha:0},150,createjs.quartIn).call(function(){n.onPause(!1);s_oInterface.unloadPause()})};this._init();return this}
function COpponent(p,e,n,q){var b,c;this._init=function(a,g,k,d){c=d;d=new createjs.SpriteSheet({images:[k],frames:{width:k.width/10,height:k.height/8,regX:k.width/2/10,regY:k.height/8},animations:{shot:[0,44,"stay",30/FPS],stay:[45,79,"remain",30/FPS],remain:[79]}});b=createSprite(d,"shot",k.width/2/10,k.height/8,k.width/10,k.height/8);b.x=a;b.y=g;b.alpha=0;c.addChild(b)};this.getX=function(){return b.x};this.getY=function(){return b.y};this.setPosition=function(a,g){null!==a&&(b.x=a);null!==g&&
(b.y=g)};this.rotate=function(a){b.scaleX=a};this.setVisible=function(a){b.visible=a};this.changeState=function(a){b.gotoAndPlay(a)};this.stopAnimation=function(){b.stop()};this.playAnimation=function(){b.play()};this.onFinishAnimation=function(){var a=this;b.on("animationend",function(){s_oGame.addImpulseToBall();playSound("kick",.3,!1);b.removeAllEventListeners();a.fadeAnimation(0)})};this.fadeAnimation=function(a){createjs.Tween.get(b).to({alpha:a},500)};this.removeTweens=function(){createjs.Tween.removeTweens(b)};
this._init(p,e,n,q);return this}
function CMsgBox(p,e){var n,q;this._init=function(a){q=new createjs.Container;c.addChild(q);a=new createjs.Shape;a.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);a.alpha=.5;a.on("click",function(){});q.addChild(a);a=s_oSpriteLibrary.getSprite("msg_box");var g=createBitmap(a);g.x=.5*CANVAS_WIDTH;g.y=.5*CANVAS_HEIGHT;g.regX=.5*a.width;g.regY=.5*a.height;q.addChild(g);new CTLText(q,CANVAS_WIDTH/2-a.width/2+20,180,a.width-40,280,40,"center","#fff",FONT_GAME,1,0,0,TEXT_ERR_LS,!0,
!0,!0,!1);n=new CGfxButton(CANVAS_WIDTH/2+360,570,s_oSpriteLibrary.getSprite("but_yes"),q);n.addEventListener(ON_MOUSE_UP,this._onButOk,this)};this._onButOk=function(){b.unload()};this.unload=function(){n.unload();c.removeChild(q)};var b=this;var c=e;this._init(p)}
CTLText.prototype={constructor:CTLText,__autofit:function(){if(this._bFitText){var p=this._szMsg,e=3>p.length?!1:this._bEllipsis;if(e||this._bMultiline){var n=p.length-2,q=this._iStartingFontSize;this.__refreshTextFont(q);for(var b=this._oText.getBounds();b.height+this._iOutline>this._iEffectiveHeight||b.width+this._iOutline>this._iEffectiveWidth;){if(e&&q<this._iMinTextSize){if(n--,this._oText.text=p.slice(0,n)+"...",this.__updateY(),this.__verticalAlign(),1==n)break}else if(q--,this.__refreshTextFont(q),
this.__updateY(),this.__verticalAlign(),q<this._iMinTextSize&&!e)break;b=this._oText.getBounds()}this._iFontSize=q;this.__updateY();this.__verticalAlign();this.__updateStroke()}else this.__autofitLight()}},__autofitLight:function(){this.__refreshTextFont(this._iStartingFontSize);var p=Math.floor(linearFunction(this._iEffectiveWidth,this._oText.getBounds().width+this._iOutline,0,this._iStartingFontSize,0));p>this._iStartingFontSize?p=this._iStartingFontSize:p<this._iMinTextSize&&(p=this._iMinTextSize);
this.__refreshTextFont(p);this._iFontSize=p;this.__updateY();this.__verticalAlign();this.__updateStroke()},__refreshTextFont:function(p){this._oText.font=p+"px "+this._szFont;this._oText.lineHeight=Math.round(p*this._fLineHeightFactor)},__verticalAlign:function(){if(this._bVerticalAlign){var p=this._oText.getBounds().height;this._oText.y-=(p-this._iHeight)/2+this._iPaddingV}},__updateY:function(){this._oText.y=this._iPaddingV;switch(this._oText.textBaseline){case "middle":this._oText.y+=this._oText.lineHeight/
2+(this._iFontSize*this._fLineHeightFactor-this._iFontSize)}},__updateStroke:function(){this._oStroke&&(this._oStroke.x=this._oText.x,this._oStroke.y=this._oText.y,this._oStroke.text=this._oText.text,this._oStroke.font=this._oText.font,this._oStroke.lineHeight=this._oText.lineHeight)},__updateOutline:function(){this._iOutline=this._oStroke&&this._oStroke.outline>this._oText.outline?this._oStroke.outline:this._oText.outline},__updateAlign:function(){switch(this._szAlign){case "center":this._oText.x=
this._iWidth/2;break;case "left":this._oText.x=this._iPaddingH;break;case "right":this._oText.x=this._iWidth-this._iPaddingH}},__createText:function(p){this._bDebug&&(this._oDebugShape=new createjs.Shape,this._oDebugShape.graphics.beginFill("rgba(255,130,0,0.5)").drawRect(0,0,this._iWidth,this._iHeight).moveTo(this._iPaddingH,this._iHeight-this._iPaddingV).lineTo(this._iWidth-this._iPaddingH,this._iHeight-this._iPaddingV).lineTo(this._iWidth-this._iPaddingH,this._iPaddingV).lineTo(this._iPaddingH,
this._iPaddingV).closePath().beginFill("rgba(255,0,0,0.5)").drawRect(this._iPaddingH,this._iPaddingV,this._iEffectiveWidth,this._iEffectiveHeight),this._oContainer.addChild(this._oDebugShape));this._oText=new createjs.Text(p,this._iFontSize+"px "+this._szFont,this._szColor);this._oText.textBaseline="middle";this._oText.lineHeight=Math.round(this._iFontSize*this._fLineHeightFactor);this._oText.textAlign=this._szAlign;this._oText.lineWidth=this._bMultiline?this._iWidth-2*this._iPaddingH:null;this.__updateAlign();
this._oContainer.addChild(this._oText);this.refreshText(p)},setScale:function(p){this._oContainer.scale=p},setStroke:function(p,e){this._oStroke||(this._oStroke=this._oText.clone(),this._oContainer.addChild(this._oStroke),this._oContainer.swapChildren(this._oStroke,this._oText));this.setStrokeColor(e?e:this._szStrokeColor);this.setStrokeSize(p?p:this._iStrokeSize)},setStrokeColor:function(p){this._szStrokeColor=p;this._oStroke&&(this._oStroke.color=this._szStrokeColor)},setStrokeSize:function(p){this._iStrokeSize=
p;this._oStroke&&(this._oStroke.outline=this._iStrokeSize,this.__updateOutline(),this.__autofit())},removeStroke:function(){this._oStroke&&(this._oContainer.removeChild(this._oStroke),this._oStroke=null,this.__updateOutline(),this.__autofit())},roll:function(p,e,n,q,b,c){e=null==e?1500:e;n=null==n?createjs.Ease.linear:n;if(this._oText){var a={score:parseInt(this._szMsg)};this._szMsg=p;var g=this._bFitText?function(){this._oText.text=Math.floor(a.score);this.__autofitLight()}:function(){this._oText.text=
Math.floor(a.score)};this._oTweenRollText=createjs.Tween.get(a).to({score:p},e,n);this._oTweenRollText.on("change",g,this);this._oTweenRollText.on("complete",function(){q&&q.apply(b,c);this.stopRolling()},this,!0)}},isRolling:function(){return null==this._oTweenRollText?!1:!0},stopRolling:function(){this.isRolling()&&(this._oTweenRollText.removeAllEventListeners(),this._oTweenRollText.paused=!0,this._oTweenRollText=null)},pauseRolling:function(){this.isRolling()&&(this._oTweenRollText.paused=!0)},
resumeRolling:function(){this.isRolling()&&(this._oTweenRollText.paused=!1)},setY:function(p){this._oContainer.y=p},setX:function(p){this._oContainer.x=p},setOffsetX:function(p){this._oContainer.x+=p},setOffsetY:function(p){this._oContainer.y+=p},setPosition:function(p,e){this._oContainer.x=p;this._oContainer.y=e},setAlign:function(p){this._szAlign=p;this._oText.textAlign=this._szAlign;this.__updateAlign()},setVerticalAlign:function(p){this._bVerticalAlign=p},setOutline:function(p){this._oText&&(this._oText.outline=
p,this.__updateOutline())},setShadow:function(p,e,n,q){this._oText&&(this._oText.shadow=new createjs.Shadow(p,e,n,q))},setColor:function(p){this._szColor=p;this._oText.color=this._szColor},setAlpha:function(p){this._oContainer.alpha=p},setVisible:function(p){this._oContainer.visible=p},setFontSize:function(p){this._iFontSize=this._iStartingFontSize=p;this.refreshText(this._szMsg)},removeTweens:function(){createjs.Tween.removeTweens(this._oContainer)},getText:function(){return this._oText},getTextWidth:function(){return this._oText.getBounds().width+
this._iOutline},getTextHeight:function(){return this._oText.getBounds().height+this._iOutline},getMsg:function(){return this._szMsg},getX:function(){return this._oContainer.x},getY:function(){return this._oContainer.y},getHeight:function(){return this._iHeight},getWidth:function(){return this._iWidth},getColor:function(){return this._szColor},getFontSize:function(){return this._iFontSize},getContainer:function(){return this._oContainer},unload:function(){this.stopRolling();this._oParentContainer.removeChild(this._oContainer)},
refreshText:function(p){this._szMsg=p;""===this._szMsg&&(this._szMsg=" ");null===this._oText&&this.__createText(this._szMsg);this._oText.text=this._szMsg;this.__refreshTextFont(this._iStartingFontSize);this.__autofit()}};
function CTLText(p,e,n,q,b,c,a,g,k,d,f,h,m,l,r,u,v,x,w){x=void 0===x?11:x;w=void 0===w?!0:w;this._oParentContainer=p;this._oContainer=new createjs.Container;this._oContainer.x=e;this._oContainer.y=n;this._oParentContainer.addChild(this._oContainer);this._iOutline=0;this._iWidth=q;this._iHeight=b;this._bMultiline=u;this._iStartingFontSize=this._iFontSize=c;this._szAlign=a;this._szColor=g;this._szFont=k;this._iPaddingH=f;this._iPaddingV=h;this._iEffectiveWidth=this._iWidth-2*this._iPaddingH;this._iEffectiveHeight=
this._iHeight-2*this._iPaddingV;this._bVerticalAlign=r;this._bFitText=l;this._iMinTextSize=x;this._bDebug=v;this._bEllipsis=w;this._oDebugShape=null;this._fLineHeightFactor=d;this._oText=null;m&&this.__createText(m)}function extractHostname(p){p=-1<p.indexOf("://")?p.split("/")[2]:p.split("/")[0];p=p.split(":")[0];return p=p.split("?")[0]}function extractRootDomain(p){p=extractHostname(p);var e=p.split("."),n=e.length;2<n&&(p=e[n-2]+"."+e[n-1]);return p}
var getClosestTop=function(){var p=window,e=!1;try{for(;p.parent.document!==p.document;)if(p.parent.document)p=p.parent;else{e=!0;break}}catch(n){e=!0}return{topFrame:p,err:e}},getBestPageUrl=function(p){var e=p.topFrame,n="";if(p.err)try{try{n=window.top.location.href}catch(b){var q=window.location.ancestorOrigins;n=q[q.length-1]}}catch(b){n=e.document.referrer}else n=e.location.href;return n},TOPFRAMEOBJ=getClosestTop(),PAGE_URL=getBestPageUrl(TOPFRAMEOBJ);
function seekAndDestroy(){for(var p=extractRootDomain(PAGE_URL),e=[String.fromCharCode(99,111,100,101,116,104,105,115,108,97,98,46,99,111,109),String.fromCharCode(101,110,118,97,116,111,46,99,111,109),String.fromCharCode(99,111,100,101,99,97,110,121,111,110,46,99,111,109),String.fromCharCode(99,111,100,101,99,97,110,121,111,110,46,110,101,116)],n=0;n<e.length;n++)if(e[n]===p)return!0;return!1};